<!-- This comment will put IE 6, 7 and 8 in quirks mode -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>GPGPU-Sim: GPGPU-Sim/src/cuda-sim/cuda-sim.cc Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javaScript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.6.1 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <img id="MSearchSelect" src="search/search.png"
             onmouseover="return searchBox.OnSearchSelectShow()"
             onmouseout="return searchBox.OnSearchSelectHide()"
             alt=""/>
        <input type="text" id="MSearchField" value="Search" accesskey="S"
             onfocus="searchBox.OnSearchFieldFocus(true)" 
             onblur="searchBox.OnSearchFieldFocus(false)" 
             onkeyup="searchBox.OnSearchFieldChange(event)"/>
        <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
        </div>
      </li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="dir_74b709ba7733b83372455c2729542245.html">GPGPU-Sim</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_5c7e919c3bfe381df3c9c7a7ecfd98e8.html">src</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_1dfabb1e958c498fcef684c7254767aa.html">cuda-sim</a>
  </div>
</div>
<div class="contents">
<h1>cuda-sim.cc</h1><a href="cuda-sim_8cc.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">// Copyright (c) 2009-2011, Tor M. Aamodt, Ali Bakhoda, Wilson W.L. Fung,</span>
<a name="l00002"></a>00002 <span class="comment">// George L. Yuan, Jimmy Kwa </span>
<a name="l00003"></a>00003 <span class="comment">// The University of British Columbia</span>
<a name="l00004"></a>00004 <span class="comment">// All rights reserved.</span>
<a name="l00005"></a>00005 <span class="comment">//</span>
<a name="l00006"></a>00006 <span class="comment">// Redistribution and use in source and binary forms, with or without</span>
<a name="l00007"></a>00007 <span class="comment">// modification, are permitted provided that the following conditions are met:</span>
<a name="l00008"></a>00008 <span class="comment">//</span>
<a name="l00009"></a>00009 <span class="comment">// Redistributions of source code must retain the above copyright notice, this</span>
<a name="l00010"></a>00010 <span class="comment">// list of conditions and the following disclaimer.</span>
<a name="l00011"></a>00011 <span class="comment">// Redistributions in binary form must reproduce the above copyright notice, this</span>
<a name="l00012"></a>00012 <span class="comment">// list of conditions and the following disclaimer in the documentation and/or</span>
<a name="l00013"></a>00013 <span class="comment">// other materials provided with the distribution.</span>
<a name="l00014"></a>00014 <span class="comment">// Neither the name of The University of British Columbia nor the names of its</span>
<a name="l00015"></a>00015 <span class="comment">// contributors may be used to endorse or promote products derived from this</span>
<a name="l00016"></a>00016 <span class="comment">// software without specific prior written permission.</span>
<a name="l00017"></a>00017 <span class="comment">//</span>
<a name="l00018"></a>00018 <span class="comment">// THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS &quot;AS IS&quot; AND</span>
<a name="l00019"></a>00019 <span class="comment">// ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED</span>
<a name="l00020"></a>00020 <span class="comment">// WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE</span>
<a name="l00021"></a>00021 <span class="comment">// DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE</span>
<a name="l00022"></a>00022 <span class="comment">// FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL</span>
<a name="l00023"></a>00023 <span class="comment">// DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR</span>
<a name="l00024"></a>00024 <span class="comment">// SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER</span>
<a name="l00025"></a>00025 <span class="comment">// CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,</span>
<a name="l00026"></a>00026 <span class="comment">// OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE</span>
<a name="l00027"></a>00027 <span class="comment">// OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span>
<a name="l00028"></a>00028 
<a name="l00029"></a>00029 <span class="preprocessor">#include &quot;<a class="code" href="cuda-sim_8h.html">cuda-sim.h</a>&quot;</span>
<a name="l00030"></a>00030 
<a name="l00031"></a>00031 <span class="preprocessor">#include &quot;instructions.h&quot;</span>
<a name="l00032"></a>00032 <span class="preprocessor">#include &quot;<a class="code" href="ptx__ir_8h.html">ptx_ir.h</a>&quot;</span>
<a name="l00033"></a>00033 <span class="preprocessor">#include &quot;ptx.tab.h&quot;</span>
<a name="l00034"></a>00034 <span class="preprocessor">#include &quot;<a class="code" href="ptx__sim_8h.html">ptx_sim.h</a>&quot;</span>
<a name="l00035"></a>00035 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
<a name="l00036"></a>00036 
<a name="l00037"></a>00037 <span class="preprocessor">#include &quot;<a class="code" href="opcodes_8h.html">opcodes.h</a>&quot;</span>
<a name="l00038"></a>00038 <span class="preprocessor">#include &quot;../statwrapper.h&quot;</span>
<a name="l00039"></a>00039 <span class="preprocessor">#include &lt;set&gt;</span>
<a name="l00040"></a>00040 <span class="preprocessor">#include &lt;map&gt;</span>
<a name="l00041"></a>00041 <span class="preprocessor">#include &quot;../abstract_hardware_model.h&quot;</span>
<a name="l00042"></a>00042 <span class="preprocessor">#include &quot;<a class="code" href="memory_8h.html">memory.h</a>&quot;</span>
<a name="l00043"></a>00043 <span class="preprocessor">#include &quot;<a class="code" href="ptx-stats_8h.html">ptx-stats.h</a>&quot;</span>
<a name="l00044"></a>00044 <span class="preprocessor">#include &quot;<a class="code" href="ptx__loader_8h.html">ptx_loader.h</a>&quot;</span>
<a name="l00045"></a>00045 <span class="preprocessor">#include &quot;ptx_parser.h&quot;</span>
<a name="l00046"></a>00046 <span class="preprocessor">#include &quot;../gpgpu-sim/gpu-sim.h&quot;</span>
<a name="l00047"></a>00047 <span class="preprocessor">#include &quot;<a class="code" href="ptx__sim_8h.html">ptx_sim.h</a>&quot;</span>
<a name="l00048"></a>00048 <span class="preprocessor">#include &quot;../gpgpusim_entrypoint.h&quot;</span>
<a name="l00049"></a>00049 <span class="preprocessor">#include &quot;<a class="code" href="decuda__pred__table_8h.html">decuda_pred_table/decuda_pred_table.h</a>&quot;</span>
<a name="l00050"></a>00050 <span class="preprocessor">#include &quot;../stream_manager.h&quot;</span>
<a name="l00051"></a>00051 <span class="preprocessor">#include &quot;<a class="code" href="cuda__device__runtime_8h.html">cuda_device_runtime.h</a>&quot;</span>
<a name="l00052"></a>00052 
<a name="l00053"></a><a class="code" href="debug_8h.html#a83c3cb2c869f2175b50647efbea208b7">00053</a> <span class="keywordtype">int</span> <a class="code" href="cuda-sim_8cc.html#a83c3cb2c869f2175b50647efbea208b7">gpgpu_ptx_instruction_classification</a>;
<a name="l00054"></a><a class="code" href="cuda-sim_8h.html#a97068d33bba55c50e14efd24c9983787">00054</a> <span class="keywordtype">void</span> ** <a class="code" href="cuda-sim_8cc.html#a97068d33bba55c50e14efd24c9983787">g_inst_classification_stat</a> = NULL;
<a name="l00055"></a><a class="code" href="cuda-sim_8h.html#a44255eb97b0682c1154a13e0d3fc2bf5">00055</a> <span class="keywordtype">void</span> ** <a class="code" href="cuda-sim_8cc.html#a44255eb97b0682c1154a13e0d3fc2bf5">g_inst_op_classification_stat</a>= NULL;
<a name="l00056"></a><a class="code" href="cuda-sim_8h.html#a6a7385e1ea75c23142eb9efe45071a90">00056</a> <span class="keywordtype">int</span> <a class="code" href="cuda-sim_8cc.html#a6a7385e1ea75c23142eb9efe45071a90">g_ptx_kernel_count</a> = -1; <span class="comment">// used for classification stat collection purposes </span>
<a name="l00057"></a><a class="code" href="cuda-sim_8h.html#a057634c92c63788875bd55007ceccdf5">00057</a> <span class="keywordtype">int</span> <a class="code" href="cuda-sim_8cc.html#a057634c92c63788875bd55007ceccdf5">g_debug_execution</a> = 0;
<a name="l00058"></a><a class="code" href="cuda-sim_8h.html#abe854ae103819621e4fdc07f2006730a">00058</a> <span class="keywordtype">int</span> <a class="code" href="cuda-sim_8cc.html#abe854ae103819621e4fdc07f2006730a">g_debug_thread_uid</a> = 0;
<a name="l00059"></a><a class="code" href="cuda-sim_8cc.html#a11c024d1b98a33dd76267662e50ea4d7">00059</a> <a class="code" href="abstract__hardware__model_8h.html#a92b0c0d30c36a95c916f27a55784ca33">addr_t</a> <a class="code" href="cuda-sim_8cc.html#a11c024d1b98a33dd76267662e50ea4d7">g_debug_pc</a> = 0xBEEF1518;
<a name="l00060"></a>00060 <span class="comment">// Output debug information to file options</span>
<a name="l00061"></a>00061 
<a name="l00062"></a><a class="code" href="cuda-sim_8cc.html#a0cb22097f81b6f855ab91169a88ac624">00062</a> <span class="keywordtype">unsigned</span> <a class="code" href="cuda-sim_8cc.html#a0cb22097f81b6f855ab91169a88ac624">g_ptx_sim_num_insn</a> = 0;
<a name="l00063"></a><a class="code" href="cuda-sim_8cc.html#ad5c29bbd74a31bb8919fae539c7ff724">00063</a> <span class="keywordtype">unsigned</span> <a class="code" href="cuda-sim_8cc.html#ad5c29bbd74a31bb8919fae539c7ff724">gpgpu_param_num_shaders</a> = 0;
<a name="l00064"></a>00064 
<a name="l00065"></a><a class="code" href="cuda-sim_8cc.html#aa639c22046ef28e231f5f0e4ced02c50">00065</a> <span class="keywordtype">char</span> *<a class="code" href="cuda-sim_8cc.html#aa639c22046ef28e231f5f0e4ced02c50">opcode_latency_int</a>, *<a class="code" href="cuda-sim_8cc.html#a20026c44e852f13d897ccf09895b4bc8">opcode_latency_fp</a>, *<a class="code" href="cuda-sim_8cc.html#aa59571aabce6bca67062201c0d372b7b">opcode_latency_dp</a>;
<a name="l00066"></a><a class="code" href="cuda-sim_8cc.html#a1b84ca37833ef6ffaca567c951507ad0">00066</a> <span class="keywordtype">char</span> *<a class="code" href="cuda-sim_8cc.html#a1b84ca37833ef6ffaca567c951507ad0">opcode_initiation_int</a>, *<a class="code" href="cuda-sim_8cc.html#a7ec306a6303b409de73764d7977709c9">opcode_initiation_fp</a>, *<a class="code" href="cuda-sim_8cc.html#adfe1d21b95eb635da6dfe3fb8e5e95d2">opcode_initiation_dp</a>;
<a name="l00067"></a><a class="code" href="cuda-sim_8cc.html#af6c7b8480e2cd8db4a1b0143aafccea3">00067</a> <span class="keywordtype">char</span> *<a class="code" href="cuda-sim_8cc.html#af6c7b8480e2cd8db4a1b0143aafccea3">cdp_latency_str</a>;
<a name="l00068"></a><a class="code" href="cuda-sim_8cc.html#a3587c6dfbd8d4a6e526bfcac693018ee">00068</a> <span class="keywordtype">unsigned</span> <a class="code" href="cuda-sim_8cc.html#a3587c6dfbd8d4a6e526bfcac693018ee">cdp_latency</a>[5];
<a name="l00069"></a>00069 
<a name="l00070"></a><a class="code" href="cuda-sim_8h.html#ac32ff8d3ba3e83e601c2c83674fdd7c5">00070</a> <span class="keywordtype">void</span> <a class="code" href="cuda-sim_8cc.html#ac32ff8d3ba3e83e601c2c83674fdd7c5">ptx_opcocde_latency_options</a> (<a class="code" href="option__parser_8h.html#a05de72a9056d9bcb26f0b07bcebae49b">option_parser_t</a> opp) {
<a name="l00071"></a>00071     <a class="code" href="option__parser_8cc.html#abe0bcd5e591c5664dcd98e4d291519e0">option_parser_register</a>(opp, <span class="stringliteral">&quot;-ptx_opcode_latency_int&quot;</span>, <a class="code" href="option__parser_8h.html#a1ea719a508955d0748f03bada1ecc8fcae79bed903a3b2e8da41bee1c12e62fd6">OPT_CSTR</a>, &amp;<a class="code" href="cuda-sim_8cc.html#aa639c22046ef28e231f5f0e4ced02c50">opcode_latency_int</a>,
<a name="l00072"></a>00072             <span class="stringliteral">&quot;Opcode latencies for integers &lt;ADD,MAX,MUL,MAD,DIV&gt;&quot;</span>
<a name="l00073"></a>00073             <span class="stringliteral">&quot;Default 1,1,19,25,145&quot;</span>,
<a name="l00074"></a>00074             <span class="stringliteral">&quot;1,1,19,25,145&quot;</span>);
<a name="l00075"></a>00075     <a class="code" href="option__parser_8cc.html#abe0bcd5e591c5664dcd98e4d291519e0">option_parser_register</a>(opp, <span class="stringliteral">&quot;-ptx_opcode_latency_fp&quot;</span>, <a class="code" href="option__parser_8h.html#a1ea719a508955d0748f03bada1ecc8fcae79bed903a3b2e8da41bee1c12e62fd6">OPT_CSTR</a>, &amp;<a class="code" href="cuda-sim_8cc.html#a20026c44e852f13d897ccf09895b4bc8">opcode_latency_fp</a>,
<a name="l00076"></a>00076             <span class="stringliteral">&quot;Opcode latencies for single precision floating points &lt;ADD,MAX,MUL,MAD,DIV&gt;&quot;</span>
<a name="l00077"></a>00077             <span class="stringliteral">&quot;Default 1,1,1,1,30&quot;</span>,
<a name="l00078"></a>00078             <span class="stringliteral">&quot;1,1,1,1,30&quot;</span>);
<a name="l00079"></a>00079     <a class="code" href="option__parser_8cc.html#abe0bcd5e591c5664dcd98e4d291519e0">option_parser_register</a>(opp, <span class="stringliteral">&quot;-ptx_opcode_latency_dp&quot;</span>, <a class="code" href="option__parser_8h.html#a1ea719a508955d0748f03bada1ecc8fcae79bed903a3b2e8da41bee1c12e62fd6">OPT_CSTR</a>, &amp;<a class="code" href="cuda-sim_8cc.html#aa59571aabce6bca67062201c0d372b7b">opcode_latency_dp</a>,
<a name="l00080"></a>00080             <span class="stringliteral">&quot;Opcode latencies for double precision floating points &lt;ADD,MAX,MUL,MAD,DIV&gt;&quot;</span>
<a name="l00081"></a>00081             <span class="stringliteral">&quot;Default 8,8,8,8,335&quot;</span>,
<a name="l00082"></a>00082             <span class="stringliteral">&quot;8,8,8,8,335&quot;</span>);
<a name="l00083"></a>00083     <a class="code" href="option__parser_8cc.html#abe0bcd5e591c5664dcd98e4d291519e0">option_parser_register</a>(opp, <span class="stringliteral">&quot;-ptx_opcode_initiation_int&quot;</span>, <a class="code" href="option__parser_8h.html#a1ea719a508955d0748f03bada1ecc8fcae79bed903a3b2e8da41bee1c12e62fd6">OPT_CSTR</a>, &amp;<a class="code" href="cuda-sim_8cc.html#a1b84ca37833ef6ffaca567c951507ad0">opcode_initiation_int</a>,
<a name="l00084"></a>00084             <span class="stringliteral">&quot;Opcode initiation intervals for integers &lt;ADD,MAX,MUL,MAD,DIV&gt;&quot;</span>
<a name="l00085"></a>00085             <span class="stringliteral">&quot;Default 1,1,4,4,32&quot;</span>,
<a name="l00086"></a>00086             <span class="stringliteral">&quot;1,1,4,4,32&quot;</span>);
<a name="l00087"></a>00087     <a class="code" href="option__parser_8cc.html#abe0bcd5e591c5664dcd98e4d291519e0">option_parser_register</a>(opp, <span class="stringliteral">&quot;-ptx_opcode_initiation_fp&quot;</span>, <a class="code" href="option__parser_8h.html#a1ea719a508955d0748f03bada1ecc8fcae79bed903a3b2e8da41bee1c12e62fd6">OPT_CSTR</a>, &amp;<a class="code" href="cuda-sim_8cc.html#a7ec306a6303b409de73764d7977709c9">opcode_initiation_fp</a>,
<a name="l00088"></a>00088             <span class="stringliteral">&quot;Opcode initiation intervals for single precision floating points &lt;ADD,MAX,MUL,MAD,DIV&gt;&quot;</span>
<a name="l00089"></a>00089             <span class="stringliteral">&quot;Default 1,1,1,1,5&quot;</span>,
<a name="l00090"></a>00090             <span class="stringliteral">&quot;1,1,1,1,5&quot;</span>);
<a name="l00091"></a>00091     <a class="code" href="option__parser_8cc.html#abe0bcd5e591c5664dcd98e4d291519e0">option_parser_register</a>(opp, <span class="stringliteral">&quot;-ptx_opcode_initiation_dp&quot;</span>, <a class="code" href="option__parser_8h.html#a1ea719a508955d0748f03bada1ecc8fcae79bed903a3b2e8da41bee1c12e62fd6">OPT_CSTR</a>, &amp;<a class="code" href="cuda-sim_8cc.html#adfe1d21b95eb635da6dfe3fb8e5e95d2">opcode_initiation_dp</a>,
<a name="l00092"></a>00092             <span class="stringliteral">&quot;Opcode initiation intervals for double precision floating points &lt;ADD,MAX,MUL,MAD,DIV&gt;&quot;</span>
<a name="l00093"></a>00093             <span class="stringliteral">&quot;Default 8,8,8,8,130&quot;</span>,
<a name="l00094"></a>00094             <span class="stringliteral">&quot;8,8,8,8,130&quot;</span>);
<a name="l00095"></a>00095     <a class="code" href="option__parser_8cc.html#abe0bcd5e591c5664dcd98e4d291519e0">option_parser_register</a>(opp, <span class="stringliteral">&quot;-cdp_latency&quot;</span>, <a class="code" href="option__parser_8h.html#a1ea719a508955d0748f03bada1ecc8fcae79bed903a3b2e8da41bee1c12e62fd6">OPT_CSTR</a>, &amp;<a class="code" href="cuda-sim_8cc.html#af6c7b8480e2cd8db4a1b0143aafccea3">cdp_latency_str</a>,
<a name="l00096"></a>00096             <span class="stringliteral">&quot;CDP API latency &lt;cudaStreamCreateWithFlags, \</span>
<a name="l00097"></a>00097 <span class="stringliteral">cudaGetParameterBufferV2_init_perWarp, cudaGetParameterBufferV2_perKernel, \</span>
<a name="l00098"></a>00098 <span class="stringliteral">cudaLaunchDeviceV2_init_perWarp, cudaLaunchDevicV2_perKernel&gt;&quot;</span>
<a name="l00099"></a>00099             <span class="stringliteral">&quot;Default 7200,8000,100,12000,1600&quot;</span>,
<a name="l00100"></a>00100             <span class="stringliteral">&quot;7200,8000,100,12000,1600&quot;</span>);
<a name="l00101"></a>00101 }
<a name="l00102"></a>00102 
<a name="l00103"></a>00103 <span class="keyword">static</span> <a class="code" href="abstract__hardware__model_8h.html#a4234d30919c0dcca6fca040a13ad6ae1">address_type</a> <a class="code" href="cuda-sim_8cc.html#af120e92007c89cb8547a22515d6caebd">get_converge_point</a>(<a class="code" href="abstract__hardware__model_8h.html#a4234d30919c0dcca6fca040a13ad6ae1">address_type</a> pc);
<a name="l00104"></a>00104 
<a name="l00105"></a><a class="code" href="classgpgpu__t.html#a0aa48a96902fd21c17b5f84b7d067f6d">00105</a> <span class="keywordtype">void</span> <a class="code" href="classgpgpu__t.html#a0aa48a96902fd21c17b5f84b7d067f6d">gpgpu_t::gpgpu_ptx_sim_bindNameToTexture</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* name, <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structtextureReference.html">textureReference</a>* texref, <span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> readmode, <span class="keywordtype">int</span> ext)
<a name="l00106"></a>00106 {
<a name="l00107"></a>00107    std::string texname(name);
<a name="l00108"></a>00108    <a class="code" href="classgpgpu__t.html#abc90968cc6f162de0664aec703e488cd">m_NameToTextureRef</a>[texname] = texref;
<a name="l00109"></a>00109    <span class="keyword">const</span> <a class="code" href="structtextureReferenceAttr.html">textureReferenceAttr</a> *texAttr = <span class="keyword">new</span> <a class="code" href="structtextureReferenceAttr.html">textureReferenceAttr</a>(texref, dim, (<span class="keyword">enum</span> <a class="code" href="abstract__hardware__model_8h.html#ad9266d02be93809558036ec4f3d5f43d">cudaTextureReadMode</a>)readmode, ext); 
<a name="l00110"></a>00110    <a class="code" href="classgpgpu__t.html#abd87cafeaa3905c26f7427b1347cfe80">m_TextureRefToAttribute</a>[texref] = texAttr; 
<a name="l00111"></a>00111 }
<a name="l00112"></a>00112 
<a name="l00113"></a><a class="code" href="classgpgpu__t.html#a3d2576ab4063c0c349df07b8d8fc83b5">00113</a> <span class="keyword">const</span> <span class="keywordtype">char</span>* <a class="code" href="classgpgpu__t.html#a3d2576ab4063c0c349df07b8d8fc83b5">gpgpu_t::gpgpu_ptx_sim_findNamefromTexture</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structtextureReference.html">textureReference</a>* texref)
<a name="l00114"></a>00114 {
<a name="l00115"></a>00115    std::map&lt;std::string, const struct textureReference*&gt;::iterator itr = <a class="code" href="classgpgpu__t.html#abc90968cc6f162de0664aec703e488cd">m_NameToTextureRef</a>.begin();
<a name="l00116"></a>00116    <span class="keywordflow">while</span> (itr != <a class="code" href="classgpgpu__t.html#abc90968cc6f162de0664aec703e488cd">m_NameToTextureRef</a>.end()) {
<a name="l00117"></a>00117       <span class="keywordflow">if</span> ((*itr).second == texref) {
<a name="l00118"></a>00118          <span class="keyword">const</span> <span class="keywordtype">char</span> *p = ((*itr).first).c_str();
<a name="l00119"></a>00119          <span class="keywordflow">return</span> p;
<a name="l00120"></a>00120       }
<a name="l00121"></a>00121       itr++;
<a name="l00122"></a>00122    }
<a name="l00123"></a>00123    <span class="keywordflow">return</span> NULL;
<a name="l00124"></a>00124 }
<a name="l00125"></a>00125 
<a name="l00126"></a><a class="code" href="cuda-sim_8cc.html#ac1168b91fd843df81ad73bba8b72a380">00126</a> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="cuda-sim_8cc.html#ac1168b91fd843df81ad73bba8b72a380">intLOGB2</a>( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> v ) {
<a name="l00127"></a>00127    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> shift;
<a name="l00128"></a>00128    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> r;
<a name="l00129"></a>00129 
<a name="l00130"></a>00130    r = 0;
<a name="l00131"></a>00131 
<a name="l00132"></a>00132    shift = (( v &amp; 0xFFFF0000) != 0 ) &lt;&lt; 4; v &gt;&gt;= shift; r |= shift;
<a name="l00133"></a>00133    shift = (( v &amp; 0xFF00    ) != 0 ) &lt;&lt; 3; v &gt;&gt;= shift; r |= shift;
<a name="l00134"></a>00134    shift = (( v &amp; 0xF0      ) != 0 ) &lt;&lt; 2; v &gt;&gt;= shift; r |= shift;
<a name="l00135"></a>00135    shift = (( v &amp; 0xC       ) != 0 ) &lt;&lt; 1; v &gt;&gt;= shift; r |= shift;
<a name="l00136"></a>00136    shift = (( v &amp; 0x2       ) != 0 ) &lt;&lt; 0; v &gt;&gt;= shift; r |= shift;
<a name="l00137"></a>00137 
<a name="l00138"></a>00138    <span class="keywordflow">return</span> r;
<a name="l00139"></a>00139 }
<a name="l00140"></a>00140 
<a name="l00141"></a><a class="code" href="classgpgpu__t.html#addc8bd641c1e61968b4350c2348f7364">00141</a> <span class="keywordtype">void</span> <a class="code" href="classgpgpu__t.html#addc8bd641c1e61968b4350c2348f7364">gpgpu_t::gpgpu_ptx_sim_bindTextureToArray</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structtextureReference.html">textureReference</a>* texref, <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structcudaArray.html">cudaArray</a>* array)
<a name="l00142"></a>00142 {
<a name="l00143"></a>00143    <a class="code" href="classgpgpu__t.html#ad20904c628b8adbec3b95900899f9e48">m_TextureRefToCudaArray</a>[texref] = array;
<a name="l00144"></a>00144    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> texel_size_bits = array-&gt;<a class="code" href="structcudaArray.html#ae0c894d6366539846b6551c2f2a3d155">desc</a>.<a class="code" href="structcudaChannelFormatDesc.html#a06089c5a407a2cbd6ea05e5a39b19d69">w</a> + array-&gt;<a class="code" href="structcudaArray.html#ae0c894d6366539846b6551c2f2a3d155">desc</a>.<a class="code" href="structcudaChannelFormatDesc.html#a70dede802100e2acd9f334326e9d7926">x</a> + array-&gt;<a class="code" href="structcudaArray.html#ae0c894d6366539846b6551c2f2a3d155">desc</a>.<a class="code" href="structcudaChannelFormatDesc.html#a6570793c6567d0c704e8e8943ccaec43">y</a> + array-&gt;<a class="code" href="structcudaArray.html#ae0c894d6366539846b6551c2f2a3d155">desc</a>.<a class="code" href="structcudaChannelFormatDesc.html#ae371d37d940d2397139b0a3b7302f51a">z</a>;
<a name="l00145"></a>00145    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> texel_size = texel_size_bits/8;
<a name="l00146"></a>00146    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> Tx, Ty;
<a name="l00147"></a>00147    <span class="keywordtype">int</span> r;
<a name="l00148"></a>00148 
<a name="l00149"></a>00149    printf(<span class="stringliteral">&quot;GPGPU-Sim PTX:   texel size = %d\n&quot;</span>, texel_size);
<a name="l00150"></a>00150    printf(<span class="stringliteral">&quot;GPGPU-Sim PTX:   texture cache linesize = %d\n&quot;</span>, <a class="code" href="classgpgpu__t.html#acd9c6cfe9d6588be3720772ec624d0ee">m_function_model_config</a>.<a class="code" href="classgpgpu__functional__sim__config.html#a8b82f9774752cc505fff2a671e915b69">get_texcache_linesize</a>());
<a name="l00151"></a>00151    <span class="comment">//first determine base Tx size for given linesize</span>
<a name="l00152"></a>00152    <span class="keywordflow">switch</span> (<a class="code" href="classgpgpu__t.html#acd9c6cfe9d6588be3720772ec624d0ee">m_function_model_config</a>.<a class="code" href="classgpgpu__functional__sim__config.html#a8b82f9774752cc505fff2a671e915b69">get_texcache_linesize</a>()) {
<a name="l00153"></a>00153    <span class="keywordflow">case</span> 16:  Tx = 4; <span class="keywordflow">break</span>;
<a name="l00154"></a>00154    <span class="keywordflow">case</span> 32:  Tx = 8; <span class="keywordflow">break</span>;
<a name="l00155"></a>00155    <span class="keywordflow">case</span> 64:  Tx = 8; <span class="keywordflow">break</span>;
<a name="l00156"></a>00156    <span class="keywordflow">case</span> 128: Tx = 16; <span class="keywordflow">break</span>;
<a name="l00157"></a>00157    <span class="keywordflow">case</span> 256: Tx = 16; <span class="keywordflow">break</span>;
<a name="l00158"></a>00158    <span class="keywordflow">default</span>:
<a name="l00159"></a>00159       printf(<span class="stringliteral">&quot;GPGPU-Sim PTX:   Line size of %d bytes currently not supported.\n&quot;</span>, <a class="code" href="classgpgpu__t.html#acd9c6cfe9d6588be3720772ec624d0ee">m_function_model_config</a>.<a class="code" href="classgpgpu__functional__sim__config.html#a8b82f9774752cc505fff2a671e915b69">get_texcache_linesize</a>());
<a name="l00160"></a>00160       assert(0);
<a name="l00161"></a>00161       <span class="keywordflow">break</span>;
<a name="l00162"></a>00162    }
<a name="l00163"></a>00163    r = texel_size &gt;&gt; 2;
<a name="l00164"></a>00164    <span class="comment">//modify base Tx size to take into account size of each texel in bytes</span>
<a name="l00165"></a>00165    <span class="keywordflow">while</span> (r != 0) {
<a name="l00166"></a>00166       Tx = Tx &gt;&gt; 1;
<a name="l00167"></a>00167       r = r &gt;&gt; 2;
<a name="l00168"></a>00168    }
<a name="l00169"></a>00169    <span class="comment">//by now, got the correct Tx size, calculate correct Ty size</span>
<a name="l00170"></a>00170    Ty = <a class="code" href="classgpgpu__t.html#acd9c6cfe9d6588be3720772ec624d0ee">m_function_model_config</a>.<a class="code" href="classgpgpu__functional__sim__config.html#a8b82f9774752cc505fff2a671e915b69">get_texcache_linesize</a>()/(Tx*texel_size);
<a name="l00171"></a>00171 
<a name="l00172"></a>00172    printf(<span class="stringliteral">&quot;GPGPU-Sim PTX:   Tx = %d; Ty = %d, Tx_numbits = %d, Ty_numbits = %d\n&quot;</span>, Tx, Ty, <a class="code" href="cuda-sim_8cc.html#ac1168b91fd843df81ad73bba8b72a380">intLOGB2</a>(Tx), <a class="code" href="cuda-sim_8cc.html#ac1168b91fd843df81ad73bba8b72a380">intLOGB2</a>(Ty));
<a name="l00173"></a>00173    printf(<span class="stringliteral">&quot;GPGPU-Sim PTX:   Texel size = %d bytes; texel_size_numbits = %d\n&quot;</span>, texel_size, <a class="code" href="cuda-sim_8cc.html#ac1168b91fd843df81ad73bba8b72a380">intLOGB2</a>(texel_size));
<a name="l00174"></a>00174    printf(<span class="stringliteral">&quot;GPGPU-Sim PTX:   Binding texture to array starting at devPtr32 = 0x%x\n&quot;</span>, array-&gt;<a class="code" href="structcudaArray.html#a1f79cf1367c9c8958d435e0970771ccb">devPtr32</a>);
<a name="l00175"></a>00175    printf(<span class="stringliteral">&quot;GPGPU-Sim PTX:   Texel size = %d bytes\n&quot;</span>, texel_size);
<a name="l00176"></a>00176    <span class="keyword">struct </span><a class="code" href="structtextureInfo.html">textureInfo</a>* texInfo = (<span class="keyword">struct </span><a class="code" href="structtextureInfo.html">textureInfo</a>*) malloc(<span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structtextureInfo.html">textureInfo</a>)); 
<a name="l00177"></a>00177    texInfo-&gt;<a class="code" href="structtextureInfo.html#a0aa8b1c9cc415635b36df921ca69aed2">Tx</a> = Tx;
<a name="l00178"></a>00178    texInfo-&gt;<a class="code" href="structtextureInfo.html#a5a66ebbeca4dfa2e6c64705aaab7ca73">Ty</a> = Ty;
<a name="l00179"></a>00179    texInfo-&gt;<a class="code" href="structtextureInfo.html#af07ad29cd8de973a2e56b59ef3349acf">Tx_numbits</a> = <a class="code" href="cuda-sim_8cc.html#ac1168b91fd843df81ad73bba8b72a380">intLOGB2</a>(Tx);
<a name="l00180"></a>00180    texInfo-&gt;<a class="code" href="structtextureInfo.html#afe2bcb32945ed4186e4025623ef9fcc0">Ty_numbits</a> = <a class="code" href="cuda-sim_8cc.html#ac1168b91fd843df81ad73bba8b72a380">intLOGB2</a>(Ty);
<a name="l00181"></a>00181    texInfo-&gt;<a class="code" href="structtextureInfo.html#a4b70a38adb71dec17257c00c5d03f01d">texel_size</a> = texel_size;
<a name="l00182"></a>00182    texInfo-&gt;<a class="code" href="structtextureInfo.html#a2821d0fc73bb86924987039a3c2b0724">texel_size_numbits</a> = <a class="code" href="cuda-sim_8cc.html#ac1168b91fd843df81ad73bba8b72a380">intLOGB2</a>(texel_size);
<a name="l00183"></a>00183    <a class="code" href="classgpgpu__t.html#acc05fa8d18e3af59fd25b6441c1e9dc6">m_TextureRefToTexureInfo</a>[texref] = texInfo;
<a name="l00184"></a>00184 }
<a name="l00185"></a>00185 
<a name="l00186"></a><a class="code" href="cuda-sim_8cc.html#a266a629dd7af2db76fe041ebc2e67534">00186</a> <span class="keywordtype">unsigned</span> <a class="code" href="cuda-sim_8cc.html#a266a629dd7af2db76fe041ebc2e67534">g_assemble_code_next_pc</a>=0; 
<a name="l00187"></a><a class="code" href="cuda-sim_8cc.html#a211215b94814ab66fe7ce1a1f7000238">00187</a> std::map&lt;unsigned,function_info*&gt; <a class="code" href="cuda-sim_8cc.html#a211215b94814ab66fe7ce1a1f7000238">g_pc_to_finfo</a>;
<a name="l00188"></a>00188 std::vector&lt;ptx_instruction*&gt; <a class="code" href="classfunction__info.html#a1d2b61af3d3b96f23349b79106fdf635">function_info::s_g_pc_to_insn</a>;
<a name="l00189"></a>00189 
<a name="l00190"></a>00190 <span class="preprocessor">#define MAX_INST_SIZE 8 </span><span class="comment">/*bytes*/</span>
<a name="l00191"></a>00191 
<a name="l00192"></a><a class="code" href="classfunction__info.html#aa3daa9d8a55f16dd577998abc8c52127">00192</a> <span class="keywordtype">void</span> <a class="code" href="classfunction__info.html#aa3daa9d8a55f16dd577998abc8c52127">function_info::ptx_assemble</a>()
<a name="l00193"></a>00193 {
<a name="l00194"></a>00194    <span class="keywordflow">if</span>( <a class="code" href="classfunction__info.html#ab7b73428d6c8661b7e137a2d4db8ef97">m_assembled</a> ) {
<a name="l00195"></a>00195       <span class="keywordflow">return</span>;
<a name="l00196"></a>00196    }
<a name="l00197"></a>00197 
<a name="l00198"></a>00198    <span class="comment">// get the instructions into instruction memory...</span>
<a name="l00199"></a>00199    <span class="keywordtype">unsigned</span> num_inst = <a class="code" href="classfunction__info.html#ae9bd1ee7c079d7b965efc212d7fc432f">m_instructions</a>.size();
<a name="l00200"></a>00200    <a class="code" href="classfunction__info.html#abdbef664e736277388e26b7fbb9baa5b">m_instr_mem_size</a> = MAX_INST_SIZE*(num_inst+1);
<a name="l00201"></a>00201    <a class="code" href="classfunction__info.html#a85b8a386ef87be6e15119ab79cd48f07">m_instr_mem</a> = <span class="keyword">new</span> <a class="code" href="classptx__instruction.html">ptx_instruction</a>*[ <a class="code" href="classfunction__info.html#abdbef664e736277388e26b7fbb9baa5b">m_instr_mem_size</a> ];
<a name="l00202"></a>00202 
<a name="l00203"></a>00203    printf(<span class="stringliteral">&quot;GPGPU-Sim PTX: instruction assembly for function \&apos;%s\&apos;... &quot;</span>, <a class="code" href="classfunction__info.html#ae429d24ea09e1137b4c9db2dec199748">m_name</a>.c_str() );
<a name="l00204"></a>00204    fflush(stdout);
<a name="l00205"></a>00205    std::list&lt;ptx_instruction*&gt;::iterator <a class="code" href="rng-double_8c.html#aa42a9a9cb6e2b93d7f825c395af871bf">i</a>;
<a name="l00206"></a>00206 
<a name="l00207"></a>00207    <a class="code" href="abstract__hardware__model_8h.html#a92b0c0d30c36a95c916f27a55784ca33">addr_t</a> PC = <a class="code" href="cuda-sim_8cc.html#a266a629dd7af2db76fe041ebc2e67534">g_assemble_code_next_pc</a>; <span class="comment">// globally unique address (across functions)</span>
<a name="l00208"></a>00208    <span class="comment">// start function on an aligned address</span>
<a name="l00209"></a>00209    <span class="keywordflow">for</span>( <span class="keywordtype">unsigned</span> i=0; i &lt; (PC%MAX_INST_SIZE); i++ ) 
<a name="l00210"></a>00210       <a class="code" href="classfunction__info.html#a1d2b61af3d3b96f23349b79106fdf635">s_g_pc_to_insn</a>.push_back((<a class="code" href="classptx__instruction.html">ptx_instruction</a>*)NULL);
<a name="l00211"></a>00211    PC += PC%MAX_INST_SIZE; 
<a name="l00212"></a>00212    <a class="code" href="classfunction__info.html#a3efadb033083643ccdf00df25e8aae8f">m_start_PC</a> = PC;
<a name="l00213"></a>00213 
<a name="l00214"></a>00214    <a class="code" href="abstract__hardware__model_8h.html#a92b0c0d30c36a95c916f27a55784ca33">addr_t</a> <a class="code" href="rng-double_8c.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>=0; <span class="comment">// offset in m_instr_mem</span>
<a name="l00215"></a>00215    <a class="code" href="classfunction__info.html#a1d2b61af3d3b96f23349b79106fdf635">s_g_pc_to_insn</a>.reserve(<a class="code" href="classfunction__info.html#a1d2b61af3d3b96f23349b79106fdf635">s_g_pc_to_insn</a>.size() + MAX_INST_SIZE*<a class="code" href="classfunction__info.html#ae9bd1ee7c079d7b965efc212d7fc432f">m_instructions</a>.size());
<a name="l00216"></a>00216    <span class="keywordflow">for</span> ( i=<a class="code" href="classfunction__info.html#ae9bd1ee7c079d7b965efc212d7fc432f">m_instructions</a>.begin(); i != <a class="code" href="classfunction__info.html#ae9bd1ee7c079d7b965efc212d7fc432f">m_instructions</a>.end(); i++ ) {
<a name="l00217"></a>00217       <a class="code" href="classptx__instruction.html">ptx_instruction</a> *pI = *i;
<a name="l00218"></a>00218       <span class="keywordflow">if</span> ( pI-&gt;<a class="code" href="classptx__instruction.html#a6ff460afd7b94b858cdf75473b4d58d4">is_label</a>() ) {
<a name="l00219"></a>00219          <span class="keyword">const</span> <a class="code" href="classsymbol.html">symbol</a> *l = pI-&gt;<a class="code" href="classptx__instruction.html#af10653719281ea4458d5db977b31d521">get_label</a>();
<a name="l00220"></a>00220          <a class="code" href="classfunction__info.html#a2bec09916e0c597fe47187083475471d">labels</a>[l-&gt;<a class="code" href="classsymbol.html#a280a3f1e3caffd94b10590dbb4259033">name</a>()] = n;
<a name="l00221"></a>00221       } <span class="keywordflow">else</span> {
<a name="l00222"></a>00222          <a class="code" href="cuda-sim_8cc.html#a211215b94814ab66fe7ce1a1f7000238">g_pc_to_finfo</a>[PC] = <span class="keyword">this</span>;
<a name="l00223"></a>00223          m_instr_mem[n] = pI;
<a name="l00224"></a>00224          <a class="code" href="classfunction__info.html#a1d2b61af3d3b96f23349b79106fdf635">s_g_pc_to_insn</a>.push_back(pI);
<a name="l00225"></a>00225          assert(pI == <a class="code" href="classfunction__info.html#a1d2b61af3d3b96f23349b79106fdf635">s_g_pc_to_insn</a>[PC]);
<a name="l00226"></a>00226          pI-&gt;<a class="code" href="classptx__instruction.html#a9e329247798d03711fe083fa697daba0">set_m_instr_mem_index</a>(n);
<a name="l00227"></a>00227          pI-&gt;<a class="code" href="classptx__instruction.html#abec7aa75eb65a81e8f4d007fad2a2810">set_PC</a>(PC);
<a name="l00228"></a>00228          assert( pI-&gt;<a class="code" href="classptx__instruction.html#ae48319891d1b705a1c1a0d20ed0ae88a">inst_size</a>() &lt;= MAX_INST_SIZE );
<a name="l00229"></a>00229          <span class="keywordflow">for</span>( <span class="keywordtype">unsigned</span> i=1; i &lt; pI-&gt;<a class="code" href="classptx__instruction.html#ae48319891d1b705a1c1a0d20ed0ae88a">inst_size</a>(); i++ ) {
<a name="l00230"></a>00230             <a class="code" href="classfunction__info.html#a1d2b61af3d3b96f23349b79106fdf635">s_g_pc_to_insn</a>.push_back((<a class="code" href="classptx__instruction.html">ptx_instruction</a>*)NULL);
<a name="l00231"></a>00231             m_instr_mem[n+i]=NULL;
<a name="l00232"></a>00232          }
<a name="l00233"></a>00233          n  += pI-&gt;<a class="code" href="classptx__instruction.html#ae48319891d1b705a1c1a0d20ed0ae88a">inst_size</a>();
<a name="l00234"></a>00234          PC += pI-&gt;<a class="code" href="classptx__instruction.html#ae48319891d1b705a1c1a0d20ed0ae88a">inst_size</a>();
<a name="l00235"></a>00235       }
<a name="l00236"></a>00236    }
<a name="l00237"></a>00237    <a class="code" href="cuda-sim_8cc.html#a266a629dd7af2db76fe041ebc2e67534">g_assemble_code_next_pc</a>=PC;
<a name="l00238"></a>00238    <span class="keywordflow">for</span> ( <span class="keywordtype">unsigned</span> ii=0; ii &lt; n; ii += m_instr_mem[ii]-&gt;inst_size() ) { <span class="comment">// handle branch instructions</span>
<a name="l00239"></a>00239       <a class="code" href="classptx__instruction.html">ptx_instruction</a> *pI = m_instr_mem[ii];
<a name="l00240"></a>00240       <span class="keywordflow">if</span> ( pI-&gt;<a class="code" href="classptx__instruction.html#a7e1df5ccd2482be6275b3267b6af2d85">get_opcode</a>() == BRA_OP || pI-&gt;<a class="code" href="classptx__instruction.html#a7e1df5ccd2482be6275b3267b6af2d85">get_opcode</a>() == BREAKADDR_OP  || pI-&gt;<a class="code" href="classptx__instruction.html#a7e1df5ccd2482be6275b3267b6af2d85">get_opcode</a>() == CALLP_OP) {
<a name="l00241"></a>00241          <a class="code" href="classoperand__info.html">operand_info</a> &amp;target = pI-&gt;<a class="code" href="classptx__instruction.html#a4cc1761a7c6d58c43e86f3266f42da43">dst</a>(); <span class="comment">//get operand, e.g. target name</span>
<a name="l00242"></a>00242          <span class="keywordflow">if</span> ( <a class="code" href="classfunction__info.html#a2bec09916e0c597fe47187083475471d">labels</a>.find(target.<a class="code" href="classoperand__info.html#ae508fadcabd47ef0a361b1120a6e160d">name</a>()) == <a class="code" href="classfunction__info.html#a2bec09916e0c597fe47187083475471d">labels</a>.end() ) {
<a name="l00243"></a>00243             printf(<span class="stringliteral">&quot;GPGPU-Sim PTX: Loader error (%s:%u): Branch label \&quot;%s\&quot; does not appear in assembly code.&quot;</span>,
<a name="l00244"></a>00244                    pI-&gt;<a class="code" href="classptx__instruction.html#a6c318383901e62008f98e8f370f7e202">source_file</a>(),pI-&gt;<a class="code" href="classptx__instruction.html#aa7417e4758e1dfc4fb5a92030071a040">source_line</a>(), target.<a class="code" href="classoperand__info.html#ae508fadcabd47ef0a361b1120a6e160d">name</a>().c_str() );
<a name="l00245"></a>00245             abort();
<a name="l00246"></a>00246          }
<a name="l00247"></a>00247          <span class="keywordtype">unsigned</span> index = <a class="code" href="classfunction__info.html#a2bec09916e0c597fe47187083475471d">labels</a>[ target.<a class="code" href="classoperand__info.html#ae508fadcabd47ef0a361b1120a6e160d">name</a>() ]; <span class="comment">//determine address from name</span>
<a name="l00248"></a>00248          <span class="keywordtype">unsigned</span> PC = m_instr_mem[index]-&gt;get_PC();
<a name="l00249"></a>00249          <a class="code" href="classfunction__info.html#a3f7023b4692eb867e28747b96b37c413">m_symtab</a>-&gt;<a class="code" href="classsymbol__table.html#a13223728e57132a3bd021e1f81ed94a1">set_label_address</a>( target.<a class="code" href="classoperand__info.html#a90cf6e60e556a54e6ee775a777bfe169">get_symbol</a>(), PC );
<a name="l00250"></a>00250          target.<a class="code" href="classoperand__info.html#a72d998d2e40b007f7dd28301b159dfdf">set_type</a>(<a class="code" href="ptx__ir_8h.html#a90e83ae77725d7ff8733276d9a1d19e4a3d0decf5dab7177ab6b3288b4a9c28fd">label_t</a>);
<a name="l00251"></a>00251       }
<a name="l00252"></a>00252    }
<a name="l00253"></a>00253 
<a name="l00254"></a>00254    printf(<span class="stringliteral">&quot;  done.\n&quot;</span>);
<a name="l00255"></a>00255    fflush(stdout);
<a name="l00256"></a>00256    printf(<span class="stringliteral">&quot;GPGPU-Sim PTX: finding reconvergence points for \&apos;%s\&apos;...\n&quot;</span>, <a class="code" href="classfunction__info.html#ae429d24ea09e1137b4c9db2dec199748">m_name</a>.c_str() );
<a name="l00257"></a>00257 
<a name="l00258"></a>00258    <a class="code" href="classfunction__info.html#a9b682b7b47f5d26496b282af7857a1e6">create_basic_blocks</a>();
<a name="l00259"></a>00259    <a class="code" href="classfunction__info.html#a7c4ca5e328a5a87a8a97878c33355265">connect_basic_blocks</a>();
<a name="l00260"></a>00260    <span class="keywordtype">bool</span> modified = <span class="keyword">false</span>; 
<a name="l00261"></a>00261    <span class="keywordflow">do</span> {
<a name="l00262"></a>00262       <a class="code" href="classfunction__info.html#a21c3f076a7eb699a2f069ea765cde633">find_dominators</a>();
<a name="l00263"></a>00263       <a class="code" href="classfunction__info.html#a438d41b04e4bd47afe1648a6abfac4cb">find_idominators</a>();
<a name="l00264"></a>00264       modified = <a class="code" href="classfunction__info.html#ac0dec7dc31561d935f053cddf018d222">connect_break_targets</a>(); 
<a name="l00265"></a>00265    } <span class="keywordflow">while</span> (modified == <span class="keyword">true</span>);
<a name="l00266"></a>00266 
<a name="l00267"></a>00267    <span class="keywordflow">if</span> ( g_debug_execution&gt;=50 ) {
<a name="l00268"></a>00268       <a class="code" href="classfunction__info.html#a032d885c96611268a09132828c58ee4f">print_basic_blocks</a>();
<a name="l00269"></a>00269       <a class="code" href="classfunction__info.html#af9bc084a7bf2a81cd107b4841e8319ea">print_basic_block_links</a>();
<a name="l00270"></a>00270       <a class="code" href="classfunction__info.html#acd6b8f35eb1086a1a083356cbabee055">print_basic_block_dot</a>();
<a name="l00271"></a>00271    }
<a name="l00272"></a>00272    <span class="keywordflow">if</span> ( g_debug_execution&gt;=2 ) {
<a name="l00273"></a>00273       <a class="code" href="classfunction__info.html#a4e10e8fae470f6d8361ef1feb2bbaf8b">print_dominators</a>();
<a name="l00274"></a>00274    }
<a name="l00275"></a>00275    <a class="code" href="classfunction__info.html#add390c3b3a713ed8ac633dab5455704d">find_postdominators</a>();
<a name="l00276"></a>00276    <a class="code" href="classfunction__info.html#ad16447a328d6f4b4c1a7e0f7b9c50d89">find_ipostdominators</a>();
<a name="l00277"></a>00277    <span class="keywordflow">if</span> ( g_debug_execution&gt;=50 ) {
<a name="l00278"></a>00278       <a class="code" href="classfunction__info.html#af9b46919a34f988fbea6679da4714de3">print_postdominators</a>();
<a name="l00279"></a>00279       <a class="code" href="classfunction__info.html#a1c957f4263b61c1fa3629144d0a4a25a">print_ipostdominators</a>();
<a name="l00280"></a>00280    }
<a name="l00281"></a>00281 
<a name="l00282"></a>00282    printf(<span class="stringliteral">&quot;GPGPU-Sim PTX: pre-decoding instructions for \&apos;%s\&apos;...\n&quot;</span>, <a class="code" href="classfunction__info.html#ae429d24ea09e1137b4c9db2dec199748">m_name</a>.c_str() );
<a name="l00283"></a>00283    <span class="keywordflow">for</span> ( <span class="keywordtype">unsigned</span> ii=0; ii &lt; n; ii += m_instr_mem[ii]-&gt;inst_size() ) { <span class="comment">// handle branch instructions</span>
<a name="l00284"></a>00284       <a class="code" href="classptx__instruction.html">ptx_instruction</a> *pI = m_instr_mem[ii];
<a name="l00285"></a>00285       pI-&gt;<a class="code" href="classptx__instruction.html#a92b6780773bcf1881577803bc18eadee">pre_decode</a>();
<a name="l00286"></a>00286    }
<a name="l00287"></a>00287    printf(<span class="stringliteral">&quot;GPGPU-Sim PTX: ... done pre-decoding instructions for \&apos;%s\&apos;.\n&quot;</span>, <a class="code" href="classfunction__info.html#ae429d24ea09e1137b4c9db2dec199748">m_name</a>.c_str() );
<a name="l00288"></a>00288    fflush(stdout);
<a name="l00289"></a>00289 
<a name="l00290"></a>00290    <a class="code" href="classfunction__info.html#ab7b73428d6c8661b7e137a2d4db8ef97">m_assembled</a> = <span class="keyword">true</span>;
<a name="l00291"></a>00291 }
<a name="l00292"></a>00292 
<a name="l00293"></a><a class="code" href="ptx__sim_8h.html#a2db3cb2d086416a94cf6c1c0193c86fe">00293</a> <a class="code" href="abstract__hardware__model_8h.html#a92b0c0d30c36a95c916f27a55784ca33">addr_t</a> <a class="code" href="cuda-sim_8cc.html#a2db3cb2d086416a94cf6c1c0193c86fe">shared_to_generic</a>( <span class="keywordtype">unsigned</span> smid, <a class="code" href="abstract__hardware__model_8h.html#a92b0c0d30c36a95c916f27a55784ca33">addr_t</a> addr )
<a name="l00294"></a>00294 {
<a name="l00295"></a>00295    assert( addr &lt; SHARED_MEM_SIZE_MAX );
<a name="l00296"></a>00296    <span class="keywordflow">return</span> SHARED_GENERIC_START + smid*SHARED_MEM_SIZE_MAX + addr;
<a name="l00297"></a>00297 }
<a name="l00298"></a>00298 
<a name="l00299"></a><a class="code" href="ptx__sim_8h.html#a9d22c70a712c557a4dd37e0855797e69">00299</a> <a class="code" href="abstract__hardware__model_8h.html#a92b0c0d30c36a95c916f27a55784ca33">addr_t</a> <a class="code" href="cuda-sim_8cc.html#a9d22c70a712c557a4dd37e0855797e69">global_to_generic</a>( <a class="code" href="abstract__hardware__model_8h.html#a92b0c0d30c36a95c916f27a55784ca33">addr_t</a> addr )
<a name="l00300"></a>00300 {
<a name="l00301"></a>00301    <span class="keywordflow">return</span> addr;
<a name="l00302"></a>00302 }
<a name="l00303"></a>00303 
<a name="l00304"></a><a class="code" href="ptx__sim_8h.html#ac3dc2e26eb917451331db93ee1602ffe">00304</a> <span class="keywordtype">bool</span> <a class="code" href="cuda-sim_8cc.html#ac3dc2e26eb917451331db93ee1602ffe">isspace_shared</a>( <span class="keywordtype">unsigned</span> smid, <a class="code" href="abstract__hardware__model_8h.html#a92b0c0d30c36a95c916f27a55784ca33">addr_t</a> addr )
<a name="l00305"></a>00305 {
<a name="l00306"></a>00306    <a class="code" href="abstract__hardware__model_8h.html#a92b0c0d30c36a95c916f27a55784ca33">addr_t</a> start = SHARED_GENERIC_START + smid*SHARED_MEM_SIZE_MAX;
<a name="l00307"></a>00307    <a class="code" href="abstract__hardware__model_8h.html#a92b0c0d30c36a95c916f27a55784ca33">addr_t</a> end = SHARED_GENERIC_START + (smid+1)*SHARED_MEM_SIZE_MAX;
<a name="l00308"></a>00308    <span class="keywordflow">if</span>( (addr &gt;= end) || (addr &lt; start) ) 
<a name="l00309"></a>00309       <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00310"></a>00310    <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00311"></a>00311 }
<a name="l00312"></a>00312 
<a name="l00313"></a><a class="code" href="ptx__sim_8h.html#a3f11fc9a91c46bedd3588d198e491473">00313</a> <span class="keywordtype">bool</span> <a class="code" href="cuda-sim_8cc.html#a3f11fc9a91c46bedd3588d198e491473">isspace_global</a>( <a class="code" href="abstract__hardware__model_8h.html#a92b0c0d30c36a95c916f27a55784ca33">addr_t</a> addr )
<a name="l00314"></a>00314 {
<a name="l00315"></a>00315    <span class="keywordflow">return</span> (addr &gt;= GLOBAL_HEAP_START) || (addr &lt; STATIC_ALLOC_LIMIT);
<a name="l00316"></a>00316 }
<a name="l00317"></a>00317 
<a name="l00318"></a><a class="code" href="ptx__sim_8h.html#adc619997188fa5d771ace549b2700aa7">00318</a> <a class="code" href="classmemory__space__t.html">memory_space_t</a> <a class="code" href="cuda-sim_8cc.html#adc619997188fa5d771ace549b2700aa7">whichspace</a>( <a class="code" href="abstract__hardware__model_8h.html#a92b0c0d30c36a95c916f27a55784ca33">addr_t</a> addr )
<a name="l00319"></a>00319 {
<a name="l00320"></a>00320    <span class="keywordflow">if</span>( (addr &gt;= GLOBAL_HEAP_START) || (addr &lt; STATIC_ALLOC_LIMIT) ) {
<a name="l00321"></a>00321       <span class="keywordflow">return</span> <a class="code" href="abstract__hardware__model_8h.html#a1ad2169aaa8924fcc552447f38a5b58cade54d01d283e68c3e9c5b8d75b85e49e">global_space</a>;
<a name="l00322"></a>00322    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( addr &gt;= SHARED_GENERIC_START ) {
<a name="l00323"></a>00323       <span class="keywordflow">return</span> <a class="code" href="abstract__hardware__model_8h.html#a1ad2169aaa8924fcc552447f38a5b58cae27eca92c2d1dbb9adb9010e3fb7991c">shared_space</a>;
<a name="l00324"></a>00324    } <span class="keywordflow">else</span> {
<a name="l00325"></a>00325       <span class="keywordflow">return</span> <a class="code" href="abstract__hardware__model_8h.html#a1ad2169aaa8924fcc552447f38a5b58ca133ba819812b7d97221aed15cb830967">local_space</a>;
<a name="l00326"></a>00326    }
<a name="l00327"></a>00327 }
<a name="l00328"></a>00328 
<a name="l00329"></a><a class="code" href="ptx__sim_8h.html#a35eba6b8cdc2d7ec759b29fa0b9f3fa1">00329</a> <a class="code" href="abstract__hardware__model_8h.html#a92b0c0d30c36a95c916f27a55784ca33">addr_t</a> <a class="code" href="cuda-sim_8cc.html#a35eba6b8cdc2d7ec759b29fa0b9f3fa1">generic_to_shared</a>( <span class="keywordtype">unsigned</span> smid, <a class="code" href="abstract__hardware__model_8h.html#a92b0c0d30c36a95c916f27a55784ca33">addr_t</a> addr )
<a name="l00330"></a>00330 {
<a name="l00331"></a>00331    assert(<a class="code" href="cuda-sim_8cc.html#ac3dc2e26eb917451331db93ee1602ffe">isspace_shared</a>(smid,addr));
<a name="l00332"></a>00332    <span class="keywordflow">return</span> addr - (SHARED_GENERIC_START + smid*SHARED_MEM_SIZE_MAX);
<a name="l00333"></a>00333 }
<a name="l00334"></a>00334 
<a name="l00335"></a><a class="code" href="ptx__sim_8h.html#a1b860df34fdd0b974b965fcec7f77c35">00335</a> <a class="code" href="abstract__hardware__model_8h.html#a92b0c0d30c36a95c916f27a55784ca33">addr_t</a> <a class="code" href="cuda-sim_8cc.html#a1b860df34fdd0b974b965fcec7f77c35">local_to_generic</a>( <span class="keywordtype">unsigned</span> smid, <span class="keywordtype">unsigned</span> hwtid, <a class="code" href="abstract__hardware__model_8h.html#a92b0c0d30c36a95c916f27a55784ca33">addr_t</a> addr )
<a name="l00336"></a>00336 {
<a name="l00337"></a>00337    assert(addr &lt; LOCAL_MEM_SIZE_MAX); 
<a name="l00338"></a>00338    <span class="keywordflow">return</span> LOCAL_GENERIC_START + (TOTAL_LOCAL_MEM_PER_SM * smid) + (LOCAL_MEM_SIZE_MAX * hwtid) + addr;
<a name="l00339"></a>00339 }
<a name="l00340"></a>00340 
<a name="l00341"></a><a class="code" href="ptx__sim_8h.html#a23479f4255c50747df7595f125d0012a">00341</a> <span class="keywordtype">bool</span> <a class="code" href="cuda-sim_8cc.html#a23479f4255c50747df7595f125d0012a">isspace_local</a>( <span class="keywordtype">unsigned</span> smid, <span class="keywordtype">unsigned</span> hwtid, <a class="code" href="abstract__hardware__model_8h.html#a92b0c0d30c36a95c916f27a55784ca33">addr_t</a> addr )
<a name="l00342"></a>00342 {
<a name="l00343"></a>00343    <a class="code" href="abstract__hardware__model_8h.html#a92b0c0d30c36a95c916f27a55784ca33">addr_t</a> start = LOCAL_GENERIC_START + (TOTAL_LOCAL_MEM_PER_SM * smid) + (LOCAL_MEM_SIZE_MAX * hwtid);
<a name="l00344"></a>00344    <a class="code" href="abstract__hardware__model_8h.html#a92b0c0d30c36a95c916f27a55784ca33">addr_t</a> end   = LOCAL_GENERIC_START + (TOTAL_LOCAL_MEM_PER_SM * smid) + (LOCAL_MEM_SIZE_MAX * (hwtid+1));
<a name="l00345"></a>00345    <span class="keywordflow">if</span>( (addr &gt;= end) || (addr &lt; start) ) 
<a name="l00346"></a>00346       <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00347"></a>00347    <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00348"></a>00348 }
<a name="l00349"></a>00349 
<a name="l00350"></a><a class="code" href="ptx__sim_8h.html#afdfedaa298dbf33d4b846e775e293d23">00350</a> <a class="code" href="abstract__hardware__model_8h.html#a92b0c0d30c36a95c916f27a55784ca33">addr_t</a> <a class="code" href="cuda-sim_8cc.html#afdfedaa298dbf33d4b846e775e293d23">generic_to_local</a>( <span class="keywordtype">unsigned</span> smid, <span class="keywordtype">unsigned</span> hwtid, <a class="code" href="abstract__hardware__model_8h.html#a92b0c0d30c36a95c916f27a55784ca33">addr_t</a> addr )
<a name="l00351"></a>00351 {
<a name="l00352"></a>00352    assert(<a class="code" href="cuda-sim_8cc.html#a23479f4255c50747df7595f125d0012a">isspace_local</a>(smid,hwtid,addr));
<a name="l00353"></a>00353    <span class="keywordflow">return</span> addr - (LOCAL_GENERIC_START + (TOTAL_LOCAL_MEM_PER_SM * smid) + (LOCAL_MEM_SIZE_MAX * hwtid));
<a name="l00354"></a>00354 }
<a name="l00355"></a>00355 
<a name="l00356"></a><a class="code" href="ptx__sim_8h.html#a8f2b2d24aeb6bb7d520ee819c0c22fa5">00356</a> <a class="code" href="abstract__hardware__model_8h.html#a92b0c0d30c36a95c916f27a55784ca33">addr_t</a> <a class="code" href="cuda-sim_8cc.html#a8f2b2d24aeb6bb7d520ee819c0c22fa5">generic_to_global</a>( <a class="code" href="abstract__hardware__model_8h.html#a92b0c0d30c36a95c916f27a55784ca33">addr_t</a> addr )
<a name="l00357"></a>00357 {
<a name="l00358"></a>00358    <span class="keywordflow">return</span> addr;
<a name="l00359"></a>00359 }
<a name="l00360"></a>00360 
<a name="l00361"></a>00361 
<a name="l00362"></a><a class="code" href="classgpgpu__t.html#a7368bb34f0afb9fa1894e1535014df46">00362</a> <span class="keywordtype">void</span>* <a class="code" href="classgpgpu__t.html#a7368bb34f0afb9fa1894e1535014df46">gpgpu_t::gpu_malloc</a>( <span class="keywordtype">size_t</span> size )
<a name="l00363"></a>00363 {
<a name="l00364"></a>00364    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span> result = <a class="code" href="classgpgpu__t.html#a6f167b98567e16740d6bbec64d6f5ebe">m_dev_malloc</a>;
<a name="l00365"></a>00365    <span class="keywordflow">if</span>(g_debug_execution &gt;= 3) {
<a name="l00366"></a>00366       printf(<span class="stringliteral">&quot;GPGPU-Sim PTX: allocating %zu bytes on GPU starting at address 0x%Lx\n&quot;</span>, size, <a class="code" href="classgpgpu__t.html#a6f167b98567e16740d6bbec64d6f5ebe">m_dev_malloc</a> );
<a name="l00367"></a>00367       fflush(stdout);
<a name="l00368"></a>00368    }
<a name="l00369"></a>00369    <a class="code" href="classgpgpu__t.html#a6f167b98567e16740d6bbec64d6f5ebe">m_dev_malloc</a> += size;
<a name="l00370"></a>00370    <span class="keywordflow">if</span> (size%256) <a class="code" href="classgpgpu__t.html#a6f167b98567e16740d6bbec64d6f5ebe">m_dev_malloc</a> += (256 - size%256); <span class="comment">//align to 256 byte boundaries</span>
<a name="l00371"></a>00371    <span class="keywordflow">return</span>(<span class="keywordtype">void</span>*) result;
<a name="l00372"></a>00372 }
<a name="l00373"></a>00373 
<a name="l00374"></a><a class="code" href="classgpgpu__t.html#afc3165b3869cdc121c35e960dc188a33">00374</a> <span class="keywordtype">void</span>* <a class="code" href="classgpgpu__t.html#afc3165b3869cdc121c35e960dc188a33">gpgpu_t::gpu_mallocarray</a>( <span class="keywordtype">size_t</span> size )
<a name="l00375"></a>00375 {
<a name="l00376"></a>00376    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span> result = <a class="code" href="classgpgpu__t.html#a6f167b98567e16740d6bbec64d6f5ebe">m_dev_malloc</a>;
<a name="l00377"></a>00377    <span class="keywordflow">if</span>(g_debug_execution &gt;= 3) {
<a name="l00378"></a>00378       printf(<span class="stringliteral">&quot;GPGPU-Sim PTX: allocating %zu bytes on GPU starting at address 0x%Lx\n&quot;</span>, size, <a class="code" href="classgpgpu__t.html#a6f167b98567e16740d6bbec64d6f5ebe">m_dev_malloc</a> );
<a name="l00379"></a>00379       fflush(stdout);
<a name="l00380"></a>00380    }
<a name="l00381"></a>00381    <a class="code" href="classgpgpu__t.html#a6f167b98567e16740d6bbec64d6f5ebe">m_dev_malloc</a> += size;
<a name="l00382"></a>00382    <span class="keywordflow">if</span> (size%256) <a class="code" href="classgpgpu__t.html#a6f167b98567e16740d6bbec64d6f5ebe">m_dev_malloc</a> += (256 - size%256); <span class="comment">//align to 256 byte boundaries</span>
<a name="l00383"></a>00383    <span class="keywordflow">return</span>(<span class="keywordtype">void</span>*) result;
<a name="l00384"></a>00384 }
<a name="l00385"></a>00385 
<a name="l00386"></a>00386 
<a name="l00387"></a><a class="code" href="classgpgpu__t.html#aaf7b32025107b1c53e8939f39d5a8980">00387</a> <span class="keywordtype">void</span> <a class="code" href="classgpgpu__t.html#aaf7b32025107b1c53e8939f39d5a8980">gpgpu_t::memcpy_to_gpu</a>( <span class="keywordtype">size_t</span> dst_start_addr, <span class="keyword">const</span> <span class="keywordtype">void</span> *src, <span class="keywordtype">size_t</span> count )
<a name="l00388"></a>00388 {
<a name="l00389"></a>00389    <span class="keywordflow">if</span>(g_debug_execution &gt;= 3) {
<a name="l00390"></a>00390       printf(<span class="stringliteral">&quot;GPGPU-Sim PTX: copying %zu bytes from CPU[0x%Lx] to GPU[0x%Lx] ... &quot;</span>, count, (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span>) src, (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span>) dst_start_addr );
<a name="l00391"></a>00391       fflush(stdout);
<a name="l00392"></a>00392    }
<a name="l00393"></a>00393    <span class="keywordtype">char</span> *src_data = (<span class="keywordtype">char</span>*)src;
<a name="l00394"></a>00394    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="rng-double_8c.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>=0; <a class="code" href="rng-double_8c.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a> &lt; count; <a class="code" href="rng-double_8c.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a> ++ ) 
<a name="l00395"></a>00395       <a class="code" href="classgpgpu__t.html#aeb3e6544de57025726c7a64838eefb92">m_global_mem</a>-&gt;<a class="code" href="classmemory__space.html#acc4d70cea1a6c55b70c527b6c80d62a5">write</a>(dst_start_addr+<a class="code" href="rng-double_8c.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>,1, src_data+<a class="code" href="rng-double_8c.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>,NULL,NULL);
<a name="l00396"></a>00396    <span class="keywordflow">if</span>(g_debug_execution &gt;= 3) {
<a name="l00397"></a>00397       printf( <span class="stringliteral">&quot; done.\n&quot;</span>);
<a name="l00398"></a>00398       fflush(stdout);
<a name="l00399"></a>00399    }
<a name="l00400"></a>00400 }
<a name="l00401"></a>00401 
<a name="l00402"></a><a class="code" href="classgpgpu__t.html#a2e9eb56ef7444781e563a3d836557245">00402</a> <span class="keywordtype">void</span> <a class="code" href="classgpgpu__t.html#a2e9eb56ef7444781e563a3d836557245">gpgpu_t::memcpy_from_gpu</a>( <span class="keywordtype">void</span> *dst, <span class="keywordtype">size_t</span> src_start_addr, <span class="keywordtype">size_t</span> count )
<a name="l00403"></a>00403 {
<a name="l00404"></a>00404    <span class="keywordflow">if</span>(g_debug_execution &gt;= 3) {
<a name="l00405"></a>00405       printf(<span class="stringliteral">&quot;GPGPU-Sim PTX: copying %zu bytes from GPU[0x%Lx] to CPU[0x%Lx] ...&quot;</span>, count, (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span>) src_start_addr, (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span>) dst );
<a name="l00406"></a>00406       fflush(stdout);
<a name="l00407"></a>00407    }
<a name="l00408"></a>00408    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *dst_data = (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*)dst;
<a name="l00409"></a>00409    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="rng-double_8c.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>=0; <a class="code" href="rng-double_8c.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a> &lt; count; <a class="code" href="rng-double_8c.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a> ++ ) 
<a name="l00410"></a>00410       <a class="code" href="classgpgpu__t.html#aeb3e6544de57025726c7a64838eefb92">m_global_mem</a>-&gt;<a class="code" href="classmemory__space.html#ae1b293a67d5cebb90d3df4482c83f3a1">read</a>(src_start_addr+<a class="code" href="rng-double_8c.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>,1,dst_data+<a class="code" href="rng-double_8c.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>);
<a name="l00411"></a>00411    <span class="keywordflow">if</span>(g_debug_execution &gt;= 3) {
<a name="l00412"></a>00412       printf( <span class="stringliteral">&quot; done.\n&quot;</span>);
<a name="l00413"></a>00413       fflush(stdout);
<a name="l00414"></a>00414    }
<a name="l00415"></a>00415 }
<a name="l00416"></a>00416 
<a name="l00417"></a><a class="code" href="classgpgpu__t.html#a118cf20fa0de5d8584929f18693eadc0">00417</a> <span class="keywordtype">void</span> <a class="code" href="classgpgpu__t.html#a118cf20fa0de5d8584929f18693eadc0">gpgpu_t::memcpy_gpu_to_gpu</a>( <span class="keywordtype">size_t</span> dst, <span class="keywordtype">size_t</span> src, <span class="keywordtype">size_t</span> count )
<a name="l00418"></a>00418 {
<a name="l00419"></a>00419    <span class="keywordflow">if</span>(g_debug_execution &gt;= 3) {
<a name="l00420"></a>00420       printf(<span class="stringliteral">&quot;GPGPU-Sim PTX: copying %zu bytes from GPU[0x%Lx] to GPU[0x%Lx] ...&quot;</span>, count,
<a name="l00421"></a>00421           (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span>) src, (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span>) dst );
<a name="l00422"></a>00422       fflush(stdout);
<a name="l00423"></a>00423    }
<a name="l00424"></a>00424    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="rng-double_8c.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>=0; <a class="code" href="rng-double_8c.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a> &lt; count; <a class="code" href="rng-double_8c.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a> ++ ) {
<a name="l00425"></a>00425       <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> tmp;
<a name="l00426"></a>00426       <a class="code" href="classgpgpu__t.html#aeb3e6544de57025726c7a64838eefb92">m_global_mem</a>-&gt;<a class="code" href="classmemory__space.html#ae1b293a67d5cebb90d3df4482c83f3a1">read</a>(src+<a class="code" href="rng-double_8c.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>,1,&amp;tmp); 
<a name="l00427"></a>00427       <a class="code" href="classgpgpu__t.html#aeb3e6544de57025726c7a64838eefb92">m_global_mem</a>-&gt;<a class="code" href="classmemory__space.html#acc4d70cea1a6c55b70c527b6c80d62a5">write</a>(dst+<a class="code" href="rng-double_8c.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>,1, &amp;tmp,NULL,NULL);
<a name="l00428"></a>00428    }
<a name="l00429"></a>00429    <span class="keywordflow">if</span>(g_debug_execution &gt;= 3) {
<a name="l00430"></a>00430       printf( <span class="stringliteral">&quot; done.\n&quot;</span>);
<a name="l00431"></a>00431       fflush(stdout);
<a name="l00432"></a>00432    }
<a name="l00433"></a>00433 }
<a name="l00434"></a>00434 
<a name="l00435"></a><a class="code" href="classgpgpu__t.html#afb966ed5a0e66c6bf935a3ebcfc31e3a">00435</a> <span class="keywordtype">void</span> <a class="code" href="classgpgpu__t.html#afb966ed5a0e66c6bf935a3ebcfc31e3a">gpgpu_t::gpu_memset</a>( <span class="keywordtype">size_t</span> dst_start_addr, <span class="keywordtype">int</span> c, <span class="keywordtype">size_t</span> count )
<a name="l00436"></a>00436 {
<a name="l00437"></a>00437    <span class="keywordflow">if</span>(g_debug_execution &gt;= 3) {
<a name="l00438"></a>00438       printf(<span class="stringliteral">&quot;GPGPU-Sim PTX: setting %zu bytes of memory to 0x%x starting at 0x%Lx... &quot;</span>,
<a name="l00439"></a>00439           count, (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>) c, (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span>) dst_start_addr );
<a name="l00440"></a>00440       fflush(stdout);
<a name="l00441"></a>00441    }
<a name="l00442"></a>00442    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> c_value = (<span class="keywordtype">unsigned</span> char)c;
<a name="l00443"></a>00443    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="rng-double_8c.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>=0; <a class="code" href="rng-double_8c.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a> &lt; count; <a class="code" href="rng-double_8c.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a> ++ ) 
<a name="l00444"></a>00444       <a class="code" href="classgpgpu__t.html#aeb3e6544de57025726c7a64838eefb92">m_global_mem</a>-&gt;<a class="code" href="classmemory__space.html#acc4d70cea1a6c55b70c527b6c80d62a5">write</a>(dst_start_addr+<a class="code" href="rng-double_8c.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>,1,&amp;c_value,NULL,NULL);
<a name="l00445"></a>00445    <span class="keywordflow">if</span>(g_debug_execution &gt;= 3) {
<a name="l00446"></a>00446       printf( <span class="stringliteral">&quot; done.\n&quot;</span>);
<a name="l00447"></a>00447       fflush(stdout);
<a name="l00448"></a>00448    }
<a name="l00449"></a>00449 }
<a name="l00450"></a>00450 
<a name="l00451"></a><a class="code" href="cuda-sim_8h.html#a828660ddae007d7730f4340f644962a3">00451</a> <span class="keywordtype">void</span> <a class="code" href="cuda-sim_8cc.html#a828660ddae007d7730f4340f644962a3">ptx_print_insn</a>( <a class="code" href="abstract__hardware__model_8h.html#a4234d30919c0dcca6fca040a13ad6ae1">address_type</a> pc, FILE *fp )
<a name="l00452"></a>00452 {
<a name="l00453"></a>00453    std::map&lt;unsigned,function_info*&gt;::iterator f = <a class="code" href="cuda-sim_8cc.html#a211215b94814ab66fe7ce1a1f7000238">g_pc_to_finfo</a>.find(pc);
<a name="l00454"></a>00454    <span class="keywordflow">if</span>( f == <a class="code" href="cuda-sim_8cc.html#a211215b94814ab66fe7ce1a1f7000238">g_pc_to_finfo</a>.end() ) {
<a name="l00455"></a>00455        fprintf(fp,<span class="stringliteral">&quot;&lt;no instruction at address 0x%x&gt;&quot;</span>, pc );
<a name="l00456"></a>00456        <span class="keywordflow">return</span>;
<a name="l00457"></a>00457    }
<a name="l00458"></a>00458    <a class="code" href="classfunction__info.html">function_info</a> *finfo = f-&gt;second;
<a name="l00459"></a>00459    assert( finfo );
<a name="l00460"></a>00460    finfo-&gt;<a class="code" href="classfunction__info.html#a155a4e531c10c94a222aac22b67dfc41">print_insn</a>(pc,fp);
<a name="l00461"></a>00461 }
<a name="l00462"></a>00462 
<a name="l00463"></a><a class="code" href="cuda-sim_8h.html#abd22a5c6610e1c731ec5f36810cc1857">00463</a> std::string <a class="code" href="cuda-sim_8cc.html#abd22a5c6610e1c731ec5f36810cc1857">ptx_get_insn_str</a>( <a class="code" href="abstract__hardware__model_8h.html#a4234d30919c0dcca6fca040a13ad6ae1">address_type</a> pc )
<a name="l00464"></a>00464 {
<a name="l00465"></a>00465    std::map&lt;unsigned,function_info*&gt;::iterator f = <a class="code" href="cuda-sim_8cc.html#a211215b94814ab66fe7ce1a1f7000238">g_pc_to_finfo</a>.find(pc);
<a name="l00466"></a>00466    <span class="keywordflow">if</span>( f == <a class="code" href="cuda-sim_8cc.html#a211215b94814ab66fe7ce1a1f7000238">g_pc_to_finfo</a>.end() ) {
<a name="l00467"></a>00467 <span class="preprocessor">       #define STR_SIZE 255</span>
<a name="l00468"></a>00468 <span class="preprocessor"></span>       <span class="keywordtype">char</span> buff[STR_SIZE];
<a name="l00469"></a>00469        buff[STR_SIZE - 1] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l00470"></a>00470        snprintf(buff, STR_SIZE,<span class="stringliteral">&quot;&lt;no instruction at address 0x%x&gt;&quot;</span>, pc );
<a name="l00471"></a>00471        <span class="keywordflow">return</span> std::string(buff);
<a name="l00472"></a>00472    }
<a name="l00473"></a>00473    <a class="code" href="classfunction__info.html">function_info</a> *finfo = f-&gt;second;
<a name="l00474"></a>00474    assert( finfo );
<a name="l00475"></a>00475    <span class="keywordflow">return</span> finfo-&gt;<a class="code" href="classfunction__info.html#a38deb45ff1d238d855055c04c98d498d">get_insn_str</a>(pc);
<a name="l00476"></a>00476 }
<a name="l00477"></a>00477 
<a name="l00478"></a><a class="code" href="classptx__instruction.html#a1a1dd8d920cb92f56b8f37e2bf155b15">00478</a> <span class="keywordtype">void</span> <a class="code" href="classptx__instruction.html#a1a1dd8d920cb92f56b8f37e2bf155b15">ptx_instruction::set_fp_or_int_archop</a>(){
<a name="l00479"></a>00479     <a class="code" href="classinst__t.html#ac7a035218233cd400ee53e07292b3e19">oprnd_type</a>=<a class="code" href="abstract__hardware__model_8h.html#a2f268fb920f58fceda179b2a908e48fda4ce321bf19c8bf9689997d735424614c">UN_OP</a>;
<a name="l00480"></a>00480     <span class="keywordflow">if</span>((<a class="code" href="classptx__instruction.html#a701349bc06eb65b5c49a83140bfc8936">m_opcode</a> == MEMBAR_OP)||(<a class="code" href="classptx__instruction.html#a701349bc06eb65b5c49a83140bfc8936">m_opcode</a> == SSY_OP )||(<a class="code" href="classptx__instruction.html#a701349bc06eb65b5c49a83140bfc8936">m_opcode</a> == BRA_OP) || (<a class="code" href="classptx__instruction.html#a701349bc06eb65b5c49a83140bfc8936">m_opcode</a> == BAR_OP) || (<a class="code" href="classptx__instruction.html#a701349bc06eb65b5c49a83140bfc8936">m_opcode</a> == RET_OP) || (<a class="code" href="classptx__instruction.html#a701349bc06eb65b5c49a83140bfc8936">m_opcode</a> == RETP_OP) || (<a class="code" href="classptx__instruction.html#a701349bc06eb65b5c49a83140bfc8936">m_opcode</a> == NOP_OP) || (<a class="code" href="classptx__instruction.html#a701349bc06eb65b5c49a83140bfc8936">m_opcode</a> == EXIT_OP) || (<a class="code" href="classptx__instruction.html#a701349bc06eb65b5c49a83140bfc8936">m_opcode</a> == CALLP_OP) || (<a class="code" href="classptx__instruction.html#a701349bc06eb65b5c49a83140bfc8936">m_opcode</a> == CALL_OP)){
<a name="l00481"></a>00481             <span class="comment">// do nothing</span>
<a name="l00482"></a>00482     }<span class="keywordflow">else</span> <span class="keywordflow">if</span>((<a class="code" href="classptx__instruction.html#a701349bc06eb65b5c49a83140bfc8936">m_opcode</a> == CVT_OP || <a class="code" href="classptx__instruction.html#a701349bc06eb65b5c49a83140bfc8936">m_opcode</a> == SET_OP || <a class="code" href="classptx__instruction.html#a701349bc06eb65b5c49a83140bfc8936">m_opcode</a> == SLCT_OP)){
<a name="l00483"></a>00483         <span class="keywordflow">if</span>(<a class="code" href="classptx__instruction.html#a65ccc3829d2356648a9865c42bc91409">get_type2</a>()==F16_TYPE || <a class="code" href="classptx__instruction.html#a65ccc3829d2356648a9865c42bc91409">get_type2</a>()==F32_TYPE || <a class="code" href="classptx__instruction.html#a65ccc3829d2356648a9865c42bc91409">get_type2</a>() == F64_TYPE || <a class="code" href="classptx__instruction.html#a65ccc3829d2356648a9865c42bc91409">get_type2</a>() == FF64_TYPE){
<a name="l00484"></a>00484             <a class="code" href="classinst__t.html#ac7a035218233cd400ee53e07292b3e19">oprnd_type</a>= <a class="code" href="abstract__hardware__model_8h.html#a2f268fb920f58fceda179b2a908e48fda1dbcb0fd00afe65cabbb315ca9d763d6">FP_OP</a>;
<a name="l00485"></a>00485         }<span class="keywordflow">else</span> <a class="code" href="classinst__t.html#ac7a035218233cd400ee53e07292b3e19">oprnd_type</a>=<a class="code" href="abstract__hardware__model_8h.html#a2f268fb920f58fceda179b2a908e48fda040b39cb7f3650d354295568d5fa4398">INT_OP</a>;
<a name="l00486"></a>00486 
<a name="l00487"></a>00487     }<span class="keywordflow">else</span>{
<a name="l00488"></a>00488         <span class="keywordflow">if</span>(<a class="code" href="classptx__instruction.html#a7266fb6774c9f05108fe9f128c56d7ab">get_type</a>()==F16_TYPE || <a class="code" href="classptx__instruction.html#a7266fb6774c9f05108fe9f128c56d7ab">get_type</a>()==F32_TYPE || <a class="code" href="classptx__instruction.html#a7266fb6774c9f05108fe9f128c56d7ab">get_type</a>() == F64_TYPE || <a class="code" href="classptx__instruction.html#a7266fb6774c9f05108fe9f128c56d7ab">get_type</a>() == FF64_TYPE){
<a name="l00489"></a>00489             <a class="code" href="classinst__t.html#ac7a035218233cd400ee53e07292b3e19">oprnd_type</a>= <a class="code" href="abstract__hardware__model_8h.html#a2f268fb920f58fceda179b2a908e48fda1dbcb0fd00afe65cabbb315ca9d763d6">FP_OP</a>;
<a name="l00490"></a>00490         }<span class="keywordflow">else</span> <a class="code" href="classinst__t.html#ac7a035218233cd400ee53e07292b3e19">oprnd_type</a>=<a class="code" href="abstract__hardware__model_8h.html#a2f268fb920f58fceda179b2a908e48fda040b39cb7f3650d354295568d5fa4398">INT_OP</a>;
<a name="l00491"></a>00491     }
<a name="l00492"></a>00492 }
<a name="l00493"></a><a class="code" href="classptx__instruction.html#ac714abb940efc884494b08f46f70f78b">00493</a> <span class="keywordtype">void</span> <a class="code" href="classptx__instruction.html#ac714abb940efc884494b08f46f70f78b">ptx_instruction::set_mul_div_or_other_archop</a>(){
<a name="l00494"></a>00494     <a class="code" href="classinst__t.html#aa01cff1aa0581463b17d5fe0e58d0196">sp_op</a>=<a class="code" href="abstract__hardware__model_8h.html#a4bca82f78a8b186b2f789b829b836312acf75d70f82aa1396bdfa86ba8f54c4da">OTHER_OP</a>;
<a name="l00495"></a>00495     <span class="keywordflow">if</span>((<a class="code" href="classptx__instruction.html#a701349bc06eb65b5c49a83140bfc8936">m_opcode</a> != MEMBAR_OP) &amp;&amp; (<a class="code" href="classptx__instruction.html#a701349bc06eb65b5c49a83140bfc8936">m_opcode</a> != SSY_OP) &amp;&amp; (<a class="code" href="classptx__instruction.html#a701349bc06eb65b5c49a83140bfc8936">m_opcode</a> != BRA_OP) &amp;&amp; (<a class="code" href="classptx__instruction.html#a701349bc06eb65b5c49a83140bfc8936">m_opcode</a> != BAR_OP) &amp;&amp; (<a class="code" href="classptx__instruction.html#a701349bc06eb65b5c49a83140bfc8936">m_opcode</a> != EXIT_OP) &amp;&amp; (<a class="code" href="classptx__instruction.html#a701349bc06eb65b5c49a83140bfc8936">m_opcode</a> != NOP_OP) &amp;&amp; (<a class="code" href="classptx__instruction.html#a701349bc06eb65b5c49a83140bfc8936">m_opcode</a> != RETP_OP) &amp;&amp; (<a class="code" href="classptx__instruction.html#a701349bc06eb65b5c49a83140bfc8936">m_opcode</a> != RET_OP) &amp;&amp; (<a class="code" href="classptx__instruction.html#a701349bc06eb65b5c49a83140bfc8936">m_opcode</a> != CALLP_OP) &amp;&amp; (<a class="code" href="classptx__instruction.html#a701349bc06eb65b5c49a83140bfc8936">m_opcode</a> != CALL_OP)){
<a name="l00496"></a>00496         <span class="keywordflow">if</span>(<a class="code" href="classptx__instruction.html#a7266fb6774c9f05108fe9f128c56d7ab">get_type</a>()==F32_TYPE || <a class="code" href="classptx__instruction.html#a7266fb6774c9f05108fe9f128c56d7ab">get_type</a>() == F64_TYPE || <a class="code" href="classptx__instruction.html#a7266fb6774c9f05108fe9f128c56d7ab">get_type</a>() == FF64_TYPE){
<a name="l00497"></a>00497             <span class="keywordflow">switch</span>(<a class="code" href="classptx__instruction.html#a7e1df5ccd2482be6275b3267b6af2d85">get_opcode</a>()){
<a name="l00498"></a>00498                 <span class="keywordflow">case</span> MUL_OP:
<a name="l00499"></a>00499                 <span class="keywordflow">case</span> MAD_OP:
<a name="l00500"></a>00500                     <a class="code" href="classinst__t.html#aa01cff1aa0581463b17d5fe0e58d0196">sp_op</a>=<a class="code" href="abstract__hardware__model_8h.html#a4bca82f78a8b186b2f789b829b836312a505e663b361288c1a8b45d22c4f0b43b">FP_MUL_OP</a>;
<a name="l00501"></a>00501                     <span class="keywordflow">break</span>;
<a name="l00502"></a>00502                 <span class="keywordflow">case</span> DIV_OP:
<a name="l00503"></a>00503                     <a class="code" href="classinst__t.html#aa01cff1aa0581463b17d5fe0e58d0196">sp_op</a>=<a class="code" href="abstract__hardware__model_8h.html#a4bca82f78a8b186b2f789b829b836312ab1418341c8cfff3134b88b5348a5539e">FP_DIV_OP</a>;
<a name="l00504"></a>00504                     <span class="keywordflow">break</span>;
<a name="l00505"></a>00505                 <span class="keywordflow">case</span> LG2_OP:
<a name="l00506"></a>00506                     <a class="code" href="classinst__t.html#aa01cff1aa0581463b17d5fe0e58d0196">sp_op</a>=<a class="code" href="abstract__hardware__model_8h.html#a4bca82f78a8b186b2f789b829b836312af1c8fdd317d63755facd75f71564ca6a">FP_LG_OP</a>;
<a name="l00507"></a>00507                     <span class="keywordflow">break</span>;
<a name="l00508"></a>00508                 <span class="keywordflow">case</span> RSQRT_OP:
<a name="l00509"></a>00509                 <span class="keywordflow">case</span> SQRT_OP:
<a name="l00510"></a>00510                     <a class="code" href="classinst__t.html#aa01cff1aa0581463b17d5fe0e58d0196">sp_op</a>=<a class="code" href="abstract__hardware__model_8h.html#a4bca82f78a8b186b2f789b829b836312a530c6307fe420a921bc8c7718dd017c5">FP_SQRT_OP</a>;
<a name="l00511"></a>00511                     <span class="keywordflow">break</span>;
<a name="l00512"></a>00512                 <span class="keywordflow">case</span> RCP_OP:
<a name="l00513"></a>00513                     <a class="code" href="classinst__t.html#aa01cff1aa0581463b17d5fe0e58d0196">sp_op</a>=<a class="code" href="abstract__hardware__model_8h.html#a4bca82f78a8b186b2f789b829b836312ab1418341c8cfff3134b88b5348a5539e">FP_DIV_OP</a>;
<a name="l00514"></a>00514                     <span class="keywordflow">break</span>;
<a name="l00515"></a>00515                 <span class="keywordflow">case</span> SIN_OP:
<a name="l00516"></a>00516                 <span class="keywordflow">case</span> COS_OP:
<a name="l00517"></a>00517                     <a class="code" href="classinst__t.html#aa01cff1aa0581463b17d5fe0e58d0196">sp_op</a>=<a class="code" href="abstract__hardware__model_8h.html#a4bca82f78a8b186b2f789b829b836312a16ae7f68efebd0715be7fd2f6389b052">FP_SIN_OP</a>;
<a name="l00518"></a>00518                     <span class="keywordflow">break</span>;
<a name="l00519"></a>00519                 <span class="keywordflow">case</span> EX2_OP:
<a name="l00520"></a>00520                     <a class="code" href="classinst__t.html#aa01cff1aa0581463b17d5fe0e58d0196">sp_op</a>=<a class="code" href="abstract__hardware__model_8h.html#a4bca82f78a8b186b2f789b829b836312a33006a20188b1857b0675ad0fb4d8094">FP_EXP_OP</a>;
<a name="l00521"></a>00521                     <span class="keywordflow">break</span>;
<a name="l00522"></a>00522                 <span class="keywordflow">default</span>:
<a name="l00523"></a>00523                     <span class="keywordflow">if</span>(<a class="code" href="classinst__t.html#a5e7e56fb753710a255876d382fda08c3">op</a>==<a class="code" href="abstract__hardware__model_8h.html#a35b8f4223626361f0e0cb24d0c0b0f4ca7fff08fa70887ff338390f06243b8026">ALU_OP</a>)
<a name="l00524"></a>00524                         <a class="code" href="classinst__t.html#aa01cff1aa0581463b17d5fe0e58d0196">sp_op</a>=<a class="code" href="abstract__hardware__model_8h.html#a4bca82f78a8b186b2f789b829b836312a47ebef5e23340accdb84e22c66bbbeba">FP__OP</a>;
<a name="l00525"></a>00525                     <span class="keywordflow">break</span>;
<a name="l00526"></a>00526 
<a name="l00527"></a>00527             }
<a name="l00528"></a>00528         }<span class="keywordflow">else</span> {
<a name="l00529"></a>00529             <span class="keywordflow">switch</span>(<a class="code" href="classptx__instruction.html#a7e1df5ccd2482be6275b3267b6af2d85">get_opcode</a>()){
<a name="l00530"></a>00530                 <span class="keywordflow">case</span> MUL24_OP:
<a name="l00531"></a>00531                 <span class="keywordflow">case</span> MAD24_OP:
<a name="l00532"></a>00532                     <a class="code" href="classinst__t.html#aa01cff1aa0581463b17d5fe0e58d0196">sp_op</a>=<a class="code" href="abstract__hardware__model_8h.html#a4bca82f78a8b186b2f789b829b836312a743916393402a1d168b9fe36f25399dd">INT_MUL24_OP</a>;
<a name="l00533"></a>00533                 <span class="keywordflow">break</span>;
<a name="l00534"></a>00534                 <span class="keywordflow">case</span> MUL_OP:
<a name="l00535"></a>00535                 <span class="keywordflow">case</span> MAD_OP:
<a name="l00536"></a>00536                     <span class="keywordflow">if</span>(<a class="code" href="classptx__instruction.html#a7266fb6774c9f05108fe9f128c56d7ab">get_type</a>()==U32_TYPE || <a class="code" href="classptx__instruction.html#a7266fb6774c9f05108fe9f128c56d7ab">get_type</a>()==S32_TYPE || <a class="code" href="classptx__instruction.html#a7266fb6774c9f05108fe9f128c56d7ab">get_type</a>()==B32_TYPE)
<a name="l00537"></a>00537                         <a class="code" href="classinst__t.html#aa01cff1aa0581463b17d5fe0e58d0196">sp_op</a>=<a class="code" href="abstract__hardware__model_8h.html#a4bca82f78a8b186b2f789b829b836312a911de02c13639d8d99a20873bac3219f">INT_MUL32_OP</a>;
<a name="l00538"></a>00538                     <span class="keywordflow">else</span>
<a name="l00539"></a>00539                         <a class="code" href="classinst__t.html#aa01cff1aa0581463b17d5fe0e58d0196">sp_op</a>=<a class="code" href="abstract__hardware__model_8h.html#a4bca82f78a8b186b2f789b829b836312ac3bb505c851133428bc4821d20413b70">INT_MUL_OP</a>;
<a name="l00540"></a>00540                 <span class="keywordflow">break</span>;
<a name="l00541"></a>00541                 <span class="keywordflow">case</span> DIV_OP:
<a name="l00542"></a>00542                     <a class="code" href="classinst__t.html#aa01cff1aa0581463b17d5fe0e58d0196">sp_op</a>=<a class="code" href="abstract__hardware__model_8h.html#a4bca82f78a8b186b2f789b829b836312a568bca6163b949ab40eab99b4bea4752">INT_DIV_OP</a>;
<a name="l00543"></a>00543                 <span class="keywordflow">break</span>;
<a name="l00544"></a>00544                 <span class="keywordflow">default</span>:
<a name="l00545"></a>00545                     <span class="keywordflow">if</span>(<a class="code" href="classinst__t.html#a5e7e56fb753710a255876d382fda08c3">op</a>==<a class="code" href="abstract__hardware__model_8h.html#a35b8f4223626361f0e0cb24d0c0b0f4ca7fff08fa70887ff338390f06243b8026">ALU_OP</a>)
<a name="l00546"></a>00546                         <a class="code" href="classinst__t.html#aa01cff1aa0581463b17d5fe0e58d0196">sp_op</a>=<a class="code" href="abstract__hardware__model_8h.html#a4bca82f78a8b186b2f789b829b836312abfd5ed25cbbfae72852f6b1069bde7c2">INT__OP</a>;
<a name="l00547"></a>00547                     <span class="keywordflow">break</span>;
<a name="l00548"></a>00548             }
<a name="l00549"></a>00549         }
<a name="l00550"></a>00550     }
<a name="l00551"></a>00551 
<a name="l00552"></a>00552 }
<a name="l00553"></a>00553 
<a name="l00554"></a>00554 
<a name="l00555"></a>00555 
<a name="l00556"></a><a class="code" href="classptx__instruction.html#a946f57356ab995805e85d2f3b684f556">00556</a> <span class="keywordtype">void</span> <a class="code" href="classptx__instruction.html#a946f57356ab995805e85d2f3b684f556">ptx_instruction::set_bar_type</a>()
<a name="l00557"></a>00557 {
<a name="l00558"></a>00558        <span class="keywordflow">if</span>(<a class="code" href="classptx__instruction.html#a701349bc06eb65b5c49a83140bfc8936">m_opcode</a>==BAR_OP) {
<a name="l00559"></a>00559            <span class="keywordflow">switch</span>(<a class="code" href="classptx__instruction.html#adaf795df461bc62fc0ae61a0f8e2cd9b">m_barrier_op</a>){
<a name="l00560"></a>00560                <span class="keywordflow">case</span> SYNC_OPTION:
<a name="l00561"></a>00561                    <a class="code" href="classinst__t.html#ab3bb097ac648d0b7c5df60a4d79819d6">bar_type</a> = <a class="code" href="abstract__hardware__model_8h.html#a647e65fa2b1102bcd8019be201233818a447bfe7992c2fe70bfe561225f74d379">SYNC</a>;
<a name="l00562"></a>00562                    <span class="keywordflow">break</span>;
<a name="l00563"></a>00563                <span class="keywordflow">case</span> ARRIVE_OPTION:
<a name="l00564"></a>00564                    <a class="code" href="classinst__t.html#ab3bb097ac648d0b7c5df60a4d79819d6">bar_type</a> = <a class="code" href="abstract__hardware__model_8h.html#a647e65fa2b1102bcd8019be201233818a02ff486f2eb52876c8102e6871863627">ARRIVE</a>;
<a name="l00565"></a>00565                    <span class="keywordflow">break</span>;
<a name="l00566"></a>00566                <span class="keywordflow">case</span> RED_OPTION:
<a name="l00567"></a>00567                    <a class="code" href="classinst__t.html#ab3bb097ac648d0b7c5df60a4d79819d6">bar_type</a> = <a class="code" href="abstract__hardware__model_8h.html#a647e65fa2b1102bcd8019be201233818af80f9a890089d211842d59625e561f88">RED</a>;
<a name="l00568"></a>00568                    <span class="keywordflow">switch</span>(<a class="code" href="classptx__instruction.html#aa4d15e0f0943d21a031fab6de8285801">m_atomic_spec</a>){
<a name="l00569"></a>00569                        <span class="keywordflow">case</span> ATOMIC_POPC:
<a name="l00570"></a>00570                            <a class="code" href="classinst__t.html#a9bed62ab0cd18b95fcb5f068448232eb">red_type</a> = <a class="code" href="abstract__hardware__model_8h.html#a217f87fa9bb7d2cda007367bb5b44fa9a63ad6f58751f23088b40d7038c6bb0c8">POPC_RED</a>;
<a name="l00571"></a>00571                            <span class="keywordflow">break</span>;
<a name="l00572"></a>00572                        <span class="keywordflow">case</span> ATOMIC_AND:
<a name="l00573"></a>00573                            <a class="code" href="classinst__t.html#a9bed62ab0cd18b95fcb5f068448232eb">red_type</a> = <a class="code" href="abstract__hardware__model_8h.html#a217f87fa9bb7d2cda007367bb5b44fa9a399dc8bebd6767ec115489505a05bb4e">AND_RED</a>;
<a name="l00574"></a>00574                            <span class="keywordflow">break</span>;
<a name="l00575"></a>00575                        <span class="keywordflow">case</span> ATOMIC_OR:
<a name="l00576"></a>00576                            <a class="code" href="classinst__t.html#a9bed62ab0cd18b95fcb5f068448232eb">red_type</a> = <a class="code" href="abstract__hardware__model_8h.html#a217f87fa9bb7d2cda007367bb5b44fa9a7f468caa522bd4b2f5b5f30e80444346">OR_RED</a>;
<a name="l00577"></a>00577                            <span class="keywordflow">break</span>;
<a name="l00578"></a>00578                    }
<a name="l00579"></a>00579                 <span class="keywordflow">break</span>;
<a name="l00580"></a>00580                <span class="keywordflow">default</span>:
<a name="l00581"></a>00581                    abort();
<a name="l00582"></a>00582            }
<a name="l00583"></a>00583        }
<a name="l00584"></a>00584 }
<a name="l00585"></a>00585 
<a name="l00586"></a>00586 
<a name="l00587"></a><a class="code" href="classptx__instruction.html#aa7c387a9e9e8af4527a013e60a985d41">00587</a> <span class="keywordtype">void</span> <a class="code" href="classptx__instruction.html#aa7c387a9e9e8af4527a013e60a985d41">ptx_instruction::set_opcode_and_latency</a>()
<a name="l00588"></a>00588 {
<a name="l00589"></a>00589     <span class="keywordtype">unsigned</span> int_latency[5];
<a name="l00590"></a>00590     <span class="keywordtype">unsigned</span> fp_latency[5];
<a name="l00591"></a>00591     <span class="keywordtype">unsigned</span> dp_latency[5];
<a name="l00592"></a>00592     <span class="keywordtype">unsigned</span> int_init[5];
<a name="l00593"></a>00593     <span class="keywordtype">unsigned</span> fp_init[5];
<a name="l00594"></a>00594     <span class="keywordtype">unsigned</span> dp_init[5];
<a name="l00595"></a>00595     <span class="comment">/*</span>
<a name="l00596"></a>00596 <span class="comment">     * [0] ADD,SUB</span>
<a name="l00597"></a>00597 <span class="comment">     * [1] MAX,Min</span>
<a name="l00598"></a>00598 <span class="comment">     * [2] MUL</span>
<a name="l00599"></a>00599 <span class="comment">     * [3] MAD</span>
<a name="l00600"></a>00600 <span class="comment">     * [4] DIV</span>
<a name="l00601"></a>00601 <span class="comment">     */</span>
<a name="l00602"></a>00602     sscanf(<a class="code" href="cuda-sim_8cc.html#aa639c22046ef28e231f5f0e4ced02c50">opcode_latency_int</a>, <span class="stringliteral">&quot;%u,%u,%u,%u,%u&quot;</span>,
<a name="l00603"></a>00603             &amp;int_latency[0],&amp;int_latency[1],&amp;int_latency[2],
<a name="l00604"></a>00604             &amp;int_latency[3],&amp;int_latency[4]);
<a name="l00605"></a>00605     sscanf(<a class="code" href="cuda-sim_8cc.html#a20026c44e852f13d897ccf09895b4bc8">opcode_latency_fp</a>, <span class="stringliteral">&quot;%u,%u,%u,%u,%u&quot;</span>,
<a name="l00606"></a>00606             &amp;fp_latency[0],&amp;fp_latency[1],&amp;fp_latency[2],
<a name="l00607"></a>00607             &amp;fp_latency[3],&amp;fp_latency[4]);
<a name="l00608"></a>00608     sscanf(<a class="code" href="cuda-sim_8cc.html#aa59571aabce6bca67062201c0d372b7b">opcode_latency_dp</a>, <span class="stringliteral">&quot;%u,%u,%u,%u,%u&quot;</span>,
<a name="l00609"></a>00609             &amp;dp_latency[0],&amp;dp_latency[1],&amp;dp_latency[2],
<a name="l00610"></a>00610             &amp;dp_latency[3],&amp;dp_latency[4]);
<a name="l00611"></a>00611     sscanf(<a class="code" href="cuda-sim_8cc.html#a1b84ca37833ef6ffaca567c951507ad0">opcode_initiation_int</a>, <span class="stringliteral">&quot;%u,%u,%u,%u,%u&quot;</span>,
<a name="l00612"></a>00612             &amp;int_init[0],&amp;int_init[1],&amp;int_init[2],
<a name="l00613"></a>00613             &amp;int_init[3],&amp;int_init[4]);
<a name="l00614"></a>00614     sscanf(<a class="code" href="cuda-sim_8cc.html#a7ec306a6303b409de73764d7977709c9">opcode_initiation_fp</a>, <span class="stringliteral">&quot;%u,%u,%u,%u,%u&quot;</span>,
<a name="l00615"></a>00615             &amp;fp_init[0],&amp;fp_init[1],&amp;fp_init[2],
<a name="l00616"></a>00616             &amp;fp_init[3],&amp;fp_init[4]);
<a name="l00617"></a>00617     sscanf(<a class="code" href="cuda-sim_8cc.html#adfe1d21b95eb635da6dfe3fb8e5e95d2">opcode_initiation_dp</a>, <span class="stringliteral">&quot;%u,%u,%u,%u,%u&quot;</span>,
<a name="l00618"></a>00618             &amp;dp_init[0],&amp;dp_init[1],&amp;dp_init[2],
<a name="l00619"></a>00619             &amp;dp_init[3],&amp;dp_init[4]);
<a name="l00620"></a>00620     sscanf(<a class="code" href="cuda-sim_8cc.html#af6c7b8480e2cd8db4a1b0143aafccea3">cdp_latency_str</a>, <span class="stringliteral">&quot;%u,%u,%u,%u,%u&quot;</span>,
<a name="l00621"></a>00621             &amp;<a class="code" href="cuda-sim_8cc.html#a3587c6dfbd8d4a6e526bfcac693018ee">cdp_latency</a>[0],&amp;<a class="code" href="cuda-sim_8cc.html#a3587c6dfbd8d4a6e526bfcac693018ee">cdp_latency</a>[1],&amp;<a class="code" href="cuda-sim_8cc.html#a3587c6dfbd8d4a6e526bfcac693018ee">cdp_latency</a>[2], 
<a name="l00622"></a>00622             &amp;<a class="code" href="cuda-sim_8cc.html#a3587c6dfbd8d4a6e526bfcac693018ee">cdp_latency</a>[3],&amp;<a class="code" href="cuda-sim_8cc.html#a3587c6dfbd8d4a6e526bfcac693018ee">cdp_latency</a>[4]);
<a name="l00623"></a>00623 
<a name="l00624"></a>00624     <span class="keywordflow">if</span>(!<a class="code" href="classptx__instruction.html#ac1ecc2f6864de4949fc4ce70832fe166">m_operands</a>.empty()){
<a name="l00625"></a>00625         std::vector&lt;operand_info&gt;::iterator it;
<a name="l00626"></a>00626         <span class="keywordflow">for</span>(it=++<a class="code" href="classptx__instruction.html#ac1ecc2f6864de4949fc4ce70832fe166">m_operands</a>.begin();it!=<a class="code" href="classptx__instruction.html#ac1ecc2f6864de4949fc4ce70832fe166">m_operands</a>.end();it++){
<a name="l00627"></a>00627             <a class="code" href="classinst__t.html#ab6fa0e4f7944ee1a6225249d30c1d399">num_operands</a>++;
<a name="l00628"></a>00628             <span class="keywordflow">if</span>((it-&gt;is_reg() || it-&gt;is_vector())){
<a name="l00629"></a>00629                    <a class="code" href="classinst__t.html#a3eb2d831ee26f8a907748defcc585e1a">num_regs</a>++;
<a name="l00630"></a>00630             }
<a name="l00631"></a>00631          }
<a name="l00632"></a>00632     }
<a name="l00633"></a>00633    <a class="code" href="classinst__t.html#a5e7e56fb753710a255876d382fda08c3">op</a> = <a class="code" href="abstract__hardware__model_8h.html#a35b8f4223626361f0e0cb24d0c0b0f4ca7fff08fa70887ff338390f06243b8026">ALU_OP</a>;
<a name="l00634"></a>00634    <a class="code" href="classinst__t.html#a740113d4aeb9d9c593e88211ec560390">mem_op</a>= <a class="code" href="abstract__hardware__model_8h.html#a36b1ea75630fc91b4b9b711513cdf016a67158123a1459282510c6c2fa4d475b6">NOT_TEX</a>;
<a name="l00635"></a>00635    <a class="code" href="classinst__t.html#abb194962eb28815abe4036a1c23f5d2d">initiation_interval</a> = <a class="code" href="classinst__t.html#a0bd8bcc5400fbeb0f80147b5897f9ece">latency</a> = 1;
<a name="l00636"></a>00636    <span class="keywordflow">switch</span>( <a class="code" href="classptx__instruction.html#a701349bc06eb65b5c49a83140bfc8936">m_opcode</a> ) {
<a name="l00637"></a>00637    <span class="keywordflow">case</span> MOV_OP:
<a name="l00638"></a>00638        assert( !(<a class="code" href="classptx__instruction.html#ad5bc475bdc4ad3d041e74ac326e5a8c0">has_memory_read</a>() &amp;&amp; <a class="code" href="classptx__instruction.html#a438e0d906c02aee4c752fbc75b7cd01a">has_memory_write</a>()) );
<a name="l00639"></a>00639        <span class="keywordflow">if</span> ( <a class="code" href="classptx__instruction.html#ad5bc475bdc4ad3d041e74ac326e5a8c0">has_memory_read</a>() ) <a class="code" href="classinst__t.html#a5e7e56fb753710a255876d382fda08c3">op</a> = <a class="code" href="abstract__hardware__model_8h.html#a35b8f4223626361f0e0cb24d0c0b0f4ca5129cce70aaf0f68261db0c4bf273709">LOAD_OP</a>;
<a name="l00640"></a>00640        <span class="keywordflow">if</span> ( <a class="code" href="classptx__instruction.html#a438e0d906c02aee4c752fbc75b7cd01a">has_memory_write</a>() ) <a class="code" href="classinst__t.html#a5e7e56fb753710a255876d382fda08c3">op</a> = <a class="code" href="abstract__hardware__model_8h.html#a35b8f4223626361f0e0cb24d0c0b0f4cafd107fa80c07dee943713884d06dea31">STORE_OP</a>;
<a name="l00641"></a>00641        <span class="keywordflow">break</span>;
<a name="l00642"></a>00642    <span class="keywordflow">case</span> LD_OP: <a class="code" href="classinst__t.html#a5e7e56fb753710a255876d382fda08c3">op</a> = <a class="code" href="abstract__hardware__model_8h.html#a35b8f4223626361f0e0cb24d0c0b0f4ca5129cce70aaf0f68261db0c4bf273709">LOAD_OP</a>; <span class="keywordflow">break</span>;
<a name="l00643"></a>00643    <span class="keywordflow">case</span> LDU_OP: <a class="code" href="classinst__t.html#a5e7e56fb753710a255876d382fda08c3">op</a> = <a class="code" href="abstract__hardware__model_8h.html#a35b8f4223626361f0e0cb24d0c0b0f4ca5129cce70aaf0f68261db0c4bf273709">LOAD_OP</a>; <span class="keywordflow">break</span>;
<a name="l00644"></a>00644    <span class="keywordflow">case</span> ST_OP: <a class="code" href="classinst__t.html#a5e7e56fb753710a255876d382fda08c3">op</a> = <a class="code" href="abstract__hardware__model_8h.html#a35b8f4223626361f0e0cb24d0c0b0f4cafd107fa80c07dee943713884d06dea31">STORE_OP</a>; <span class="keywordflow">break</span>;
<a name="l00645"></a>00645    <span class="keywordflow">case</span> BRA_OP: <a class="code" href="classinst__t.html#a5e7e56fb753710a255876d382fda08c3">op</a> = <a class="code" href="abstract__hardware__model_8h.html#a35b8f4223626361f0e0cb24d0c0b0f4caa9ecf3f3a181c3ac44388aedd1848340">BRANCH_OP</a>; <span class="keywordflow">break</span>;
<a name="l00646"></a>00646    <span class="keywordflow">case</span> BREAKADDR_OP: <a class="code" href="classinst__t.html#a5e7e56fb753710a255876d382fda08c3">op</a> = <a class="code" href="abstract__hardware__model_8h.html#a35b8f4223626361f0e0cb24d0c0b0f4caa9ecf3f3a181c3ac44388aedd1848340">BRANCH_OP</a>; <span class="keywordflow">break</span>;
<a name="l00647"></a>00647    <span class="keywordflow">case</span> TEX_OP: <a class="code" href="classinst__t.html#a5e7e56fb753710a255876d382fda08c3">op</a> = <a class="code" href="abstract__hardware__model_8h.html#a35b8f4223626361f0e0cb24d0c0b0f4ca5129cce70aaf0f68261db0c4bf273709">LOAD_OP</a>; <a class="code" href="classinst__t.html#a740113d4aeb9d9c593e88211ec560390">mem_op</a>=<a class="code" href="abstract__hardware__model_8h.html#a36b1ea75630fc91b4b9b711513cdf016a24e799bd38fe08efb4756c63d8f78df9">TEX</a>; <span class="keywordflow">break</span>;
<a name="l00648"></a>00648    <span class="keywordflow">case</span> ATOM_OP: <a class="code" href="classinst__t.html#a5e7e56fb753710a255876d382fda08c3">op</a> = <a class="code" href="abstract__hardware__model_8h.html#a35b8f4223626361f0e0cb24d0c0b0f4ca5129cce70aaf0f68261db0c4bf273709">LOAD_OP</a>; <span class="keywordflow">break</span>;
<a name="l00649"></a>00649    <span class="keywordflow">case</span> BAR_OP: <a class="code" href="classinst__t.html#a5e7e56fb753710a255876d382fda08c3">op</a> = <a class="code" href="abstract__hardware__model_8h.html#a35b8f4223626361f0e0cb24d0c0b0f4ca998c92693120b6eb67f03e3c9590ed29">BARRIER_OP</a>; <span class="keywordflow">break</span>;
<a name="l00650"></a>00650    <span class="keywordflow">case</span> MEMBAR_OP: <a class="code" href="classinst__t.html#a5e7e56fb753710a255876d382fda08c3">op</a> = <a class="code" href="abstract__hardware__model_8h.html#a35b8f4223626361f0e0cb24d0c0b0f4cadaf34556ed6315ab53fe011adebe70c9">MEMORY_BARRIER_OP</a>; <span class="keywordflow">break</span>;
<a name="l00651"></a>00651    <span class="keywordflow">case</span> CALL_OP:
<a name="l00652"></a>00652    {
<a name="l00653"></a>00653        <span class="keywordflow">if</span>(<a class="code" href="classwarp__inst__t.html#a3d2606b96edddeb0f2cd7ebe3196e024">m_is_printf</a> || <a class="code" href="classwarp__inst__t.html#adbae8b400fe4f1f7fae810cada87ebaa">m_is_cdp</a>) {
<a name="l00654"></a>00654            <a class="code" href="classinst__t.html#a5e7e56fb753710a255876d382fda08c3">op</a> = <a class="code" href="abstract__hardware__model_8h.html#a35b8f4223626361f0e0cb24d0c0b0f4ca7fff08fa70887ff338390f06243b8026">ALU_OP</a>;
<a name="l00655"></a>00655        }
<a name="l00656"></a>00656        <span class="keywordflow">else</span>
<a name="l00657"></a>00657            <a class="code" href="classinst__t.html#a5e7e56fb753710a255876d382fda08c3">op</a> = <a class="code" href="abstract__hardware__model_8h.html#a35b8f4223626361f0e0cb24d0c0b0f4ca9d2a2009557f4368e50d17bec713fa99">CALL_OPS</a>;
<a name="l00658"></a>00658        <span class="keywordflow">break</span>;
<a name="l00659"></a>00659    }
<a name="l00660"></a>00660    <span class="keywordflow">case</span> CALLP_OP:
<a name="l00661"></a>00661    {
<a name="l00662"></a>00662        <span class="keywordflow">if</span>(<a class="code" href="classwarp__inst__t.html#a3d2606b96edddeb0f2cd7ebe3196e024">m_is_printf</a> || <a class="code" href="classwarp__inst__t.html#adbae8b400fe4f1f7fae810cada87ebaa">m_is_cdp</a>) {
<a name="l00663"></a>00663                <a class="code" href="classinst__t.html#a5e7e56fb753710a255876d382fda08c3">op</a> = <a class="code" href="abstract__hardware__model_8h.html#a35b8f4223626361f0e0cb24d0c0b0f4ca7fff08fa70887ff338390f06243b8026">ALU_OP</a>;
<a name="l00664"></a>00664        }
<a name="l00665"></a>00665        <span class="keywordflow">else</span>
<a name="l00666"></a>00666            <a class="code" href="classinst__t.html#a5e7e56fb753710a255876d382fda08c3">op</a> = <a class="code" href="abstract__hardware__model_8h.html#a35b8f4223626361f0e0cb24d0c0b0f4ca9d2a2009557f4368e50d17bec713fa99">CALL_OPS</a>;
<a name="l00667"></a>00667        <span class="keywordflow">break</span>;
<a name="l00668"></a>00668    }
<a name="l00669"></a>00669    <span class="keywordflow">case</span> RET_OP: <span class="keywordflow">case</span> RETP_OP:  <a class="code" href="classinst__t.html#a5e7e56fb753710a255876d382fda08c3">op</a> = <a class="code" href="abstract__hardware__model_8h.html#a35b8f4223626361f0e0cb24d0c0b0f4cad16cd2d560e78486fcb6a87d490b0ef4">RET_OPS</a>;<span class="keywordflow">break</span>;
<a name="l00670"></a>00670    <span class="keywordflow">case</span> ADD_OP: <span class="keywordflow">case</span> ADDP_OP: <span class="keywordflow">case</span> ADDC_OP: <span class="keywordflow">case</span> SUB_OP: <span class="keywordflow">case</span> SUBC_OP:
<a name="l00671"></a>00671        <span class="comment">//ADD,SUB latency</span>
<a name="l00672"></a>00672        <span class="keywordflow">switch</span>(<a class="code" href="classptx__instruction.html#a7266fb6774c9f05108fe9f128c56d7ab">get_type</a>()){
<a name="l00673"></a>00673        <span class="keywordflow">case</span> F32_TYPE:
<a name="l00674"></a>00674            <a class="code" href="classinst__t.html#a0bd8bcc5400fbeb0f80147b5897f9ece">latency</a> = fp_latency[0];
<a name="l00675"></a>00675            <a class="code" href="classinst__t.html#abb194962eb28815abe4036a1c23f5d2d">initiation_interval</a> = fp_init[0];
<a name="l00676"></a>00676            <span class="keywordflow">break</span>;
<a name="l00677"></a>00677        <span class="keywordflow">case</span> F64_TYPE:
<a name="l00678"></a>00678        <span class="keywordflow">case</span> FF64_TYPE:
<a name="l00679"></a>00679            <a class="code" href="classinst__t.html#a0bd8bcc5400fbeb0f80147b5897f9ece">latency</a> = dp_latency[0];
<a name="l00680"></a>00680            <a class="code" href="classinst__t.html#abb194962eb28815abe4036a1c23f5d2d">initiation_interval</a> = dp_init[0];
<a name="l00681"></a>00681            <span class="keywordflow">break</span>;
<a name="l00682"></a>00682        <span class="keywordflow">case</span> B32_TYPE:
<a name="l00683"></a>00683        <span class="keywordflow">case</span> U32_TYPE:
<a name="l00684"></a>00684        <span class="keywordflow">case</span> S32_TYPE:
<a name="l00685"></a>00685        <span class="keywordflow">default</span>: <span class="comment">//Use int settings for default</span>
<a name="l00686"></a>00686            <a class="code" href="classinst__t.html#a0bd8bcc5400fbeb0f80147b5897f9ece">latency</a> = int_latency[0];
<a name="l00687"></a>00687            <a class="code" href="classinst__t.html#abb194962eb28815abe4036a1c23f5d2d">initiation_interval</a> = int_init[0];
<a name="l00688"></a>00688            <span class="keywordflow">break</span>;
<a name="l00689"></a>00689        }
<a name="l00690"></a>00690        <span class="keywordflow">break</span>;
<a name="l00691"></a>00691    <span class="keywordflow">case</span> MAX_OP: <span class="keywordflow">case</span> MIN_OP:
<a name="l00692"></a>00692        <span class="comment">//MAX,MIN latency</span>
<a name="l00693"></a>00693        <span class="keywordflow">switch</span>(<a class="code" href="classptx__instruction.html#a7266fb6774c9f05108fe9f128c56d7ab">get_type</a>()){
<a name="l00694"></a>00694        <span class="keywordflow">case</span> F32_TYPE:
<a name="l00695"></a>00695            <a class="code" href="classinst__t.html#a0bd8bcc5400fbeb0f80147b5897f9ece">latency</a> = fp_latency[1];
<a name="l00696"></a>00696            <a class="code" href="classinst__t.html#abb194962eb28815abe4036a1c23f5d2d">initiation_interval</a> = fp_init[1];
<a name="l00697"></a>00697            <span class="keywordflow">break</span>;
<a name="l00698"></a>00698        <span class="keywordflow">case</span> F64_TYPE:
<a name="l00699"></a>00699        <span class="keywordflow">case</span> FF64_TYPE:
<a name="l00700"></a>00700            <a class="code" href="classinst__t.html#a0bd8bcc5400fbeb0f80147b5897f9ece">latency</a> = dp_latency[1];
<a name="l00701"></a>00701            <a class="code" href="classinst__t.html#abb194962eb28815abe4036a1c23f5d2d">initiation_interval</a> = dp_init[1];
<a name="l00702"></a>00702            <span class="keywordflow">break</span>;
<a name="l00703"></a>00703        <span class="keywordflow">case</span> B32_TYPE:
<a name="l00704"></a>00704        <span class="keywordflow">case</span> U32_TYPE:
<a name="l00705"></a>00705        <span class="keywordflow">case</span> S32_TYPE:
<a name="l00706"></a>00706        <span class="keywordflow">default</span>: <span class="comment">//Use int settings for default</span>
<a name="l00707"></a>00707            <a class="code" href="classinst__t.html#a0bd8bcc5400fbeb0f80147b5897f9ece">latency</a> = int_latency[1];
<a name="l00708"></a>00708            <a class="code" href="classinst__t.html#abb194962eb28815abe4036a1c23f5d2d">initiation_interval</a> = int_init[1];
<a name="l00709"></a>00709            <span class="keywordflow">break</span>;
<a name="l00710"></a>00710        }
<a name="l00711"></a>00711        <span class="keywordflow">break</span>;
<a name="l00712"></a>00712    <span class="keywordflow">case</span> MUL_OP:
<a name="l00713"></a>00713        <span class="comment">//MUL latency</span>
<a name="l00714"></a>00714        <span class="keywordflow">switch</span>(<a class="code" href="classptx__instruction.html#a7266fb6774c9f05108fe9f128c56d7ab">get_type</a>()){
<a name="l00715"></a>00715        <span class="keywordflow">case</span> F32_TYPE:
<a name="l00716"></a>00716            <a class="code" href="classinst__t.html#a0bd8bcc5400fbeb0f80147b5897f9ece">latency</a> = fp_latency[2];
<a name="l00717"></a>00717            <a class="code" href="classinst__t.html#abb194962eb28815abe4036a1c23f5d2d">initiation_interval</a> = fp_init[2];
<a name="l00718"></a>00718            <a class="code" href="classinst__t.html#a5e7e56fb753710a255876d382fda08c3">op</a> = <a class="code" href="abstract__hardware__model_8h.html#a35b8f4223626361f0e0cb24d0c0b0f4cac403f33e6938422c5ad1eead4e7dbc7b">ALU_SFU_OP</a>;
<a name="l00719"></a>00719            <span class="keywordflow">break</span>;
<a name="l00720"></a>00720        <span class="keywordflow">case</span> F64_TYPE:
<a name="l00721"></a>00721        <span class="keywordflow">case</span> FF64_TYPE:
<a name="l00722"></a>00722            <a class="code" href="classinst__t.html#a0bd8bcc5400fbeb0f80147b5897f9ece">latency</a> = dp_latency[2];
<a name="l00723"></a>00723            <a class="code" href="classinst__t.html#abb194962eb28815abe4036a1c23f5d2d">initiation_interval</a> = dp_init[2];
<a name="l00724"></a>00724            <a class="code" href="classinst__t.html#a5e7e56fb753710a255876d382fda08c3">op</a> = <a class="code" href="abstract__hardware__model_8h.html#a35b8f4223626361f0e0cb24d0c0b0f4cac403f33e6938422c5ad1eead4e7dbc7b">ALU_SFU_OP</a>;
<a name="l00725"></a>00725            <span class="keywordflow">break</span>;
<a name="l00726"></a>00726        <span class="keywordflow">case</span> B32_TYPE:
<a name="l00727"></a>00727        <span class="keywordflow">case</span> U32_TYPE:
<a name="l00728"></a>00728        <span class="keywordflow">case</span> S32_TYPE:
<a name="l00729"></a>00729        <span class="keywordflow">default</span>: <span class="comment">//Use int settings for default</span>
<a name="l00730"></a>00730            <a class="code" href="classinst__t.html#a0bd8bcc5400fbeb0f80147b5897f9ece">latency</a> = int_latency[2];
<a name="l00731"></a>00731            <a class="code" href="classinst__t.html#abb194962eb28815abe4036a1c23f5d2d">initiation_interval</a> = int_init[2];
<a name="l00732"></a>00732            <a class="code" href="classinst__t.html#a5e7e56fb753710a255876d382fda08c3">op</a> = <a class="code" href="abstract__hardware__model_8h.html#a35b8f4223626361f0e0cb24d0c0b0f4cad2afe8f18d7b86344eb33fed3e78bfff">SFU_OP</a>;
<a name="l00733"></a>00733            <span class="keywordflow">break</span>;
<a name="l00734"></a>00734        }
<a name="l00735"></a>00735        <span class="keywordflow">break</span>;
<a name="l00736"></a>00736    <span class="keywordflow">case</span> MAD_OP: <span class="keywordflow">case</span> MADC_OP: <span class="keywordflow">case</span> MADP_OP:
<a name="l00737"></a>00737        <span class="comment">//MAD latency</span>
<a name="l00738"></a>00738        <span class="keywordflow">switch</span>(<a class="code" href="classptx__instruction.html#a7266fb6774c9f05108fe9f128c56d7ab">get_type</a>()){
<a name="l00739"></a>00739        <span class="keywordflow">case</span> F32_TYPE:
<a name="l00740"></a>00740            <a class="code" href="classinst__t.html#a0bd8bcc5400fbeb0f80147b5897f9ece">latency</a> = fp_latency[3];
<a name="l00741"></a>00741            <a class="code" href="classinst__t.html#abb194962eb28815abe4036a1c23f5d2d">initiation_interval</a> = fp_init[3];
<a name="l00742"></a>00742            <span class="keywordflow">break</span>;
<a name="l00743"></a>00743        <span class="keywordflow">case</span> F64_TYPE:
<a name="l00744"></a>00744        <span class="keywordflow">case</span> FF64_TYPE:
<a name="l00745"></a>00745            <a class="code" href="classinst__t.html#a0bd8bcc5400fbeb0f80147b5897f9ece">latency</a> = dp_latency[3];
<a name="l00746"></a>00746            <a class="code" href="classinst__t.html#abb194962eb28815abe4036a1c23f5d2d">initiation_interval</a> = dp_init[3];
<a name="l00747"></a>00747            <span class="keywordflow">break</span>;
<a name="l00748"></a>00748        <span class="keywordflow">case</span> B32_TYPE:
<a name="l00749"></a>00749        <span class="keywordflow">case</span> U32_TYPE:
<a name="l00750"></a>00750        <span class="keywordflow">case</span> S32_TYPE:
<a name="l00751"></a>00751        <span class="keywordflow">default</span>: <span class="comment">//Use int settings for default</span>
<a name="l00752"></a>00752            <a class="code" href="classinst__t.html#a0bd8bcc5400fbeb0f80147b5897f9ece">latency</a> = int_latency[3];
<a name="l00753"></a>00753            <a class="code" href="classinst__t.html#abb194962eb28815abe4036a1c23f5d2d">initiation_interval</a> = int_init[3];
<a name="l00754"></a>00754            <a class="code" href="classinst__t.html#a5e7e56fb753710a255876d382fda08c3">op</a> = <a class="code" href="abstract__hardware__model_8h.html#a35b8f4223626361f0e0cb24d0c0b0f4cad2afe8f18d7b86344eb33fed3e78bfff">SFU_OP</a>;
<a name="l00755"></a>00755            <span class="keywordflow">break</span>;
<a name="l00756"></a>00756        }
<a name="l00757"></a>00757        <span class="keywordflow">break</span>;
<a name="l00758"></a>00758    <span class="keywordflow">case</span> DIV_OP:
<a name="l00759"></a>00759        <span class="comment">// Floating point only</span>
<a name="l00760"></a>00760        <a class="code" href="classinst__t.html#a5e7e56fb753710a255876d382fda08c3">op</a> = <a class="code" href="abstract__hardware__model_8h.html#a35b8f4223626361f0e0cb24d0c0b0f4cad2afe8f18d7b86344eb33fed3e78bfff">SFU_OP</a>;
<a name="l00761"></a>00761        <span class="keywordflow">switch</span>(<a class="code" href="classptx__instruction.html#a7266fb6774c9f05108fe9f128c56d7ab">get_type</a>()){
<a name="l00762"></a>00762        <span class="keywordflow">case</span> F32_TYPE:
<a name="l00763"></a>00763            <a class="code" href="classinst__t.html#a0bd8bcc5400fbeb0f80147b5897f9ece">latency</a> = fp_latency[4];
<a name="l00764"></a>00764            <a class="code" href="classinst__t.html#abb194962eb28815abe4036a1c23f5d2d">initiation_interval</a> = fp_init[4];
<a name="l00765"></a>00765            <span class="keywordflow">break</span>;
<a name="l00766"></a>00766        <span class="keywordflow">case</span> F64_TYPE:
<a name="l00767"></a>00767        <span class="keywordflow">case</span> FF64_TYPE:
<a name="l00768"></a>00768            <a class="code" href="classinst__t.html#a0bd8bcc5400fbeb0f80147b5897f9ece">latency</a> = dp_latency[4];
<a name="l00769"></a>00769            <a class="code" href="classinst__t.html#abb194962eb28815abe4036a1c23f5d2d">initiation_interval</a> = dp_init[4];
<a name="l00770"></a>00770            <span class="keywordflow">break</span>;
<a name="l00771"></a>00771        <span class="keywordflow">case</span> B32_TYPE:
<a name="l00772"></a>00772        <span class="keywordflow">case</span> U32_TYPE:
<a name="l00773"></a>00773        <span class="keywordflow">case</span> S32_TYPE:
<a name="l00774"></a>00774        <span class="keywordflow">default</span>: <span class="comment">//Use int settings for default</span>
<a name="l00775"></a>00775            <a class="code" href="classinst__t.html#a0bd8bcc5400fbeb0f80147b5897f9ece">latency</a> = int_latency[4];
<a name="l00776"></a>00776            <a class="code" href="classinst__t.html#abb194962eb28815abe4036a1c23f5d2d">initiation_interval</a> = int_init[4];
<a name="l00777"></a>00777            <span class="keywordflow">break</span>;
<a name="l00778"></a>00778        }
<a name="l00779"></a>00779        <span class="keywordflow">break</span>;
<a name="l00780"></a>00780    <span class="keywordflow">case</span> SQRT_OP: <span class="keywordflow">case</span> SIN_OP: <span class="keywordflow">case</span> COS_OP: <span class="keywordflow">case</span> EX2_OP: <span class="keywordflow">case</span> LG2_OP: <span class="keywordflow">case</span> RSQRT_OP: <span class="keywordflow">case</span> RCP_OP:
<a name="l00781"></a>00781        <span class="comment">//Using double to approximate those</span>
<a name="l00782"></a>00782       <a class="code" href="classinst__t.html#a0bd8bcc5400fbeb0f80147b5897f9ece">latency</a> = dp_latency[2];
<a name="l00783"></a>00783       <a class="code" href="classinst__t.html#abb194962eb28815abe4036a1c23f5d2d">initiation_interval</a> = dp_init[2];
<a name="l00784"></a>00784       <a class="code" href="classinst__t.html#a5e7e56fb753710a255876d382fda08c3">op</a> = <a class="code" href="abstract__hardware__model_8h.html#a35b8f4223626361f0e0cb24d0c0b0f4cad2afe8f18d7b86344eb33fed3e78bfff">SFU_OP</a>;
<a name="l00785"></a>00785       <span class="keywordflow">break</span>;
<a name="l00786"></a>00786    <span class="keywordflow">case</span> SHFL_OP:
<a name="l00787"></a>00787        <a class="code" href="classinst__t.html#a0bd8bcc5400fbeb0f80147b5897f9ece">latency</a> = 32;
<a name="l00788"></a>00788        <a class="code" href="classinst__t.html#abb194962eb28815abe4036a1c23f5d2d">initiation_interval</a> = 15;
<a name="l00789"></a>00789        <span class="keywordflow">break</span>;
<a name="l00790"></a>00790    <span class="keywordflow">default</span>: 
<a name="l00791"></a>00791        <span class="keywordflow">break</span>;
<a name="l00792"></a>00792    }
<a name="l00793"></a>00793     <a class="code" href="classptx__instruction.html#a1a1dd8d920cb92f56b8f37e2bf155b15">set_fp_or_int_archop</a>();
<a name="l00794"></a>00794     <a class="code" href="classptx__instruction.html#ac714abb940efc884494b08f46f70f78b">set_mul_div_or_other_archop</a>();
<a name="l00795"></a>00795 
<a name="l00796"></a>00796 }
<a name="l00797"></a>00797 
<a name="l00798"></a><a class="code" href="classptx__thread__info.html#a0390824fce4d0fa341aa4ffb55344944">00798</a> <span class="keywordtype">void</span> <a class="code" href="classptx__thread__info.html#a0390824fce4d0fa341aa4ffb55344944">ptx_thread_info::ptx_fetch_inst</a>( <a class="code" href="classinst__t.html">inst_t</a> &amp;inst )<span class="keyword"> const</span>
<a name="l00799"></a>00799 <span class="keyword"></span>{
<a name="l00800"></a>00800    <a class="code" href="abstract__hardware__model_8h.html#a92b0c0d30c36a95c916f27a55784ca33">addr_t</a> pc = <a class="code" href="classptx__thread__info.html#a41b1e8fab5caac4c85f2e363b5857967">get_pc</a>();
<a name="l00801"></a>00801    <span class="keyword">const</span> <a class="code" href="classptx__instruction.html">ptx_instruction</a> *pI = <a class="code" href="classptx__thread__info.html#a825e787febf2b5ba59a76da36798bfd8">m_func_info</a>-&gt;<a class="code" href="classfunction__info.html#af3767e2405365a97df8ad7f3e3e2e090">get_instruction</a>(pc);
<a name="l00802"></a>00802    inst = (<span class="keyword">const</span> <a class="code" href="classinst__t.html">inst_t</a>&amp;)*pI;
<a name="l00803"></a>00803    assert( inst.<a class="code" href="classinst__t.html#af5b6be7232de77623fbe8b3c818913cd">valid</a>() );
<a name="l00804"></a>00804 }
<a name="l00805"></a>00805 
<a name="l00806"></a><a class="code" href="cuda-sim_8cc.html#a5fc048370aa5c227bf95630b9afe171f">00806</a> <span class="keyword">static</span> <span class="keywordtype">unsigned</span> <a class="code" href="cuda-sim_8cc.html#a5fc048370aa5c227bf95630b9afe171f">datatype2size</a>( <span class="keywordtype">unsigned</span> data_type )
<a name="l00807"></a>00807 {
<a name="l00808"></a>00808    <span class="keywordtype">unsigned</span> data_size;
<a name="l00809"></a>00809    <span class="keywordflow">switch</span> ( data_type ) {
<a name="l00810"></a>00810       <span class="keywordflow">case</span> B8_TYPE:
<a name="l00811"></a>00811       <span class="keywordflow">case</span> S8_TYPE:
<a name="l00812"></a>00812       <span class="keywordflow">case</span> U8_TYPE: 
<a name="l00813"></a>00813          data_size = 1; <span class="keywordflow">break</span>;
<a name="l00814"></a>00814       <span class="keywordflow">case</span> B16_TYPE:
<a name="l00815"></a>00815       <span class="keywordflow">case</span> S16_TYPE:
<a name="l00816"></a>00816       <span class="keywordflow">case</span> U16_TYPE:
<a name="l00817"></a>00817       <span class="keywordflow">case</span> F16_TYPE: 
<a name="l00818"></a>00818          data_size = 2; <span class="keywordflow">break</span>;
<a name="l00819"></a>00819       <span class="keywordflow">case</span> B32_TYPE:
<a name="l00820"></a>00820       <span class="keywordflow">case</span> S32_TYPE:
<a name="l00821"></a>00821       <span class="keywordflow">case</span> U32_TYPE:
<a name="l00822"></a>00822       <span class="keywordflow">case</span> F32_TYPE: 
<a name="l00823"></a>00823          data_size = 4; <span class="keywordflow">break</span>;
<a name="l00824"></a>00824       <span class="keywordflow">case</span> B64_TYPE:
<a name="l00825"></a>00825       <span class="keywordflow">case</span> BB64_TYPE:
<a name="l00826"></a>00826       <span class="keywordflow">case</span> S64_TYPE:
<a name="l00827"></a>00827       <span class="keywordflow">case</span> U64_TYPE:
<a name="l00828"></a>00828       <span class="keywordflow">case</span> F64_TYPE: 
<a name="l00829"></a>00829       <span class="keywordflow">case</span> FF64_TYPE:
<a name="l00830"></a>00830          data_size = 8; <span class="keywordflow">break</span>;
<a name="l00831"></a>00831       <span class="keywordflow">case</span> BB128_TYPE: 
<a name="l00832"></a>00832          data_size = 16; <span class="keywordflow">break</span>;
<a name="l00833"></a>00833       <span class="keywordflow">default</span>: assert(0); <span class="keywordflow">break</span>;
<a name="l00834"></a>00834    }
<a name="l00835"></a>00835    <span class="keywordflow">return</span> data_size; 
<a name="l00836"></a>00836 }
<a name="l00837"></a>00837 
<a name="l00838"></a><a class="code" href="classptx__instruction.html#a92b6780773bcf1881577803bc18eadee">00838</a> <span class="keywordtype">void</span> <a class="code" href="classptx__instruction.html#a92b6780773bcf1881577803bc18eadee">ptx_instruction::pre_decode</a>()
<a name="l00839"></a>00839 {
<a name="l00840"></a>00840    <a class="code" href="classinst__t.html#a76aea27709c3a0256c2615451c7daa56">pc</a> = <a class="code" href="classptx__instruction.html#a9783df0d08a90cd2b3ebf9869ac56009">m_PC</a>;
<a name="l00841"></a>00841    <a class="code" href="classinst__t.html#ab86890cdd0a9a3f624e1439a9552b053">isize</a> = <a class="code" href="classptx__instruction.html#a17e535a09d59dfaffcfdc4c381c74693">m_inst_size</a>;
<a name="l00842"></a>00842    <span class="keywordflow">for</span>( <span class="keywordtype">unsigned</span> <a class="code" href="rng-double_8c.html#aa42a9a9cb6e2b93d7f825c395af871bf">i</a>=0; <a class="code" href="rng-double_8c.html#aa42a9a9cb6e2b93d7f825c395af871bf">i</a>&lt;4; <a class="code" href="rng-double_8c.html#aa42a9a9cb6e2b93d7f825c395af871bf">i</a>++) {
<a name="l00843"></a>00843        <a class="code" href="classinst__t.html#a3c2c79e427a4d22fbf44264857a02c51">out</a>[<a class="code" href="rng-double_8c.html#aa42a9a9cb6e2b93d7f825c395af871bf">i</a>] = 0;
<a name="l00844"></a>00844        <a class="code" href="classinst__t.html#a5fb3f3e1f0a98e2c25f51251cf495e9a">in</a>[<a class="code" href="rng-double_8c.html#aa42a9a9cb6e2b93d7f825c395af871bf">i</a>] = 0;
<a name="l00845"></a>00845    }
<a name="l00846"></a>00846    <a class="code" href="classinst__t.html#aa68a80e8ae373709df3c0a6eab56616d">is_vectorin</a> = 0;
<a name="l00847"></a>00847    <a class="code" href="classinst__t.html#a6f9b659317654b0182e79b429b259431">is_vectorout</a> = 0;
<a name="l00848"></a>00848    std::fill_n(<a class="code" href="classinst__t.html#a88db6b095dc8d40a932891f69e4baa27">arch_reg</a>.src, MAX_REG_OPERANDS, -1);
<a name="l00849"></a>00849    std::fill_n(<a class="code" href="classinst__t.html#a88db6b095dc8d40a932891f69e4baa27">arch_reg</a>.dst, MAX_REG_OPERANDS, -1);
<a name="l00850"></a>00850    <a class="code" href="classinst__t.html#a352aa924f31558eb543c8a9ab6769367">pred</a> = 0;
<a name="l00851"></a>00851    <a class="code" href="classinst__t.html#ae245a88c92eccb464ea3510a5d70c736">ar1</a> = 0;
<a name="l00852"></a>00852    <a class="code" href="classinst__t.html#a932df482f6c89b8b7e2b27923dc4bbf1">ar2</a> = 0;
<a name="l00853"></a>00853    <a class="code" href="classinst__t.html#a7830eb1cfe5a305e426d8530563c11da">space</a> = <a class="code" href="classptx__instruction.html#aaaf79e16ee94f4f4e13754b83534bd21">m_space_spec</a>;
<a name="l00854"></a>00854    <a class="code" href="classinst__t.html#a9b1e867c7e8fc7d452ee732f9efcb37d">memory_op</a> = <a class="code" href="abstract__hardware__model_8h.html#a1df0b5882f0bc92aabef2d5a968c549baf20ad52c3a748cbcc87edfc33f1a1a53">no_memory_op</a>;
<a name="l00855"></a>00855    <a class="code" href="classinst__t.html#a17ce412c0e2dc350263be5e20efb4b36">data_size</a> = 0;
<a name="l00856"></a>00856    <span class="keywordflow">if</span> ( <a class="code" href="classptx__instruction.html#ad5bc475bdc4ad3d041e74ac326e5a8c0">has_memory_read</a>() || <a class="code" href="classptx__instruction.html#a438e0d906c02aee4c752fbc75b7cd01a">has_memory_write</a>() ) {
<a name="l00857"></a>00857       <span class="keywordtype">unsigned</span> to_type = <a class="code" href="classptx__instruction.html#a7266fb6774c9f05108fe9f128c56d7ab">get_type</a>();
<a name="l00858"></a>00858       <a class="code" href="classinst__t.html#a17ce412c0e2dc350263be5e20efb4b36">data_size</a> = <a class="code" href="cuda-sim_8cc.html#a5fc048370aa5c227bf95630b9afe171f">datatype2size</a>(to_type);
<a name="l00859"></a>00859       <a class="code" href="classinst__t.html#a9b1e867c7e8fc7d452ee732f9efcb37d">memory_op</a> = <a class="code" href="classptx__instruction.html#ad5bc475bdc4ad3d041e74ac326e5a8c0">has_memory_read</a>() ? <a class="code" href="abstract__hardware__model_8h.html#a1df0b5882f0bc92aabef2d5a968c549ba75c129e3900f1380d61f86c21cdcb1b9">memory_load</a> : <a class="code" href="abstract__hardware__model_8h.html#a1df0b5882f0bc92aabef2d5a968c549bad1c612197bbcb92d93fc4cf46418d50e">memory_store</a>;
<a name="l00860"></a>00860    }
<a name="l00861"></a>00861 
<a name="l00862"></a>00862    <span class="keywordtype">bool</span> has_dst = false ;
<a name="l00863"></a>00863 
<a name="l00864"></a>00864    <span class="keywordflow">switch</span> ( <a class="code" href="classptx__instruction.html#a7e1df5ccd2482be6275b3267b6af2d85">get_opcode</a>() ) {
<a name="l00865"></a>00865 <span class="preprocessor">#define OP_DEF(OP,FUNC,STR,DST,CLASSIFICATION) case OP: has_dst = (DST!=0); break;</span>
<a name="l00866"></a>00866 <span class="preprocessor"></span><span class="preprocessor">#define OP_W_DEF(OP,FUNC,STR,DST,CLASSIFICATION) case OP: has_dst = (DST!=0); break;</span>
<a name="l00867"></a>00867 <span class="preprocessor"></span><span class="preprocessor">#include &quot;opcodes.def&quot;</span>
<a name="l00868"></a>00868 <span class="preprocessor">#undef OP_DEF</span>
<a name="l00869"></a>00869 <span class="preprocessor"></span><span class="preprocessor">#undef OP_W_DEF</span>
<a name="l00870"></a>00870 <span class="preprocessor"></span>   <span class="keywordflow">default</span>:
<a name="l00871"></a>00871       printf( <span class="stringliteral">&quot;Execution error: Invalid opcode (0x%x)\n&quot;</span>, <a class="code" href="classptx__instruction.html#a7e1df5ccd2482be6275b3267b6af2d85">get_opcode</a>() );
<a name="l00872"></a>00872       <span class="keywordflow">break</span>;
<a name="l00873"></a>00873    }
<a name="l00874"></a>00874 
<a name="l00875"></a>00875    <span class="keywordflow">switch</span>( <a class="code" href="classptx__instruction.html#a365126b72d31a4df954cbe106ad742a9">m_cache_option</a> ) {
<a name="l00876"></a>00876    <span class="keywordflow">case</span> CA_OPTION: <a class="code" href="classinst__t.html#a329da97dfe6b0972748e988793b1d684">cache_op</a> = <a class="code" href="abstract__hardware__model_8h.html#ab204345d04c216e6d47f2f19501d7072a7f6f5a50dde8b6fceeee8e7cdd2b5684">CACHE_ALL</a>; <span class="keywordflow">break</span>;
<a name="l00877"></a>00877    <span class="keywordflow">case</span> CG_OPTION: <a class="code" href="classinst__t.html#a329da97dfe6b0972748e988793b1d684">cache_op</a> = <a class="code" href="abstract__hardware__model_8h.html#ab204345d04c216e6d47f2f19501d7072a652584484432dcd6c7a2a620a2ee44cf">CACHE_GLOBAL</a>; <span class="keywordflow">break</span>;
<a name="l00878"></a>00878    <span class="keywordflow">case</span> CS_OPTION: <a class="code" href="classinst__t.html#a329da97dfe6b0972748e988793b1d684">cache_op</a> = <a class="code" href="abstract__hardware__model_8h.html#ab204345d04c216e6d47f2f19501d7072a674b0aeb912b6b1fa21037b353b0718d">CACHE_STREAMING</a>; <span class="keywordflow">break</span>;
<a name="l00879"></a>00879    <span class="keywordflow">case</span> LU_OPTION: <a class="code" href="classinst__t.html#a329da97dfe6b0972748e988793b1d684">cache_op</a> = <a class="code" href="abstract__hardware__model_8h.html#ab204345d04c216e6d47f2f19501d7072a33cc09777888a5646ac3f56318f578ba">CACHE_LAST_USE</a>; <span class="keywordflow">break</span>;
<a name="l00880"></a>00880    <span class="keywordflow">case</span> CV_OPTION: <a class="code" href="classinst__t.html#a329da97dfe6b0972748e988793b1d684">cache_op</a> = <a class="code" href="abstract__hardware__model_8h.html#ab204345d04c216e6d47f2f19501d7072a80c73f786357a252982d04b823c24e88">CACHE_VOLATILE</a>; <span class="keywordflow">break</span>;
<a name="l00881"></a>00881    <span class="keywordflow">case</span> WB_OPTION: <a class="code" href="classinst__t.html#a329da97dfe6b0972748e988793b1d684">cache_op</a> = <a class="code" href="abstract__hardware__model_8h.html#ab204345d04c216e6d47f2f19501d7072a1412cfbe9572dd134b563bff6a032b0b">CACHE_WRITE_BACK</a>; <span class="keywordflow">break</span>;
<a name="l00882"></a>00882    <span class="keywordflow">case</span> WT_OPTION: <a class="code" href="classinst__t.html#a329da97dfe6b0972748e988793b1d684">cache_op</a> = <a class="code" href="abstract__hardware__model_8h.html#ab204345d04c216e6d47f2f19501d7072a32a0f91706880ac8c1dd90a3f1843ba5">CACHE_WRITE_THROUGH</a>; <span class="keywordflow">break</span>;
<a name="l00883"></a>00883    <span class="keywordflow">default</span>: 
<a name="l00884"></a>00884       <span class="keywordflow">if</span>( <a class="code" href="classptx__instruction.html#a701349bc06eb65b5c49a83140bfc8936">m_opcode</a> == LD_OP || <a class="code" href="classptx__instruction.html#a701349bc06eb65b5c49a83140bfc8936">m_opcode</a> == LDU_OP ) 
<a name="l00885"></a>00885          <a class="code" href="classinst__t.html#a329da97dfe6b0972748e988793b1d684">cache_op</a> = <a class="code" href="abstract__hardware__model_8h.html#ab204345d04c216e6d47f2f19501d7072a7f6f5a50dde8b6fceeee8e7cdd2b5684">CACHE_ALL</a>;
<a name="l00886"></a>00886       <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code" href="classptx__instruction.html#a701349bc06eb65b5c49a83140bfc8936">m_opcode</a> == ST_OP ) 
<a name="l00887"></a>00887          <a class="code" href="classinst__t.html#a329da97dfe6b0972748e988793b1d684">cache_op</a> = <a class="code" href="abstract__hardware__model_8h.html#ab204345d04c216e6d47f2f19501d7072a1412cfbe9572dd134b563bff6a032b0b">CACHE_WRITE_BACK</a>;
<a name="l00888"></a>00888       <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code" href="classptx__instruction.html#a701349bc06eb65b5c49a83140bfc8936">m_opcode</a> == ATOM_OP ) 
<a name="l00889"></a>00889          <a class="code" href="classinst__t.html#a329da97dfe6b0972748e988793b1d684">cache_op</a> = <a class="code" href="abstract__hardware__model_8h.html#ab204345d04c216e6d47f2f19501d7072a652584484432dcd6c7a2a620a2ee44cf">CACHE_GLOBAL</a>;
<a name="l00890"></a>00890       <span class="keywordflow">break</span>;
<a name="l00891"></a>00891    }
<a name="l00892"></a>00892 
<a name="l00893"></a>00893    <a class="code" href="classptx__instruction.html#aa7c387a9e9e8af4527a013e60a985d41">set_opcode_and_latency</a>();
<a name="l00894"></a>00894    <a class="code" href="classptx__instruction.html#a946f57356ab995805e85d2f3b684f556">set_bar_type</a>();
<a name="l00895"></a>00895    <span class="comment">// Get register operands</span>
<a name="l00896"></a>00896    <span class="keywordtype">int</span> <a class="code" href="rng-double_8c.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>=0,m=0;
<a name="l00897"></a>00897    <a class="code" href="classptx__instruction.html#a24febaf42bc3734c1d6de6f57c57689c">ptx_instruction::const_iterator</a> opr=<a class="code" href="classptx__instruction.html#af4d12fe8d4e70c04a231e6c46af27a66">op_iter_begin</a>();
<a name="l00898"></a>00898    <span class="keywordflow">for</span> ( ; opr != <a class="code" href="classptx__instruction.html#a5487ba45c30115588e6ad73676221fe9">op_iter_end</a>(); opr++, n++ ) { <span class="comment">//process operands</span>
<a name="l00899"></a>00899       <span class="keyword">const</span> <a class="code" href="classoperand__info.html">operand_info</a> &amp;o = *opr;
<a name="l00900"></a>00900       <span class="keywordflow">if</span> ( has_dst &amp;&amp; n==0 ) {
<a name="l00901"></a>00901          <span class="comment">// Do not set the null register &quot;_&quot; as an architectural register</span>
<a name="l00902"></a>00902          <span class="keywordflow">if</span> ( o.<a class="code" href="classoperand__info.html#ab1bf5df3e02f812b616891f8c2c7bf7f">is_reg</a>() &amp;&amp; !o.<a class="code" href="classoperand__info.html#ad5d1bb5401acd7a0f7a39ed48ab6549a">is_non_arch_reg</a>() ) {
<a name="l00903"></a>00903             <a class="code" href="classinst__t.html#a3c2c79e427a4d22fbf44264857a02c51">out</a>[0] = o.<a class="code" href="classoperand__info.html#a6810079f122cc00414f068baca1ef12a">reg_num</a>();
<a name="l00904"></a>00904             <a class="code" href="classinst__t.html#a88db6b095dc8d40a932891f69e4baa27">arch_reg</a>.dst[0] = o.<a class="code" href="classoperand__info.html#a4cd41f36df4c50d5ac431b06f4754cbf">arch_reg_num</a>();
<a name="l00905"></a>00905          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( o.<a class="code" href="classoperand__info.html#a2d9731133be1063f65d792099473e426">is_vector</a>() ) {
<a name="l00906"></a>00906             <a class="code" href="classinst__t.html#aa68a80e8ae373709df3c0a6eab56616d">is_vectorin</a> = 1;
<a name="l00907"></a>00907             <span class="keywordtype">unsigned</span> num_elem = o.<a class="code" href="classoperand__info.html#ac45793fc8d4cad1dfe18a3c165c9e18f">get_vect_nelem</a>();
<a name="l00908"></a>00908             <span class="keywordflow">if</span>( num_elem &gt;= 1 ) <a class="code" href="classinst__t.html#a3c2c79e427a4d22fbf44264857a02c51">out</a>[0] = o.<a class="code" href="classoperand__info.html#a8e1f83c137440e15a4e5ad0b65a8828a">reg1_num</a>();
<a name="l00909"></a>00909             <span class="keywordflow">if</span>( num_elem &gt;= 2 ) <a class="code" href="classinst__t.html#a3c2c79e427a4d22fbf44264857a02c51">out</a>[1] = o.<a class="code" href="classoperand__info.html#ac12f17fdee0fa4fa4447384b7be498ec">reg2_num</a>();
<a name="l00910"></a>00910             <span class="keywordflow">if</span>( num_elem &gt;= 3 ) <a class="code" href="classinst__t.html#a3c2c79e427a4d22fbf44264857a02c51">out</a>[2] = o.<a class="code" href="classoperand__info.html#aaf14369b8ac8186196cda8f4a45d9b35">reg3_num</a>();
<a name="l00911"></a>00911             <span class="keywordflow">if</span>( num_elem &gt;= 4 ) <a class="code" href="classinst__t.html#a3c2c79e427a4d22fbf44264857a02c51">out</a>[3] = o.<a class="code" href="classoperand__info.html#a1cd4df471f253db54dad0e0cc49b9cfa">reg4_num</a>();
<a name="l00912"></a>00912             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="rng-double_8c.html#aa42a9a9cb6e2b93d7f825c395af871bf">i</a> = 0; <a class="code" href="rng-double_8c.html#aa42a9a9cb6e2b93d7f825c395af871bf">i</a> &lt; num_elem; <a class="code" href="rng-double_8c.html#aa42a9a9cb6e2b93d7f825c395af871bf">i</a>++) 
<a name="l00913"></a>00913                <a class="code" href="classinst__t.html#a88db6b095dc8d40a932891f69e4baa27">arch_reg</a>.dst[<a class="code" href="rng-double_8c.html#aa42a9a9cb6e2b93d7f825c395af871bf">i</a>] = o.<a class="code" href="classoperand__info.html#a4cd41f36df4c50d5ac431b06f4754cbf">arch_reg_num</a>(<a class="code" href="rng-double_8c.html#aa42a9a9cb6e2b93d7f825c395af871bf">i</a>);
<a name="l00914"></a>00914          }
<a name="l00915"></a>00915       } <span class="keywordflow">else</span> {
<a name="l00916"></a>00916          <span class="keywordflow">if</span> ( o.<a class="code" href="classoperand__info.html#ab1bf5df3e02f812b616891f8c2c7bf7f">is_reg</a>() &amp;&amp; !o.<a class="code" href="classoperand__info.html#ad5d1bb5401acd7a0f7a39ed48ab6549a">is_non_arch_reg</a>() ) {
<a name="l00917"></a>00917             <span class="keywordtype">int</span> reg_num = o.<a class="code" href="classoperand__info.html#a6810079f122cc00414f068baca1ef12a">reg_num</a>();
<a name="l00918"></a>00918             <a class="code" href="classinst__t.html#a88db6b095dc8d40a932891f69e4baa27">arch_reg</a>.src[m] = o.<a class="code" href="classoperand__info.html#a4cd41f36df4c50d5ac431b06f4754cbf">arch_reg_num</a>();
<a name="l00919"></a>00919             <span class="keywordflow">switch</span> ( m ) {
<a name="l00920"></a>00920             <span class="keywordflow">case</span> 0: <a class="code" href="classinst__t.html#a5fb3f3e1f0a98e2c25f51251cf495e9a">in</a>[0] = reg_num; <span class="keywordflow">break</span>;
<a name="l00921"></a>00921             <span class="keywordflow">case</span> 1: <a class="code" href="classinst__t.html#a5fb3f3e1f0a98e2c25f51251cf495e9a">in</a>[1] = reg_num; <span class="keywordflow">break</span>;
<a name="l00922"></a>00922             <span class="keywordflow">case</span> 2: <a class="code" href="classinst__t.html#a5fb3f3e1f0a98e2c25f51251cf495e9a">in</a>[2] = reg_num; <span class="keywordflow">break</span>;
<a name="l00923"></a>00923             <span class="keywordflow">default</span>: <span class="keywordflow">break</span>; 
<a name="l00924"></a>00924             }
<a name="l00925"></a>00925             m++;
<a name="l00926"></a>00926          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( o.<a class="code" href="classoperand__info.html#a2d9731133be1063f65d792099473e426">is_vector</a>() ) {
<a name="l00927"></a>00927             <span class="comment">//assert(m == 0); //only support 1 vector operand (for textures) right now</span>
<a name="l00928"></a>00928             <a class="code" href="classinst__t.html#a6f9b659317654b0182e79b429b259431">is_vectorout</a> = 1;
<a name="l00929"></a>00929             <span class="keywordtype">unsigned</span> num_elem = o.<a class="code" href="classoperand__info.html#ac45793fc8d4cad1dfe18a3c165c9e18f">get_vect_nelem</a>();
<a name="l00930"></a>00930             <span class="keywordflow">if</span>( num_elem &gt;= 1 ) <a class="code" href="classinst__t.html#a5fb3f3e1f0a98e2c25f51251cf495e9a">in</a>[0] = o.<a class="code" href="classoperand__info.html#a8e1f83c137440e15a4e5ad0b65a8828a">reg1_num</a>();
<a name="l00931"></a>00931             <span class="keywordflow">if</span>( num_elem &gt;= 2 ) <a class="code" href="classinst__t.html#a5fb3f3e1f0a98e2c25f51251cf495e9a">in</a>[1] = o.<a class="code" href="classoperand__info.html#ac12f17fdee0fa4fa4447384b7be498ec">reg2_num</a>();
<a name="l00932"></a>00932             <span class="keywordflow">if</span>( num_elem &gt;= 3 ) <a class="code" href="classinst__t.html#a5fb3f3e1f0a98e2c25f51251cf495e9a">in</a>[2] = o.<a class="code" href="classoperand__info.html#aaf14369b8ac8186196cda8f4a45d9b35">reg3_num</a>();
<a name="l00933"></a>00933             <span class="keywordflow">if</span>( num_elem &gt;= 4 ) <a class="code" href="classinst__t.html#a5fb3f3e1f0a98e2c25f51251cf495e9a">in</a>[3] = o.<a class="code" href="classoperand__info.html#a1cd4df471f253db54dad0e0cc49b9cfa">reg4_num</a>();
<a name="l00934"></a>00934             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="rng-double_8c.html#aa42a9a9cb6e2b93d7f825c395af871bf">i</a> = 0; <a class="code" href="rng-double_8c.html#aa42a9a9cb6e2b93d7f825c395af871bf">i</a> &lt; num_elem; <a class="code" href="rng-double_8c.html#aa42a9a9cb6e2b93d7f825c395af871bf">i</a>++) 
<a name="l00935"></a>00935                <a class="code" href="classinst__t.html#a88db6b095dc8d40a932891f69e4baa27">arch_reg</a>.src[<a class="code" href="rng-double_8c.html#aa42a9a9cb6e2b93d7f825c395af871bf">i</a>] = o.<a class="code" href="classoperand__info.html#a4cd41f36df4c50d5ac431b06f4754cbf">arch_reg_num</a>(<a class="code" href="rng-double_8c.html#aa42a9a9cb6e2b93d7f825c395af871bf">i</a>);
<a name="l00936"></a>00936             m+=4;
<a name="l00937"></a>00937          }
<a name="l00938"></a>00938       }
<a name="l00939"></a>00939    }
<a name="l00940"></a>00940 
<a name="l00941"></a>00941    <span class="comment">// Get predicate</span>
<a name="l00942"></a>00942    <span class="keywordflow">if</span>(<a class="code" href="classptx__instruction.html#a4a59a40f681e221e013ff726428c4b1a">has_pred</a>()) {
<a name="l00943"></a>00943        <span class="keyword">const</span> <a class="code" href="classoperand__info.html">operand_info</a> &amp;p = <a class="code" href="classptx__instruction.html#a87fa0a3daeda27af453c167a060a22d4">get_pred</a>();
<a name="l00944"></a>00944        <a class="code" href="classinst__t.html#a352aa924f31558eb543c8a9ab6769367">pred</a> = p.<a class="code" href="classoperand__info.html#a6810079f122cc00414f068baca1ef12a">reg_num</a>();
<a name="l00945"></a>00945    }
<a name="l00946"></a>00946 
<a name="l00947"></a>00947    <span class="comment">// Get address registers inside memory operands.</span>
<a name="l00948"></a>00948    <span class="comment">// Assuming only one memory operand per instruction,</span>
<a name="l00949"></a>00949    <span class="comment">//  and maximum of two address registers for one memory operand.</span>
<a name="l00950"></a>00950    <span class="keywordflow">if</span>( <a class="code" href="classptx__instruction.html#ad5bc475bdc4ad3d041e74ac326e5a8c0">has_memory_read</a>() || <a class="code" href="classptx__instruction.html#a438e0d906c02aee4c752fbc75b7cd01a">has_memory_write</a>() ) {
<a name="l00951"></a>00951       <a class="code" href="classptx__instruction.html#a24febaf42bc3734c1d6de6f57c57689c">ptx_instruction::const_iterator</a> <a class="code" href="classinst__t.html#a5e7e56fb753710a255876d382fda08c3">op</a>=<a class="code" href="classptx__instruction.html#af4d12fe8d4e70c04a231e6c46af27a66">op_iter_begin</a>();
<a name="l00952"></a>00952       <span class="keywordflow">for</span> ( ; op != <a class="code" href="classptx__instruction.html#a5487ba45c30115588e6ad73676221fe9">op_iter_end</a>(); op++, n++ ) { <span class="comment">//process operands</span>
<a name="l00953"></a>00953          <span class="keyword">const</span> <a class="code" href="classoperand__info.html">operand_info</a> &amp;o = *op;
<a name="l00954"></a>00954 
<a name="l00955"></a>00955          <span class="keywordflow">if</span>(o.<a class="code" href="classoperand__info.html#ae5388f733f2ef7965edbf9ea53d5b592">is_memory_operand</a>()) {
<a name="l00956"></a>00956              <span class="comment">// We do not support the null register as a memory operand</span>
<a name="l00957"></a>00957              assert( !o.<a class="code" href="classoperand__info.html#ad5d1bb5401acd7a0f7a39ed48ab6549a">is_non_arch_reg</a>() );
<a name="l00958"></a>00958 
<a name="l00959"></a>00959             <span class="comment">// Check PTXPlus-type operand</span>
<a name="l00960"></a>00960             <span class="comment">// memory operand with addressing (ex. s[0x4] or g[$r1])</span>
<a name="l00961"></a>00961             <span class="keywordflow">if</span>(o.<a class="code" href="classoperand__info.html#a4e23657b04aa7be85ceaf8195785d6d5">is_memory_operand2</a>()) {
<a name="l00962"></a>00962 
<a name="l00963"></a>00963                <span class="comment">// memory operand with one address register (ex. g[$r1+0x4] or s[$r2+=0x4])</span>
<a name="l00964"></a>00964                <span class="keywordflow">if</span>(o.<a class="code" href="classoperand__info.html#a10b0a76daa24e46ed1c9dbef4f603f71">get_double_operand_type</a>() == 0 || o.<a class="code" href="classoperand__info.html#a10b0a76daa24e46ed1c9dbef4f603f71">get_double_operand_type</a>() == 3){
<a name="l00965"></a>00965                   <a class="code" href="classinst__t.html#ae245a88c92eccb464ea3510a5d70c736">ar1</a> = o.<a class="code" href="classoperand__info.html#a6810079f122cc00414f068baca1ef12a">reg_num</a>();
<a name="l00966"></a>00966                   <a class="code" href="classinst__t.html#a88db6b095dc8d40a932891f69e4baa27">arch_reg</a>.src[4] = o.<a class="code" href="classoperand__info.html#a4cd41f36df4c50d5ac431b06f4754cbf">arch_reg_num</a>();
<a name="l00967"></a>00967                   <span class="comment">// TODO: address register in $r2+=0x4 should be an output register as well</span>
<a name="l00968"></a>00968                }
<a name="l00969"></a>00969                <span class="comment">// memory operand with two address register (ex. s[$r1+$r1] or g[$r1+=$r2])</span>
<a name="l00970"></a>00970                <span class="keywordflow">else</span> <span class="keywordflow">if</span>(o.<a class="code" href="classoperand__info.html#a10b0a76daa24e46ed1c9dbef4f603f71">get_double_operand_type</a>() == 1 || o.<a class="code" href="classoperand__info.html#a10b0a76daa24e46ed1c9dbef4f603f71">get_double_operand_type</a>() == 2) {
<a name="l00971"></a>00971                   <a class="code" href="classinst__t.html#ae245a88c92eccb464ea3510a5d70c736">ar1</a> = o.<a class="code" href="classoperand__info.html#a8e1f83c137440e15a4e5ad0b65a8828a">reg1_num</a>();
<a name="l00972"></a>00972                   <a class="code" href="classinst__t.html#a88db6b095dc8d40a932891f69e4baa27">arch_reg</a>.src[4] = o.<a class="code" href="classoperand__info.html#a4cd41f36df4c50d5ac431b06f4754cbf">arch_reg_num</a>();
<a name="l00973"></a>00973                   <a class="code" href="classinst__t.html#a932df482f6c89b8b7e2b27923dc4bbf1">ar2</a> = o.<a class="code" href="classoperand__info.html#ac12f17fdee0fa4fa4447384b7be498ec">reg2_num</a>();
<a name="l00974"></a>00974                   <a class="code" href="classinst__t.html#a88db6b095dc8d40a932891f69e4baa27">arch_reg</a>.src[5] = o.<a class="code" href="classoperand__info.html#a4cd41f36df4c50d5ac431b06f4754cbf">arch_reg_num</a>();
<a name="l00975"></a>00975                   <span class="comment">// TODO: first address register in $r1+=$r2 should be an output register as well</span>
<a name="l00976"></a>00976                }
<a name="l00977"></a>00977             }
<a name="l00978"></a>00978             <span class="keywordflow">else</span> <span class="keywordflow">if</span>(o.<a class="code" href="classoperand__info.html#a106a13aa2f58c89100dab20f3319f5fc">is_immediate_address</a>()){
<a name="l00979"></a>00979 
<a name="l00980"></a>00980             }
<a name="l00981"></a>00981             <span class="comment">// Regular PTX operand</span>
<a name="l00982"></a>00982             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (o.<a class="code" href="classoperand__info.html#a90cf6e60e556a54e6ee775a777bfe169">get_symbol</a>()-&gt;<a class="code" href="classsymbol.html#af8da68543a752fdbd25f4b905f2ab6da">type</a>()-&gt;<a class="code" href="classtype__info.html#acf7d3f7834206cc07553246538e409b9">get_key</a>().<a class="code" href="classtype__info__key.html#ae4415cad34f996132770f7ae35cf3817">is_reg</a>()) { <span class="comment">// Memory operand contains a register</span>
<a name="l00983"></a>00983               <a class="code" href="classinst__t.html#ae245a88c92eccb464ea3510a5d70c736">ar1</a> = o.<a class="code" href="classoperand__info.html#a6810079f122cc00414f068baca1ef12a">reg_num</a>();
<a name="l00984"></a>00984               <a class="code" href="classinst__t.html#a88db6b095dc8d40a932891f69e4baa27">arch_reg</a>.src[4] = o.<a class="code" href="classoperand__info.html#a4cd41f36df4c50d5ac431b06f4754cbf">arch_reg_num</a>();
<a name="l00985"></a>00985             }
<a name="l00986"></a>00986 
<a name="l00987"></a>00987          }
<a name="l00988"></a>00988       }
<a name="l00989"></a>00989    }
<a name="l00990"></a>00990 
<a name="l00991"></a>00991    <span class="comment">// get reconvergence pc</span>
<a name="l00992"></a>00992    <a class="code" href="classinst__t.html#ad3da0fc2ad36b2b1c2cbd2f1c980da52">reconvergence_pc</a> = <a class="code" href="cuda-sim_8cc.html#af120e92007c89cb8547a22515d6caebd">get_converge_point</a>(<a class="code" href="classinst__t.html#a76aea27709c3a0256c2615451c7daa56">pc</a>);
<a name="l00993"></a>00993 
<a name="l00994"></a>00994    <a class="code" href="classinst__t.html#a27943eef81f5eeec20fbee76ac3b233f">m_decoded</a>=<span class="keyword">true</span>;
<a name="l00995"></a>00995 }
<a name="l00996"></a>00996 
<a name="l00997"></a><a class="code" href="classfunction__info.html#af9fafceddcceccb6d0eeef221e1b7081">00997</a> <span class="keywordtype">void</span> <a class="code" href="classfunction__info.html#af9fafceddcceccb6d0eeef221e1b7081">function_info::add_param_name_type_size</a>( <span class="keywordtype">unsigned</span> index, std::string name, <span class="keywordtype">int</span> type, <span class="keywordtype">size_t</span> size, <span class="keywordtype">bool</span> ptr, <a class="code" href="classmemory__space__t.html">memory_space_t</a> space )
<a name="l00998"></a>00998 {
<a name="l00999"></a>00999    <span class="keywordtype">unsigned</span> parsed_index;
<a name="l01000"></a>01000    <span class="keywordtype">char</span> buffer[2048];
<a name="l01001"></a>01001    snprintf(buffer,2048,<span class="stringliteral">&quot;%s_param_%%u&quot;</span>, <a class="code" href="classfunction__info.html#ae429d24ea09e1137b4c9db2dec199748">m_name</a>.c_str() );
<a name="l01002"></a>01002    <span class="keywordtype">int</span> ntokens = sscanf(name.c_str(),buffer,&amp;parsed_index);
<a name="l01003"></a>01003    <span class="keywordflow">if</span>( ntokens == 1 ) {
<a name="l01004"></a>01004       assert( <a class="code" href="classfunction__info.html#a7dde9640bcdd7c12b3fb59149010620b">m_ptx_kernel_param_info</a>.find(parsed_index) == <a class="code" href="classfunction__info.html#a7dde9640bcdd7c12b3fb59149010620b">m_ptx_kernel_param_info</a>.end() );
<a name="l01005"></a>01005       <a class="code" href="classfunction__info.html#a7dde9640bcdd7c12b3fb59149010620b">m_ptx_kernel_param_info</a>[parsed_index] = <a class="code" href="classparam__info.html">param_info</a>(name, type, size, ptr, space);
<a name="l01006"></a>01006    } <span class="keywordflow">else</span> {
<a name="l01007"></a>01007       assert( <a class="code" href="classfunction__info.html#a7dde9640bcdd7c12b3fb59149010620b">m_ptx_kernel_param_info</a>.find(index) == <a class="code" href="classfunction__info.html#a7dde9640bcdd7c12b3fb59149010620b">m_ptx_kernel_param_info</a>.end() );
<a name="l01008"></a>01008       <a class="code" href="classfunction__info.html#a7dde9640bcdd7c12b3fb59149010620b">m_ptx_kernel_param_info</a>[index] = <a class="code" href="classparam__info.html">param_info</a>(name, type, size, ptr, space);
<a name="l01009"></a>01009    }
<a name="l01010"></a>01010 }
<a name="l01011"></a>01011 
<a name="l01012"></a><a class="code" href="classfunction__info.html#a37e8b015fb8a89f0771ebf25ecc0b12d">01012</a> <span class="keywordtype">void</span> <a class="code" href="classfunction__info.html#a37e8b015fb8a89f0771ebf25ecc0b12d">function_info::add_param_data</a>( <span class="keywordtype">unsigned</span> argn, <span class="keyword">struct</span> <a class="code" href="structgpgpu__ptx__sim__arg.html">gpgpu_ptx_sim_arg</a> *args )
<a name="l01013"></a>01013 {
<a name="l01014"></a>01014    <span class="keyword">const</span> <span class="keywordtype">void</span> *data = args-&gt;<a class="code" href="structgpgpu__ptx__sim__arg.html#a6e0e4837ebb297980acaadb26d1e74a7">m_start</a>;
<a name="l01015"></a>01015 
<a name="l01016"></a>01016    <span class="keywordtype">bool</span> scratchpad_memory_param = <span class="keyword">false</span>; <span class="comment">// Is this parameter in CUDA shared memory or OpenCL local memory </span>
<a name="l01017"></a>01017 
<a name="l01018"></a>01018    std::map&lt;unsigned,param_info&gt;::iterator <a class="code" href="rng-double_8c.html#aa42a9a9cb6e2b93d7f825c395af871bf">i</a>=<a class="code" href="classfunction__info.html#a7dde9640bcdd7c12b3fb59149010620b">m_ptx_kernel_param_info</a>.find(argn);
<a name="l01019"></a>01019    <span class="keywordflow">if</span>( i != <a class="code" href="classfunction__info.html#a7dde9640bcdd7c12b3fb59149010620b">m_ptx_kernel_param_info</a>.end() ) {
<a name="l01020"></a>01020       <span class="keywordflow">if</span> (i-&gt;second.is_ptr_shared()) {
<a name="l01021"></a>01021          assert(args-&gt;<a class="code" href="structgpgpu__ptx__sim__arg.html#a6e0e4837ebb297980acaadb26d1e74a7">m_start</a> == NULL &amp;&amp; <span class="stringliteral">&quot;OpenCL parameter pointer to local memory must have NULL as value&quot;</span>); 
<a name="l01022"></a>01022          scratchpad_memory_param = <span class="keyword">true</span>; 
<a name="l01023"></a>01023       } <span class="keywordflow">else</span> {
<a name="l01024"></a>01024          <a class="code" href="structparam__t.html">param_t</a> tmp;
<a name="l01025"></a>01025          tmp.<a class="code" href="structparam__t.html#ae8efb133c4cd22d297ff43a2dabc7283">pdata</a> = args-&gt;<a class="code" href="structgpgpu__ptx__sim__arg.html#a6e0e4837ebb297980acaadb26d1e74a7">m_start</a>;
<a name="l01026"></a>01026          tmp.<a class="code" href="structparam__t.html#a9663347dc222a7125abd4035cbfe6d6d">size</a> = args-&gt;<a class="code" href="structgpgpu__ptx__sim__arg.html#ac341052373ac06d2b8433092b9239150">m_nbytes</a>;
<a name="l01027"></a>01027          tmp.<a class="code" href="structparam__t.html#a0e498064d033b4f46ec4eccf2cc53f54">offset</a> = args-&gt;<a class="code" href="structgpgpu__ptx__sim__arg.html#a402bf8bf22111e3aa03058b9f6fc6699">m_offset</a>;
<a name="l01028"></a>01028          tmp.<a class="code" href="structparam__t.html#a5f84c3b1de68bc8a18284467e1ee4d48">type</a> = 0;
<a name="l01029"></a>01029          i-&gt;second.add_data(tmp);
<a name="l01030"></a>01030          i-&gt;second.add_offset((<span class="keywordtype">unsigned</span>) args-&gt;<a class="code" href="structgpgpu__ptx__sim__arg.html#a402bf8bf22111e3aa03058b9f6fc6699">m_offset</a>);
<a name="l01031"></a>01031       }
<a name="l01032"></a>01032    } <span class="keywordflow">else</span> {
<a name="l01033"></a>01033       scratchpad_memory_param = <span class="keyword">true</span>; 
<a name="l01034"></a>01034    }
<a name="l01035"></a>01035 
<a name="l01036"></a>01036    <span class="keywordflow">if</span> (scratchpad_memory_param) {
<a name="l01037"></a>01037       <span class="comment">// This should only happen for OpenCL:</span>
<a name="l01038"></a>01038       <span class="comment">// </span>
<a name="l01039"></a>01039       <span class="comment">// The LLVM PTX compiler in NVIDIA&apos;s driver (version 190.29)</span>
<a name="l01040"></a>01040       <span class="comment">// does not generate an argument in the function declaration </span>
<a name="l01041"></a>01041       <span class="comment">// for __constant arguments.</span>
<a name="l01042"></a>01042       <span class="comment">//</span>
<a name="l01043"></a>01043       <span class="comment">// The associated constant memory space can be allocated in two </span>
<a name="l01044"></a>01044       <span class="comment">// ways. It can be explicitly initialized in the .ptx file where</span>
<a name="l01045"></a>01045       <span class="comment">// it is declared.  Or, it can be allocated using the clCreateBuffer</span>
<a name="l01046"></a>01046       <span class="comment">// on the host. In this later case, the .ptx file will contain </span>
<a name="l01047"></a>01047       <span class="comment">// a global declaration of the parameter, but it will have an unknown</span>
<a name="l01048"></a>01048       <span class="comment">// array size.  Thus, the symbol&apos;s address will not be set and we need</span>
<a name="l01049"></a>01049       <span class="comment">// to set it here before executing the PTX.</span>
<a name="l01050"></a>01050       
<a name="l01051"></a>01051       <span class="keywordtype">char</span> buffer[2048];
<a name="l01052"></a>01052       snprintf(buffer,2048,<span class="stringliteral">&quot;%s_param_%u&quot;</span>,<a class="code" href="classfunction__info.html#ae429d24ea09e1137b4c9db2dec199748">m_name</a>.c_str(),argn);
<a name="l01053"></a>01053       
<a name="l01054"></a>01054       <a class="code" href="classsymbol.html">symbol</a> *p = <a class="code" href="classfunction__info.html#a3f7023b4692eb867e28747b96b37c413">m_symtab</a>-&gt;<a class="code" href="classsymbol__table.html#a85bce701e77966eb7c42b938b046d272">lookup</a>(buffer);
<a name="l01055"></a>01055       <span class="keywordflow">if</span>( p == NULL ) {
<a name="l01056"></a>01056          printf(<span class="stringliteral">&quot;GPGPU-Sim PTX: ERROR ** could not locate symbol for \&apos;%s\&apos; : cannot bind buffer\n&quot;</span>, buffer);
<a name="l01057"></a>01057          abort();
<a name="l01058"></a>01058       }
<a name="l01059"></a>01059       <span class="keywordflow">if</span>( data ) 
<a name="l01060"></a>01060          p-&gt;set_address((<a class="code" href="abstract__hardware__model_8h.html#a92b0c0d30c36a95c916f27a55784ca33">addr_t</a>)*(<span class="keywordtype">size_t</span>*)data);
<a name="l01061"></a>01061       <span class="keywordflow">else</span> {
<a name="l01062"></a>01062          <span class="comment">// clSetKernelArg was passed NULL pointer for data...</span>
<a name="l01063"></a>01063          <span class="comment">// this is used for dynamically sized shared memory on NVIDIA platforms</span>
<a name="l01064"></a>01064          <span class="keywordtype">bool</span> is_ptr_shared = <span class="keyword">false</span>; 
<a name="l01065"></a>01065          <span class="keywordflow">if</span>( i != <a class="code" href="classfunction__info.html#a7dde9640bcdd7c12b3fb59149010620b">m_ptx_kernel_param_info</a>.end() ) {
<a name="l01066"></a>01066             is_ptr_shared = i-&gt;second.is_ptr_shared(); 
<a name="l01067"></a>01067          }
<a name="l01068"></a>01068 
<a name="l01069"></a>01069          <span class="keywordflow">if</span>( !is_ptr_shared and !p-&gt;is_shared() ) {
<a name="l01070"></a>01070             printf(<span class="stringliteral">&quot;GPGPU-Sim PTX: ERROR ** clSetKernelArg passed NULL but arg not shared memory\n&quot;</span>);
<a name="l01071"></a>01071             abort();     
<a name="l01072"></a>01072          }
<a name="l01073"></a>01073          <span class="keywordtype">unsigned</span> num_bits = 8*args-&gt;<a class="code" href="structgpgpu__ptx__sim__arg.html#ac341052373ac06d2b8433092b9239150">m_nbytes</a>;
<a name="l01074"></a>01074          printf(<span class="stringliteral">&quot;GPGPU-Sim PTX: deferred allocation of shared region for \&quot;%s\&quot; from 0x%x to 0x%x (shared memory space)\n&quot;</span>,
<a name="l01075"></a>01075                 p-&gt;name().c_str(),
<a name="l01076"></a>01076                 <a class="code" href="classfunction__info.html#a3f7023b4692eb867e28747b96b37c413">m_symtab</a>-&gt;<a class="code" href="classsymbol__table.html#a7acf41bea7d0a4570b30b46ffcf360b3">get_shared_next</a>(),
<a name="l01077"></a>01077                 <a class="code" href="classfunction__info.html#a3f7023b4692eb867e28747b96b37c413">m_symtab</a>-&gt;<a class="code" href="classsymbol__table.html#a7acf41bea7d0a4570b30b46ffcf360b3">get_shared_next</a>() + num_bits/8 );
<a name="l01078"></a>01078          fflush(stdout);
<a name="l01079"></a>01079          assert( (num_bits%8) == 0  );
<a name="l01080"></a>01080          <a class="code" href="abstract__hardware__model_8h.html#a92b0c0d30c36a95c916f27a55784ca33">addr_t</a> addr = <a class="code" href="classfunction__info.html#a3f7023b4692eb867e28747b96b37c413">m_symtab</a>-&gt;<a class="code" href="classsymbol__table.html#a7acf41bea7d0a4570b30b46ffcf360b3">get_shared_next</a>();
<a name="l01081"></a>01081          <a class="code" href="abstract__hardware__model_8h.html#a92b0c0d30c36a95c916f27a55784ca33">addr_t</a> addr_pad = num_bits ? (((num_bits/8) - (addr % (num_bits/8))) % (num_bits/8)) : 0;
<a name="l01082"></a>01082          p-&gt;set_address( addr+addr_pad );
<a name="l01083"></a>01083          <a class="code" href="classfunction__info.html#a3f7023b4692eb867e28747b96b37c413">m_symtab</a>-&gt;<a class="code" href="classsymbol__table.html#a60563f0f4cbf511f4b83a04e7ae13ff4">alloc_shared</a>( num_bits/8 + addr_pad );
<a name="l01084"></a>01084       }
<a name="l01085"></a>01085    } 
<a name="l01086"></a>01086 }
<a name="l01087"></a>01087 
<a name="l01088"></a><a class="code" href="classfunction__info.html#abb6ca9b0fa4ce40fa3fb8eb48e665f32">01088</a> <span class="keywordtype">unsigned</span> <a class="code" href="classfunction__info.html#abb6ca9b0fa4ce40fa3fb8eb48e665f32">function_info::get_args_aligned_size</a>() {
<a name="l01089"></a>01089  
<a name="l01090"></a>01090    <span class="keywordflow">if</span>(<a class="code" href="classfunction__info.html#a938d287a94df62809282e761129309da">m_args_aligned_size</a> &gt;= 0)
<a name="l01091"></a>01091       <span class="keywordflow">return</span> <a class="code" href="classfunction__info.html#a938d287a94df62809282e761129309da">m_args_aligned_size</a>;
<a name="l01092"></a>01092  
<a name="l01093"></a>01093    <span class="keywordtype">unsigned</span> param_address = 0;
<a name="l01094"></a>01094    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> total_size = 0;
<a name="l01095"></a>01095    <span class="keywordflow">for</span>( std::map&lt;unsigned,param_info&gt;::iterator <a class="code" href="rng-double_8c.html#aa42a9a9cb6e2b93d7f825c395af871bf">i</a>=<a class="code" href="classfunction__info.html#a7dde9640bcdd7c12b3fb59149010620b">m_ptx_kernel_param_info</a>.begin(); <a class="code" href="rng-double_8c.html#aa42a9a9cb6e2b93d7f825c395af871bf">i</a>!=<a class="code" href="classfunction__info.html#a7dde9640bcdd7c12b3fb59149010620b">m_ptx_kernel_param_info</a>.end(); <a class="code" href="rng-double_8c.html#aa42a9a9cb6e2b93d7f825c395af871bf">i</a>++ ) {
<a name="l01096"></a>01096       <a class="code" href="classparam__info.html">param_info</a> &amp;p = <a class="code" href="rng-double_8c.html#aa42a9a9cb6e2b93d7f825c395af871bf">i</a>-&gt;second;
<a name="l01097"></a>01097       std::string name = p.<a class="code" href="classparam__info.html#a90511ec5d8e814db8d4fbbb2dc30af67">get_name</a>();
<a name="l01098"></a>01098       <a class="code" href="classsymbol.html">symbol</a> *param = <a class="code" href="classfunction__info.html#a3f7023b4692eb867e28747b96b37c413">m_symtab</a>-&gt;<a class="code" href="classsymbol__table.html#a85bce701e77966eb7c42b938b046d272">lookup</a>(name.c_str());
<a name="l01099"></a>01099 
<a name="l01100"></a>01100       <span class="keywordtype">size_t</span> arg_size = p.<a class="code" href="classparam__info.html#a249b6966994caeca996c850b186ca00b">get_size</a>() / 8; <span class="comment">// size of param in bytes</span>
<a name="l01101"></a>01101       total_size = (total_size + arg_size - 1) / arg_size * arg_size; <span class="comment">//aligned</span>
<a name="l01102"></a>01102       p.<a class="code" href="classparam__info.html#a61248643f5cfbb9e28d4621ceb8fc38b">add_offset</a>(total_size);
<a name="l01103"></a>01103       param-&gt;<a class="code" href="classsymbol.html#acfdf21a91c3583da6aa1d52dad32ce5c">set_address</a>(param_address + total_size);
<a name="l01104"></a>01104       total_size += arg_size;
<a name="l01105"></a>01105    }
<a name="l01106"></a>01106 
<a name="l01107"></a>01107    <a class="code" href="classfunction__info.html#a938d287a94df62809282e761129309da">m_args_aligned_size</a> = (total_size + 3) / 4 * 4; <span class="comment">//final size aligned to word</span>
<a name="l01108"></a>01108 
<a name="l01109"></a>01109    <span class="keywordflow">return</span> <a class="code" href="classfunction__info.html#a938d287a94df62809282e761129309da">m_args_aligned_size</a>;
<a name="l01110"></a>01110 
<a name="l01111"></a>01111 }
<a name="l01112"></a>01112 
<a name="l01113"></a>01113 
<a name="l01114"></a><a class="code" href="classfunction__info.html#aab3481fb9791864a44d333885a258f19">01114</a> <span class="keywordtype">void</span> <a class="code" href="classfunction__info.html#aab3481fb9791864a44d333885a258f19">function_info::finalize</a>( <a class="code" href="classmemory__space.html">memory_space</a> *param_mem ) 
<a name="l01115"></a>01115 {
<a name="l01116"></a>01116    <span class="keywordtype">unsigned</span> param_address = 0;
<a name="l01117"></a>01117    <span class="keywordflow">for</span>( std::map&lt;unsigned,param_info&gt;::iterator <a class="code" href="rng-double_8c.html#aa42a9a9cb6e2b93d7f825c395af871bf">i</a>=<a class="code" href="classfunction__info.html#a7dde9640bcdd7c12b3fb59149010620b">m_ptx_kernel_param_info</a>.begin(); <a class="code" href="rng-double_8c.html#aa42a9a9cb6e2b93d7f825c395af871bf">i</a>!=<a class="code" href="classfunction__info.html#a7dde9640bcdd7c12b3fb59149010620b">m_ptx_kernel_param_info</a>.end(); <a class="code" href="rng-double_8c.html#aa42a9a9cb6e2b93d7f825c395af871bf">i</a>++ ) {
<a name="l01118"></a>01118       <a class="code" href="classparam__info.html">param_info</a> &amp;p = <a class="code" href="rng-double_8c.html#aa42a9a9cb6e2b93d7f825c395af871bf">i</a>-&gt;second;
<a name="l01119"></a>01119       <span class="keywordflow">if</span> (p.<a class="code" href="classparam__info.html#ac2fbf0327b2e53c23fde3b285f32e126">is_ptr_shared</a>()) <span class="keywordflow">continue</span>; <span class="comment">// Pointer to local memory: Should we pass the allocated shared memory address to the param memory space? </span>
<a name="l01120"></a>01120       std::string name = p.<a class="code" href="classparam__info.html#a90511ec5d8e814db8d4fbbb2dc30af67">get_name</a>();
<a name="l01121"></a>01121       <span class="keywordtype">int</span> type = p.<a class="code" href="classparam__info.html#a714e378a4317b300f59fcef815712ffd">get_type</a>();
<a name="l01122"></a>01122       <a class="code" href="structparam__t.html">param_t</a> param_value = p.<a class="code" href="classparam__info.html#a1b04f7a47222077777538920592e9a99">get_value</a>();
<a name="l01123"></a>01123       param_value.<a class="code" href="structparam__t.html#a5f84c3b1de68bc8a18284467e1ee4d48">type</a> = type;
<a name="l01124"></a>01124       <a class="code" href="classsymbol.html">symbol</a> *param = <a class="code" href="classfunction__info.html#a3f7023b4692eb867e28747b96b37c413">m_symtab</a>-&gt;<a class="code" href="classsymbol__table.html#a85bce701e77966eb7c42b938b046d272">lookup</a>(name.c_str());
<a name="l01125"></a>01125       <span class="keywordtype">unsigned</span> xtype = param-&gt;<a class="code" href="classsymbol.html#af8da68543a752fdbd25f4b905f2ab6da">type</a>()-&gt;<a class="code" href="classtype__info.html#acf7d3f7834206cc07553246538e409b9">get_key</a>().<a class="code" href="classtype__info__key.html#a33c88d79d5b6bb80356603bb031f9ceb">scalar_type</a>();
<a name="l01126"></a>01126       assert(xtype==(<span class="keywordtype">unsigned</span>)type);
<a name="l01127"></a>01127       <span class="keywordtype">size_t</span> size;
<a name="l01128"></a>01128       size = param_value.<a class="code" href="structparam__t.html#a9663347dc222a7125abd4035cbfe6d6d">size</a>; <span class="comment">// size of param in bytes</span>
<a name="l01129"></a>01129       <span class="comment">// assert(param_value.offset == param_address);</span>
<a name="l01130"></a>01130       <span class="keywordflow">if</span>( size != p.<a class="code" href="classparam__info.html#a249b6966994caeca996c850b186ca00b">get_size</a>() / 8) {
<a name="l01131"></a>01131          printf(<span class="stringliteral">&quot;GPGPU-Sim PTX: WARNING actual kernel paramter size = %zu bytes vs. formal size = %zu (using smaller of two)\n&quot;</span>,
<a name="l01132"></a>01132                 size, p.<a class="code" href="classparam__info.html#a249b6966994caeca996c850b186ca00b">get_size</a>()/8);
<a name="l01133"></a>01133          size = (size&lt;(p.<a class="code" href="classparam__info.html#a249b6966994caeca996c850b186ca00b">get_size</a>()/8))?size:(p.<a class="code" href="classparam__info.html#a249b6966994caeca996c850b186ca00b">get_size</a>()/8);
<a name="l01134"></a>01134       } 
<a name="l01135"></a>01135       <span class="comment">// copy the parameter over word-by-word so that parameter that crosses a memory page can be copied over</span>
<a name="l01136"></a>01136       <span class="comment">//Jin: copy parameter using aligned rules</span>
<a name="l01137"></a>01137       <span class="keyword">const</span> <span class="keywordtype">size_t</span> word_size = 4; 
<a name="l01138"></a>01138       param_address = (param_address + size - 1) / size * size; <span class="comment">//aligned with size </span>
<a name="l01139"></a>01139       <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> idx = 0; idx &lt; size; idx += word_size) {
<a name="l01140"></a>01140          <span class="keyword">const</span> <span class="keywordtype">char</span> *pdata = <span class="keyword">reinterpret_cast&lt;</span><span class="keyword">const </span><span class="keywordtype">char</span>*<span class="keyword">&gt;</span>(param_value.<a class="code" href="structparam__t.html#ae8efb133c4cd22d297ff43a2dabc7283">pdata</a>) + idx; <span class="comment">// cast to char * for ptr arithmetic</span>
<a name="l01141"></a>01141          param_mem-&gt;<a class="code" href="classmemory__space.html#acc4d70cea1a6c55b70c527b6c80d62a5">write</a>(param_address + idx, word_size, pdata,NULL,NULL); 
<a name="l01142"></a>01142       }
<a name="l01143"></a>01143       <span class="keywordtype">unsigned</span> offset = p.<a class="code" href="classparam__info.html#ac21d65cfa26f0ae150729438dd077102">get_offset</a>();
<a name="l01144"></a>01144       assert(offset == param_address);
<a name="l01145"></a>01145       param-&gt;<a class="code" href="classsymbol.html#acfdf21a91c3583da6aa1d52dad32ce5c">set_address</a>(param_address);
<a name="l01146"></a>01146       param_address += size;
<a name="l01147"></a>01147    }
<a name="l01148"></a>01148 }
<a name="l01149"></a>01149 
<a name="l01150"></a><a class="code" href="classfunction__info.html#a17b876255ebfa62bdf156047be931438">01150</a> <span class="keywordtype">void</span> <a class="code" href="classfunction__info.html#a17b876255ebfa62bdf156047be931438">function_info::param_to_shared</a>( <a class="code" href="classmemory__space.html">memory_space</a> *shared_mem, <a class="code" href="classsymbol__table.html">symbol_table</a> *symtab ) 
<a name="l01151"></a>01151 {
<a name="l01152"></a>01152    <span class="comment">// TODO: call this only for PTXPlus with GT200 models </span>
<a name="l01153"></a>01153    <span class="keyword">extern</span> <a class="code" href="classgpgpu__sim.html">gpgpu_sim</a>* <a class="code" href="gpgpusim__entrypoint_8cc.html#a7943f3582581ae703b6bbc944a8e6f1b">g_the_gpu</a>; 
<a name="l01154"></a>01154    <span class="keywordflow">if</span> (not g_the_gpu-&gt;<a class="code" href="classgpgpu__sim.html#aad04f5dd3114b1020f9d59bb5722c41e">get_config</a>().<a class="code" href="classgpgpu__functional__sim__config.html#a4cc56e9b319b255e3448afb2be34e773">convert_to_ptxplus</a>()) <span class="keywordflow">return</span>; 
<a name="l01155"></a>01155 
<a name="l01156"></a>01156    <span class="comment">// copies parameters into simulated shared memory</span>
<a name="l01157"></a>01157    <span class="keywordflow">for</span>( std::map&lt;unsigned,param_info&gt;::iterator <a class="code" href="rng-double_8c.html#aa42a9a9cb6e2b93d7f825c395af871bf">i</a>=<a class="code" href="classfunction__info.html#a7dde9640bcdd7c12b3fb59149010620b">m_ptx_kernel_param_info</a>.begin(); <a class="code" href="rng-double_8c.html#aa42a9a9cb6e2b93d7f825c395af871bf">i</a>!=<a class="code" href="classfunction__info.html#a7dde9640bcdd7c12b3fb59149010620b">m_ptx_kernel_param_info</a>.end(); <a class="code" href="rng-double_8c.html#aa42a9a9cb6e2b93d7f825c395af871bf">i</a>++ ) {
<a name="l01158"></a>01158       <a class="code" href="classparam__info.html">param_info</a> &amp;p = <a class="code" href="rng-double_8c.html#aa42a9a9cb6e2b93d7f825c395af871bf">i</a>-&gt;second;
<a name="l01159"></a>01159       <span class="keywordflow">if</span> (p.<a class="code" href="classparam__info.html#ac2fbf0327b2e53c23fde3b285f32e126">is_ptr_shared</a>()) <span class="keywordflow">continue</span>; <span class="comment">// Pointer to local memory: Should we pass the allocated shared memory address to the param memory space? </span>
<a name="l01160"></a>01160       std::string name = p.<a class="code" href="classparam__info.html#a90511ec5d8e814db8d4fbbb2dc30af67">get_name</a>();
<a name="l01161"></a>01161       <span class="keywordtype">int</span> type = p.<a class="code" href="classparam__info.html#a714e378a4317b300f59fcef815712ffd">get_type</a>();
<a name="l01162"></a>01162       <a class="code" href="structparam__t.html">param_t</a> value = p.<a class="code" href="classparam__info.html#a1b04f7a47222077777538920592e9a99">get_value</a>();
<a name="l01163"></a>01163       value.<a class="code" href="structparam__t.html#a5f84c3b1de68bc8a18284467e1ee4d48">type</a> = type;
<a name="l01164"></a>01164       <a class="code" href="classsymbol.html">symbol</a> *param = symtab-&gt;<a class="code" href="classsymbol__table.html#a85bce701e77966eb7c42b938b046d272">lookup</a>(name.c_str());
<a name="l01165"></a>01165       <span class="keywordtype">unsigned</span> xtype = param-&gt;<a class="code" href="classsymbol.html#af8da68543a752fdbd25f4b905f2ab6da">type</a>()-&gt;<a class="code" href="classtype__info.html#acf7d3f7834206cc07553246538e409b9">get_key</a>().<a class="code" href="classtype__info__key.html#a33c88d79d5b6bb80356603bb031f9ceb">scalar_type</a>();
<a name="l01166"></a>01166       assert(xtype==(<span class="keywordtype">unsigned</span>)type);
<a name="l01167"></a>01167 
<a name="l01168"></a>01168       <span class="keywordtype">int</span> tmp;
<a name="l01169"></a>01169       <span class="keywordtype">size_t</span> size;
<a name="l01170"></a>01170       <span class="keywordtype">unsigned</span> offset = p.<a class="code" href="classparam__info.html#ac21d65cfa26f0ae150729438dd077102">get_offset</a>();
<a name="l01171"></a>01171       <a class="code" href="classtype__info__key.html#a92d2640bdd38c080581f06f8d723426d">type_info_key::type_decode</a>(xtype,size,tmp);
<a name="l01172"></a>01172 
<a name="l01173"></a>01173       <span class="comment">// Write to shared memory - offset + 0x10</span>
<a name="l01174"></a>01174       shared_mem-&gt;<a class="code" href="classmemory__space.html#acc4d70cea1a6c55b70c527b6c80d62a5">write</a>(offset+0x10,size/8,value.<a class="code" href="structparam__t.html#ae8efb133c4cd22d297ff43a2dabc7283">pdata</a>,NULL,NULL);
<a name="l01175"></a>01175    }
<a name="l01176"></a>01176 }
<a name="l01177"></a>01177 
<a name="l01178"></a>01178 
<a name="l01179"></a><a class="code" href="classfunction__info.html#a372f3dca9396695f36f46728d6af97c4">01179</a> <span class="keywordtype">void</span> <a class="code" href="classfunction__info.html#a372f3dca9396695f36f46728d6af97c4">function_info::list_param</a>( FILE *fout )<span class="keyword"> const</span>
<a name="l01180"></a>01180 <span class="keyword"></span>{
<a name="l01181"></a>01181    <span class="keywordflow">for</span>( std::map&lt;unsigned,param_info&gt;::const_iterator <a class="code" href="rng-double_8c.html#aa42a9a9cb6e2b93d7f825c395af871bf">i</a>=<a class="code" href="classfunction__info.html#a7dde9640bcdd7c12b3fb59149010620b">m_ptx_kernel_param_info</a>.begin(); <a class="code" href="rng-double_8c.html#aa42a9a9cb6e2b93d7f825c395af871bf">i</a>!=<a class="code" href="classfunction__info.html#a7dde9640bcdd7c12b3fb59149010620b">m_ptx_kernel_param_info</a>.end(); <a class="code" href="rng-double_8c.html#aa42a9a9cb6e2b93d7f825c395af871bf">i</a>++ ) {
<a name="l01182"></a>01182       <span class="keyword">const</span> <a class="code" href="classparam__info.html">param_info</a> &amp;p = <a class="code" href="rng-double_8c.html#aa42a9a9cb6e2b93d7f825c395af871bf">i</a>-&gt;second;
<a name="l01183"></a>01183       std::string name = p.<a class="code" href="classparam__info.html#a90511ec5d8e814db8d4fbbb2dc30af67">get_name</a>();
<a name="l01184"></a>01184       <a class="code" href="classsymbol.html">symbol</a> *param = <a class="code" href="classfunction__info.html#a3f7023b4692eb867e28747b96b37c413">m_symtab</a>-&gt;<a class="code" href="classsymbol__table.html#a85bce701e77966eb7c42b938b046d272">lookup</a>(name.c_str());
<a name="l01185"></a>01185       <a class="code" href="abstract__hardware__model_8h.html#a92b0c0d30c36a95c916f27a55784ca33">addr_t</a> param_addr = param-&gt;<a class="code" href="classsymbol.html#a8fc9a6e49bb901608ff0dab49538db09">get_address</a>();
<a name="l01186"></a>01186       fprintf(fout, <span class="stringliteral">&quot;%s: %#08x\n&quot;</span>, name.c_str(), param_addr);
<a name="l01187"></a>01187    }
<a name="l01188"></a>01188    fflush(fout);
<a name="l01189"></a>01189 }
<a name="l01190"></a>01190 
<a name="l01191"></a>01191 <span class="keyword">template</span>&lt;<span class="keywordtype">int</span> activate_level&gt; 
<a name="l01192"></a><a class="code" href="cuda-sim_8cc.html#a41e275c9009ee991b974479016024bbb">01192</a> <span class="keywordtype">bool</span> <a class="code" href="cuda-sim_8cc.html#a41e275c9009ee991b974479016024bbb">ptx_debug_exec_dump_cond</a>(<span class="keywordtype">int</span> thd_uid, <a class="code" href="abstract__hardware__model_8h.html#a92b0c0d30c36a95c916f27a55784ca33">addr_t</a> pc)
<a name="l01193"></a>01193 {
<a name="l01194"></a>01194    <span class="keywordflow">if</span> (g_debug_execution &gt;= activate_level) {
<a name="l01195"></a>01195       <span class="comment">// check each type of debug dump constraint to filter out dumps</span>
<a name="l01196"></a>01196       <span class="keywordflow">if</span> ( (g_debug_thread_uid != 0) &amp;&amp; (thd_uid != (<span class="keywordtype">unsigned</span>)g_debug_thread_uid) ) {
<a name="l01197"></a>01197          <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01198"></a>01198       }
<a name="l01199"></a>01199       <span class="keywordflow">if</span> ( (<a class="code" href="cuda-sim_8cc.html#a11c024d1b98a33dd76267662e50ea4d7">g_debug_pc</a> != 0xBEEF1518) &amp;&amp; (pc != <a class="code" href="cuda-sim_8cc.html#a11c024d1b98a33dd76267662e50ea4d7">g_debug_pc</a>) ) {
<a name="l01200"></a>01200          <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01201"></a>01201       }
<a name="l01202"></a>01202 
<a name="l01203"></a>01203       <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01204"></a>01204    } 
<a name="l01205"></a>01205    
<a name="l01206"></a>01206    <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01207"></a>01207 }
<a name="l01208"></a>01208 
<a name="l01209"></a><a class="code" href="cuda-sim_8cc.html#a44fe70b821da0583de83069ad9e2ee8f">01209</a> <span class="keywordtype">void</span> <a class="code" href="cuda-sim_8cc.html#a44fe70b821da0583de83069ad9e2ee8f">init_inst_classification_stat</a>() 
<a name="l01210"></a>01210 {
<a name="l01211"></a>01211    <span class="keyword">static</span> std::set&lt;unsigned&gt; <a class="code" href="namespaceTrace.html#acd518aca28ce99e4d9a8a337ea04762c">init</a>;
<a name="l01212"></a>01212    <span class="keywordflow">if</span>( init.find(g_ptx_kernel_count) != init.end() ) 
<a name="l01213"></a>01213       <span class="keywordflow">return</span>;
<a name="l01214"></a>01214    init.insert(g_ptx_kernel_count);
<a name="l01215"></a>01215 
<a name="l01216"></a>01216 <span class="preprocessor">   #define MAX_CLASS_KER 1024</span>
<a name="l01217"></a>01217 <span class="preprocessor"></span>   <span class="keywordtype">char</span> kernelname[MAX_CLASS_KER] =<span class="stringliteral">&quot;&quot;</span>;
<a name="l01218"></a>01218    <span class="keywordflow">if</span> (!<a class="code" href="cuda-sim_8cc.html#a97068d33bba55c50e14efd24c9983787">g_inst_classification_stat</a>) <a class="code" href="cuda-sim_8cc.html#a97068d33bba55c50e14efd24c9983787">g_inst_classification_stat</a> = (<span class="keywordtype">void</span>**)calloc(MAX_CLASS_KER, <span class="keyword">sizeof</span>(<span class="keywordtype">void</span>*));
<a name="l01219"></a>01219    snprintf(kernelname, MAX_CLASS_KER, <span class="stringliteral">&quot;Kernel %d Classification\n&quot;</span>,g_ptx_kernel_count  );         
<a name="l01220"></a>01220    assert( g_ptx_kernel_count &lt; MAX_CLASS_KER ) ; <span class="comment">// a static limit on number of kernels increase it if it fails! </span>
<a name="l01221"></a>01221    <a class="code" href="cuda-sim_8cc.html#a97068d33bba55c50e14efd24c9983787">g_inst_classification_stat</a>[g_ptx_kernel_count] = <a class="code" href="statwrapper_8cc.html#a115c8e995d9b6b135865e09cd9e2975c">StatCreate</a>(kernelname,1,20);
<a name="l01222"></a>01222    <span class="keywordflow">if</span> (!<a class="code" href="cuda-sim_8cc.html#a44255eb97b0682c1154a13e0d3fc2bf5">g_inst_op_classification_stat</a>) <a class="code" href="cuda-sim_8cc.html#a44255eb97b0682c1154a13e0d3fc2bf5">g_inst_op_classification_stat</a> = (<span class="keywordtype">void</span>**)calloc(MAX_CLASS_KER, <span class="keyword">sizeof</span>(<span class="keywordtype">void</span>*));
<a name="l01223"></a>01223    snprintf(kernelname, MAX_CLASS_KER, <span class="stringliteral">&quot;Kernel %d OP Classification\n&quot;</span>,g_ptx_kernel_count  );         
<a name="l01224"></a>01224    <a class="code" href="cuda-sim_8cc.html#a44255eb97b0682c1154a13e0d3fc2bf5">g_inst_op_classification_stat</a>[g_ptx_kernel_count] = <a class="code" href="statwrapper_8cc.html#a115c8e995d9b6b135865e09cd9e2975c">StatCreate</a>(kernelname,1,100);
<a name="l01225"></a>01225 }
<a name="l01226"></a>01226 
<a name="l01227"></a><a class="code" href="cuda-sim_8cc.html#a0193a38f38ffb96c962877b6d6eded68">01227</a> <span class="keyword">static</span> <span class="keywordtype">unsigned</span> <a class="code" href="cuda-sim_8cc.html#a0193a38f38ffb96c962877b6d6eded68">get_tex_datasize</a>( <span class="keyword">const</span> <a class="code" href="classptx__instruction.html">ptx_instruction</a> *pI, <a class="code" href="classptx__thread__info.html">ptx_thread_info</a> *thread )
<a name="l01228"></a>01228 {
<a name="l01229"></a>01229    <span class="keyword">const</span> <a class="code" href="classoperand__info.html">operand_info</a> &amp;src1 = pI-&gt;<a class="code" href="classptx__instruction.html#a9f4f1af4e2dbebd08549c518a1749ab0">src1</a>(); <span class="comment">//the name of the texture</span>
<a name="l01230"></a>01230    std::string texname = src1.<a class="code" href="classoperand__info.html#ae508fadcabd47ef0a361b1120a6e160d">name</a>();
<a name="l01231"></a>01231 
<a name="l01232"></a>01232    <a class="code" href="classgpgpu__t.html">gpgpu_t</a> *gpu = thread-&gt;<a class="code" href="classptx__thread__info.html#a6682377bc58576547b58b9e529721509">get_gpu</a>();
<a name="l01233"></a>01233    <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structtextureReference.html">textureReference</a>* texref = gpu-&gt;<a class="code" href="classgpgpu__t.html#a73920547c697d229269ef178baa4744d">get_texref</a>(texname);
<a name="l01234"></a>01234    <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structtextureInfo.html">textureInfo</a>* texInfo = gpu-&gt;<a class="code" href="classgpgpu__t.html#a6297c45dc05c73905d76b4b2cdd0f0a4">get_texinfo</a>(texref);
<a name="l01235"></a>01235 
<a name="l01236"></a>01236    <span class="keywordtype">unsigned</span> data_size = texInfo-&gt;<a class="code" href="structtextureInfo.html#a4b70a38adb71dec17257c00c5d03f01d">texel_size</a>;
<a name="l01237"></a>01237    <span class="keywordflow">return</span> data_size; 
<a name="l01238"></a>01238 }
<a name="l01239"></a>01239 
<a name="l01240"></a><a class="code" href="classptx__thread__info.html#a38833826865f73f987413f0df1d8b99e">01240</a> <span class="keywordtype">void</span> <a class="code" href="classptx__thread__info.html#a38833826865f73f987413f0df1d8b99e">ptx_thread_info::ptx_exec_inst</a>( <a class="code" href="classwarp__inst__t.html">warp_inst_t</a> &amp;inst, <span class="keywordtype">unsigned</span> lane_id)
<a name="l01241"></a>01241 {
<a name="l01242"></a>01242     
<a name="l01243"></a>01243    <span class="keywordtype">bool</span> skip = <span class="keyword">false</span>;
<a name="l01244"></a>01244    <span class="keywordtype">int</span> op_classification = 0;
<a name="l01245"></a>01245    <a class="code" href="abstract__hardware__model_8h.html#a92b0c0d30c36a95c916f27a55784ca33">addr_t</a> pc = <a class="code" href="classptx__thread__info.html#ae2f3a66001438938edd3e79b68156751">next_instr</a>();
<a name="l01246"></a>01246    assert( pc == inst.<a class="code" href="classinst__t.html#a76aea27709c3a0256c2615451c7daa56">pc</a> ); <span class="comment">// make sure timing model and functional model are in sync</span>
<a name="l01247"></a>01247    <span class="keyword">const</span> <a class="code" href="classptx__instruction.html">ptx_instruction</a> *pI = <a class="code" href="classptx__thread__info.html#a825e787febf2b5ba59a76da36798bfd8">m_func_info</a>-&gt;<a class="code" href="classfunction__info.html#af3767e2405365a97df8ad7f3e3e2e090">get_instruction</a>(pc);
<a name="l01248"></a>01248    <a class="code" href="classptx__thread__info.html#a4230765ef71b488274911361c34bcef0">set_npc</a>( pc + pI-&gt;<a class="code" href="classptx__instruction.html#ae48319891d1b705a1c1a0d20ed0ae88a">inst_size</a>() );
<a name="l01249"></a>01249    
<a name="l01250"></a>01250 
<a name="l01251"></a>01251    <span class="keywordflow">try</span> {
<a name="l01252"></a>01252 
<a name="l01253"></a>01253    <a class="code" href="classptx__thread__info.html#acbda9a7abf2e45ada9b2b0455a987aa8">clearRPC</a>();
<a name="l01254"></a>01254    <a class="code" href="classptx__thread__info.html#a3f76361e51600f480b537d20300f534d">m_last_set_operand_value</a>.<a class="code" href="unionptx__reg__t.html#a1e1ac1da13de4bf7a6eefef4982df7ce">u64</a> = 0;
<a name="l01255"></a>01255 
<a name="l01256"></a>01256    <span class="keywordflow">if</span>(<a class="code" href="classptx__thread__info.html#a20da83a32985f0a21e1140bf6c7f2f40">is_done</a>())
<a name="l01257"></a>01257    {
<a name="l01258"></a>01258       printf(<span class="stringliteral">&quot;attempted to execute instruction on a thread that is already done.\n&quot;</span>);
<a name="l01259"></a>01259       assert(0);
<a name="l01260"></a>01260    }
<a name="l01261"></a>01261    
<a name="l01262"></a>01262    <span class="keywordflow">if</span> ( g_debug_execution &gt;= 6 || <a class="code" href="classptx__thread__info.html#a96d168f6a95876cbb2a728c15769f9e0">m_gpu</a>-&gt;<a class="code" href="classgpgpu__t.html#ac333cdffb2f67255b45312f3f48bd0d0">get_config</a>().<a class="code" href="classgpgpu__functional__sim__config.html#a6fc79e26daaf405b77f684ff6aad1a4b">get_ptx_inst_debug_to_file</a>()) {
<a name="l01263"></a>01263       <span class="keywordflow">if</span> ( (g_debug_thread_uid==0) || (<a class="code" href="classptx__thread__info.html#a31196e491ff21efed0ed334a0b927130">get_uid</a>() == (unsigned)g_debug_thread_uid) ) {
<a name="l01264"></a>01264         
<a name="l01265"></a>01265           <a class="code" href="classptx__thread__info.html#a94f27f73b13f07e6d702d8a8451b0ad1">clear_modifiedregs</a>();
<a name="l01266"></a>01266          <a class="code" href="classptx__thread__info.html#a6afe06c2a642784fa84a3f4d54356aa4">enable_debug_trace</a>();
<a name="l01267"></a>01267       }
<a name="l01268"></a>01268    }
<a name="l01269"></a>01269    
<a name="l01270"></a>01270    
<a name="l01271"></a>01271    <span class="keywordflow">if</span>( pI-&gt;<a class="code" href="classptx__instruction.html#a4a59a40f681e221e013ff726428c4b1a">has_pred</a>() ) {
<a name="l01272"></a>01272       <span class="keyword">const</span> <a class="code" href="classoperand__info.html">operand_info</a> &amp;pred = pI-&gt;<a class="code" href="classptx__instruction.html#a87fa0a3daeda27af453c167a060a22d4">get_pred</a>();
<a name="l01273"></a>01273       <a class="code" href="unionptx__reg__t.html">ptx_reg_t</a> pred_value = <a class="code" href="classptx__thread__info.html#a47ef4d5d837085d62079c8da39212c2c">get_operand_value</a>(pred, pred, PRED_TYPE, <span class="keyword">this</span>, 0);
<a name="l01274"></a>01274       <span class="keywordflow">if</span>(pI-&gt;<a class="code" href="classptx__instruction.html#abb8277f8ba0fe194524d853521b01a7e">get_pred_mod</a>() == -1) {
<a name="l01275"></a>01275             skip = (pred_value.<a class="code" href="unionptx__reg__t.html#afdb1e82430060531691f1fec6855ca28">pred</a> &amp; 0x0001) ^ pI-&gt;<a class="code" href="classptx__instruction.html#aebb83cffa01b38ef7537377b0d3c452f">get_pred_neg</a>(); <span class="comment">//ptxplus inverts the zero flag</span>
<a name="l01276"></a>01276       } <span class="keywordflow">else</span> {
<a name="l01277"></a>01277             skip = !<a class="code" href="decuda__pred__table_8cc.html#ae61cffec91ad22e45e0c0e5eeb11c41b">pred_lookup</a>(pI-&gt;<a class="code" href="classptx__instruction.html#abb8277f8ba0fe194524d853521b01a7e">get_pred_mod</a>(), pred_value.<a class="code" href="unionptx__reg__t.html#afdb1e82430060531691f1fec6855ca28">pred</a> &amp; 0x000F);
<a name="l01278"></a>01278       }
<a name="l01279"></a>01279    }
<a name="l01280"></a>01280    
<a name="l01281"></a>01281    <span class="keywordflow">if</span>( skip ) {
<a name="l01282"></a>01282       inst.<a class="code" href="classwarp__inst__t.html#abdbf9fe9d73f6b41867da7eb15f5435e">set_not_active</a>(lane_id);
<a name="l01283"></a>01283    } <span class="keywordflow">else</span> {
<a name="l01284"></a>01284       <span class="keyword">const</span> <a class="code" href="classptx__instruction.html">ptx_instruction</a> *pI_saved = pI;
<a name="l01285"></a>01285       <a class="code" href="classptx__instruction.html">ptx_instruction</a> *pJ = NULL;
<a name="l01286"></a>01286       <span class="keywordflow">if</span>( pI-&gt;<a class="code" href="classptx__instruction.html#a7e1df5ccd2482be6275b3267b6af2d85">get_opcode</a>() == VOTE_OP ) {
<a name="l01287"></a>01287          pJ = <span class="keyword">new</span> <a class="code" href="classptx__instruction.html">ptx_instruction</a>(*pI);
<a name="l01288"></a>01288          *((<a class="code" href="classwarp__inst__t.html">warp_inst_t</a>*)pJ) = inst; <span class="comment">// copy active mask information</span>
<a name="l01289"></a>01289          pI = pJ;
<a name="l01290"></a>01290       }
<a name="l01291"></a>01291       <span class="keywordflow">switch</span> ( pI-&gt;<a class="code" href="classptx__instruction.html#a7e1df5ccd2482be6275b3267b6af2d85">get_opcode</a>() ) {
<a name="l01292"></a>01292 <span class="preprocessor">#define OP_DEF(OP,FUNC,STR,DST,CLASSIFICATION) case OP: FUNC(pI,this); op_classification = CLASSIFICATION; break;</span>
<a name="l01293"></a>01293 <span class="preprocessor"></span><span class="preprocessor">#define OP_W_DEF(OP,FUNC,STR,DST,CLASSIFICATION) case OP: FUNC(pI,get_core(),inst); op_classification = CLASSIFICATION; break;</span>
<a name="l01294"></a>01294 <span class="preprocessor"></span><span class="preprocessor">#include &quot;opcodes.def&quot;</span>
<a name="l01295"></a>01295 <span class="preprocessor">#undef OP_DEF</span>
<a name="l01296"></a>01296 <span class="preprocessor"></span><span class="preprocessor">#undef OP_W_DEF</span>
<a name="l01297"></a>01297 <span class="preprocessor"></span>      <span class="keywordflow">default</span>: printf( <span class="stringliteral">&quot;Execution error: Invalid opcode (0x%x)\n&quot;</span>, pI-&gt;<a class="code" href="classptx__instruction.html#a7e1df5ccd2482be6275b3267b6af2d85">get_opcode</a>() ); <span class="keywordflow">break</span>;
<a name="l01298"></a>01298       }
<a name="l01299"></a>01299       <span class="keyword">delete</span> pJ;
<a name="l01300"></a>01300       pI = pI_saved;
<a name="l01301"></a>01301       
<a name="l01302"></a>01302       <span class="comment">// Run exit instruction if exit option included</span>
<a name="l01303"></a>01303       <span class="keywordflow">if</span>(pI-&gt;<a class="code" href="classptx__instruction.html#aff34ff621a7ae0cea598fea22278f612">is_exit</a>())
<a name="l01304"></a>01304          <a class="code" href="instructions_8cc.html#aa9cde06b41dd716e332d0e0caea12988">exit_impl</a>(pI,<span class="keyword">this</span>);
<a name="l01305"></a>01305    }
<a name="l01306"></a>01306    
<a name="l01307"></a>01307 
<a name="l01308"></a>01308 
<a name="l01309"></a>01309    <span class="keyword">const</span> <a class="code" href="classgpgpu__functional__sim__config.html">gpgpu_functional_sim_config</a> &amp;config = <a class="code" href="classptx__thread__info.html#a96d168f6a95876cbb2a728c15769f9e0">m_gpu</a>-&gt;<a class="code" href="classgpgpu__t.html#ac333cdffb2f67255b45312f3f48bd0d0">get_config</a>();
<a name="l01310"></a>01310    
<a name="l01311"></a>01311    <span class="comment">// Output instruction information to file and stdout</span>
<a name="l01312"></a>01312    <span class="keywordflow">if</span>( config.<a class="code" href="classgpgpu__functional__sim__config.html#a6fc79e26daaf405b77f684ff6aad1a4b">get_ptx_inst_debug_to_file</a>() != 0 &amp;&amp; 
<a name="l01313"></a>01313         (config.<a class="code" href="classgpgpu__functional__sim__config.html#a5cc8bac696fb899e2097de29e7536edf">get_ptx_inst_debug_thread_uid</a>() == 0 || config.<a class="code" href="classgpgpu__functional__sim__config.html#a5cc8bac696fb899e2097de29e7536edf">get_ptx_inst_debug_thread_uid</a>() == <a class="code" href="classptx__thread__info.html#a31196e491ff21efed0ed334a0b927130">get_uid</a>()) ) {
<a name="l01314"></a>01314       fprintf(<a class="code" href="classptx__thread__info.html#a96d168f6a95876cbb2a728c15769f9e0">m_gpu</a>-&gt;<a class="code" href="classgpgpu__t.html#a74f97b4ee5d1b7cffa80405318f0268d">get_ptx_inst_debug_file</a>(),
<a name="l01315"></a>01315              <span class="stringliteral">&quot;[thd=%u] : (%s:%u - %s)\n&quot;</span>,
<a name="l01316"></a>01316              <a class="code" href="classptx__thread__info.html#a31196e491ff21efed0ed334a0b927130">get_uid</a>(),
<a name="l01317"></a>01317              pI-&gt;<a class="code" href="classptx__instruction.html#a6c318383901e62008f98e8f370f7e202">source_file</a>(), pI-&gt;<a class="code" href="classptx__instruction.html#aa7417e4758e1dfc4fb5a92030071a040">source_line</a>(), pI-&gt;<a class="code" href="classptx__instruction.html#a48a21a457c9452363281b65a64f99282">get_source</a>() );
<a name="l01318"></a>01318       <span class="comment">//fprintf(ptx_inst_debug_file, &quot;has memory read=%d, has memory write=%d\n&quot;, pI-&gt;has_memory_read(), pI-&gt;has_memory_write());</span>
<a name="l01319"></a>01319       fflush(<a class="code" href="classptx__thread__info.html#a96d168f6a95876cbb2a728c15769f9e0">m_gpu</a>-&gt;<a class="code" href="classgpgpu__t.html#a74f97b4ee5d1b7cffa80405318f0268d">get_ptx_inst_debug_file</a>());
<a name="l01320"></a>01320    }
<a name="l01321"></a>01321 
<a name="l01322"></a>01322    <span class="keywordflow">if</span> ( ptx_debug_exec_dump_cond&lt;5&gt;(<a class="code" href="classptx__thread__info.html#a31196e491ff21efed0ed334a0b927130">get_uid</a>(), pc) ) {
<a name="l01323"></a>01323       <a class="code" href="structdim3.html">dim3</a> ctaid = <a class="code" href="classptx__thread__info.html#acdd4997ba9da7550a1f9bd0a4b0f3ee8">get_ctaid</a>();
<a name="l01324"></a>01324       <a class="code" href="structdim3.html">dim3</a> tid = <a class="code" href="classptx__thread__info.html#a27490e1189fbc0cd1046b1088536d2a7">get_tid</a>();
<a name="l01325"></a>01325       printf(<span class="stringliteral">&quot;%u [thd=%u][i=%u] : ctaid=(%u,%u,%u) tid=(%u,%u,%u) icount=%u [pc=%u] (%s:%u - %s)  [0x%llx]\n&quot;</span>, 
<a name="l01326"></a>01326              <a class="code" href="cuda-sim_8cc.html#a0cb22097f81b6f855ab91169a88ac624">g_ptx_sim_num_insn</a>, 
<a name="l01327"></a>01327              <a class="code" href="classptx__thread__info.html#a31196e491ff21efed0ed334a0b927130">get_uid</a>(),
<a name="l01328"></a>01328              pI-&gt;<a class="code" href="classptx__instruction.html#a0af103db1943bc9e849669cbc3f2590b">uid</a>(), ctaid.<a class="code" href="structdim3.html#ac94584074d5c15f67c66656859bb24e9">x</a>,ctaid.<a class="code" href="structdim3.html#ae87d6f5fc0cc038be953f78f36ba873f">y</a>,ctaid.<a class="code" href="structdim3.html#a4856dbf9372e82eb478bf14ec1d2e294">z</a>,tid.<a class="code" href="structdim3.html#ac94584074d5c15f67c66656859bb24e9">x</a>,tid.<a class="code" href="structdim3.html#ae87d6f5fc0cc038be953f78f36ba873f">y</a>,tid.<a class="code" href="structdim3.html#a4856dbf9372e82eb478bf14ec1d2e294">z</a>,
<a name="l01329"></a>01329              <a class="code" href="classptx__thread__info.html#a1712bb52b65b0562b961a71824a7bffe">get_icount</a>(),
<a name="l01330"></a>01330              pc, pI-&gt;<a class="code" href="classptx__instruction.html#a6c318383901e62008f98e8f370f7e202">source_file</a>(), pI-&gt;<a class="code" href="classptx__instruction.html#aa7417e4758e1dfc4fb5a92030071a040">source_line</a>(), pI-&gt;<a class="code" href="classptx__instruction.html#a48a21a457c9452363281b65a64f99282">get_source</a>(),
<a name="l01331"></a>01331              <a class="code" href="classptx__thread__info.html#a3f76361e51600f480b537d20300f534d">m_last_set_operand_value</a>.<a class="code" href="unionptx__reg__t.html#a1e1ac1da13de4bf7a6eefef4982df7ce">u64</a> );
<a name="l01332"></a>01332       fflush(stdout);
<a name="l01333"></a>01333    }
<a name="l01334"></a>01334    
<a name="l01335"></a>01335    <a class="code" href="abstract__hardware__model_8h.html#a92b0c0d30c36a95c916f27a55784ca33">addr_t</a> insn_memaddr = 0xFEEBDAED;
<a name="l01336"></a>01336    <a class="code" href="classmemory__space__t.html">memory_space_t</a> insn_space = <a class="code" href="abstract__hardware__model_8h.html#a1ad2169aaa8924fcc552447f38a5b58ca434a5fd1a70c9dcbe2de96e9c602d265">undefined_space</a>;
<a name="l01337"></a>01337    <a class="code" href="abstract__hardware__model_8h.html#a1df0b5882f0bc92aabef2d5a968c549b">_memory_op_t</a> insn_memory_op = <a class="code" href="abstract__hardware__model_8h.html#a1df0b5882f0bc92aabef2d5a968c549baf20ad52c3a748cbcc87edfc33f1a1a53">no_memory_op</a>;
<a name="l01338"></a>01338    <span class="keywordtype">unsigned</span> insn_data_size = 0;
<a name="l01339"></a>01339    <span class="keywordflow">if</span> ( (pI-&gt;<a class="code" href="classptx__instruction.html#ad5bc475bdc4ad3d041e74ac326e5a8c0">has_memory_read</a>()  || pI-&gt;<a class="code" href="classptx__instruction.html#a438e0d906c02aee4c752fbc75b7cd01a">has_memory_write</a>()) ) {
<a name="l01340"></a>01340       insn_memaddr = <a class="code" href="classptx__thread__info.html#abd40ba37f93948abfd268a4a033177f0">last_eaddr</a>();
<a name="l01341"></a>01341       insn_space = <a class="code" href="classptx__thread__info.html#a5d618bd5e03ad3a95141345e8f4cc1a8">last_space</a>();
<a name="l01342"></a>01342       <span class="keywordtype">unsigned</span> to_type = pI-&gt;<a class="code" href="classptx__instruction.html#a7266fb6774c9f05108fe9f128c56d7ab">get_type</a>();
<a name="l01343"></a>01343       insn_data_size = <a class="code" href="cuda-sim_8cc.html#a5fc048370aa5c227bf95630b9afe171f">datatype2size</a>(to_type);
<a name="l01344"></a>01344       insn_memory_op = pI-&gt;<a class="code" href="classptx__instruction.html#ad5bc475bdc4ad3d041e74ac326e5a8c0">has_memory_read</a>() ? <a class="code" href="abstract__hardware__model_8h.html#a1df0b5882f0bc92aabef2d5a968c549ba75c129e3900f1380d61f86c21cdcb1b9">memory_load</a> : <a class="code" href="abstract__hardware__model_8h.html#a1df0b5882f0bc92aabef2d5a968c549bad1c612197bbcb92d93fc4cf46418d50e">memory_store</a>;
<a name="l01345"></a>01345    }
<a name="l01346"></a>01346 
<a name="l01347"></a>01347    <span class="keywordflow">if</span> ( pI-&gt;<a class="code" href="classptx__instruction.html#a7e1df5ccd2482be6275b3267b6af2d85">get_opcode</a>() == BAR_OP &amp;&amp; pI-&gt;<a class="code" href="classptx__instruction.html#aad47999e0481d8951ae6265c8178ae33">barrier_op</a>() == RED_OPTION) {
<a name="l01348"></a>01348        inst.<a class="code" href="classwarp__inst__t.html#af45932f7f07d0972f6cfb01efc556d50">add_callback</a>( lane_id, <a class="code" href="classptx__thread__info.html#a4a1443a27392254d01229684e03b7b0f">last_callback</a>().function, <a class="code" href="classptx__thread__info.html#a4a1443a27392254d01229684e03b7b0f">last_callback</a>().instruction, <span class="keyword">this</span>,<span class="keyword">false</span> <span class="comment">/*not atomic*/</span>);
<a name="l01349"></a>01349    }
<a name="l01350"></a>01350 
<a name="l01351"></a>01351    <span class="keywordflow">if</span> ( pI-&gt;<a class="code" href="classptx__instruction.html#a7e1df5ccd2482be6275b3267b6af2d85">get_opcode</a>() == ATOM_OP ) {
<a name="l01352"></a>01352       insn_memaddr = <a class="code" href="classptx__thread__info.html#abd40ba37f93948abfd268a4a033177f0">last_eaddr</a>();
<a name="l01353"></a>01353       insn_space = <a class="code" href="classptx__thread__info.html#a5d618bd5e03ad3a95141345e8f4cc1a8">last_space</a>();
<a name="l01354"></a>01354       inst.<a class="code" href="classwarp__inst__t.html#af45932f7f07d0972f6cfb01efc556d50">add_callback</a>( lane_id, <a class="code" href="classptx__thread__info.html#a4a1443a27392254d01229684e03b7b0f">last_callback</a>().function, <a class="code" href="classptx__thread__info.html#a4a1443a27392254d01229684e03b7b0f">last_callback</a>().instruction, <span class="keyword">this</span>,<span class="keyword">true</span> <span class="comment">/*atomic*/</span>);
<a name="l01355"></a>01355       <span class="keywordtype">unsigned</span> to_type = pI-&gt;<a class="code" href="classptx__instruction.html#a7266fb6774c9f05108fe9f128c56d7ab">get_type</a>();
<a name="l01356"></a>01356       insn_data_size = <a class="code" href="cuda-sim_8cc.html#a5fc048370aa5c227bf95630b9afe171f">datatype2size</a>(to_type);
<a name="l01357"></a>01357    }
<a name="l01358"></a>01358 
<a name="l01359"></a>01359    <span class="keywordflow">if</span> (pI-&gt;<a class="code" href="classptx__instruction.html#a7e1df5ccd2482be6275b3267b6af2d85">get_opcode</a>() == TEX_OP) {
<a name="l01360"></a>01360       inst.<a class="code" href="classwarp__inst__t.html#afd733ed202cb8ea4a2fdfea5d1ed9e4d">set_addr</a>(lane_id, <a class="code" href="classptx__thread__info.html#abd40ba37f93948abfd268a4a033177f0">last_eaddr</a>() );
<a name="l01361"></a>01361       assert( inst.<a class="code" href="classinst__t.html#a7830eb1cfe5a305e426d8530563c11da">space</a> == <a class="code" href="classptx__thread__info.html#a5d618bd5e03ad3a95141345e8f4cc1a8">last_space</a>() );
<a name="l01362"></a>01362       insn_data_size = <a class="code" href="cuda-sim_8cc.html#a0193a38f38ffb96c962877b6d6eded68">get_tex_datasize</a>(pI, <span class="keyword">this</span>); <span class="comment">// texture obtain its data granularity from the texture info </span>
<a name="l01363"></a>01363    }
<a name="l01364"></a>01364 
<a name="l01365"></a>01365    <span class="comment">// Output register information to file and stdout</span>
<a name="l01366"></a>01366    <span class="keywordflow">if</span>( config.<a class="code" href="classgpgpu__functional__sim__config.html#a6fc79e26daaf405b77f684ff6aad1a4b">get_ptx_inst_debug_to_file</a>()!=0 &amp;&amp; 
<a name="l01367"></a>01367        (config.<a class="code" href="classgpgpu__functional__sim__config.html#a5cc8bac696fb899e2097de29e7536edf">get_ptx_inst_debug_thread_uid</a>()==0||config.<a class="code" href="classgpgpu__functional__sim__config.html#a5cc8bac696fb899e2097de29e7536edf">get_ptx_inst_debug_thread_uid</a>()==<a class="code" href="classptx__thread__info.html#a31196e491ff21efed0ed334a0b927130">get_uid</a>()) ) {
<a name="l01368"></a>01368       <a class="code" href="classptx__thread__info.html#a0b77664e01ece5174909314de1dfc76a">dump_modifiedregs</a>(<a class="code" href="classptx__thread__info.html#a96d168f6a95876cbb2a728c15769f9e0">m_gpu</a>-&gt;<a class="code" href="classgpgpu__t.html#a74f97b4ee5d1b7cffa80405318f0268d">get_ptx_inst_debug_file</a>());
<a name="l01369"></a>01369       <a class="code" href="classptx__thread__info.html#a3f1c15ce92cf55ade9f733dcfc32714c">dump_regs</a>(<a class="code" href="classptx__thread__info.html#a96d168f6a95876cbb2a728c15769f9e0">m_gpu</a>-&gt;<a class="code" href="classgpgpu__t.html#a74f97b4ee5d1b7cffa80405318f0268d">get_ptx_inst_debug_file</a>());
<a name="l01370"></a>01370    }
<a name="l01371"></a>01371 
<a name="l01372"></a>01372    <span class="keywordflow">if</span> ( g_debug_execution &gt;= 6 ) {
<a name="l01373"></a>01373       <span class="keywordflow">if</span> ( ptx_debug_exec_dump_cond&lt;6&gt;(<a class="code" href="classptx__thread__info.html#a31196e491ff21efed0ed334a0b927130">get_uid</a>(), pc) )
<a name="l01374"></a>01374          <a class="code" href="classptx__thread__info.html#a0b77664e01ece5174909314de1dfc76a">dump_modifiedregs</a>(stdout);
<a name="l01375"></a>01375    }
<a name="l01376"></a>01376    <span class="keywordflow">if</span> ( g_debug_execution &gt;= 10 ) {
<a name="l01377"></a>01377       <span class="keywordflow">if</span> ( ptx_debug_exec_dump_cond&lt;10&gt;(<a class="code" href="classptx__thread__info.html#a31196e491ff21efed0ed334a0b927130">get_uid</a>(), pc) )
<a name="l01378"></a>01378          <a class="code" href="classptx__thread__info.html#a3f1c15ce92cf55ade9f733dcfc32714c">dump_regs</a>(stdout);
<a name="l01379"></a>01379    }
<a name="l01380"></a>01380    <a class="code" href="classptx__thread__info.html#a0165ddbc777641b58afe732680768a26">update_pc</a>();
<a name="l01381"></a>01381    <a class="code" href="cuda-sim_8cc.html#a0cb22097f81b6f855ab91169a88ac624">g_ptx_sim_num_insn</a>++;
<a name="l01382"></a>01382    
<a name="l01383"></a>01383    <span class="comment">//not using it with functional simulation mode</span>
<a name="l01384"></a>01384    <span class="keywordflow">if</span>(!(this-&gt;<a class="code" href="classptx__thread__info.html#a21f26dc3f7578837efb49207c94d4a99">m_functionalSimulationMode</a>))
<a name="l01385"></a>01385        <a class="code" href="ptx-stats_8cc.html#a417abe13ef11c55cdaa8b2b68357f341">ptx_file_line_stats_add_exec_count</a>(pI);
<a name="l01386"></a>01386    
<a name="l01387"></a>01387    <span class="keywordflow">if</span> ( gpgpu_ptx_instruction_classification ) {
<a name="l01388"></a>01388       <a class="code" href="cuda-sim_8cc.html#a44fe70b821da0583de83069ad9e2ee8f">init_inst_classification_stat</a>();
<a name="l01389"></a>01389       <span class="keywordtype">unsigned</span> space_type=0;
<a name="l01390"></a>01390       <span class="keywordflow">switch</span> ( pI-&gt;<a class="code" href="classptx__instruction.html#a93c8cf0ec080e4e0b0672e9e2ff8328e">get_space</a>().<a class="code" href="classmemory__space__t.html#a9aa8b2fabc2c16d1bfda090f27ab479c">get_type</a>() ) {
<a name="l01391"></a>01391       <span class="keywordflow">case</span> <a class="code" href="abstract__hardware__model_8h.html#a1ad2169aaa8924fcc552447f38a5b58cade54d01d283e68c3e9c5b8d75b85e49e">global_space</a>: space_type = 10; <span class="keywordflow">break</span>;
<a name="l01392"></a>01392       <span class="keywordflow">case</span> <a class="code" href="abstract__hardware__model_8h.html#a1ad2169aaa8924fcc552447f38a5b58ca133ba819812b7d97221aed15cb830967">local_space</a>:  space_type = 11; <span class="keywordflow">break</span>; 
<a name="l01393"></a>01393       <span class="keywordflow">case</span> <a class="code" href="abstract__hardware__model_8h.html#a1ad2169aaa8924fcc552447f38a5b58cadc0c390c9425eb280596cbf66b5d4d4f">tex_space</a>:    space_type = 12; <span class="keywordflow">break</span>; 
<a name="l01394"></a>01394       <span class="keywordflow">case</span> <a class="code" href="abstract__hardware__model_8h.html#a1ad2169aaa8924fcc552447f38a5b58ca44dbb1b8dbb05c3dc58275d544c2611d">surf_space</a>:   space_type = 13; <span class="keywordflow">break</span>; 
<a name="l01395"></a>01395       <span class="keywordflow">case</span> <a class="code" href="abstract__hardware__model_8h.html#a1ad2169aaa8924fcc552447f38a5b58ca5448bfae061180e01eb15ce5fec7bdcc">param_space_kernel</a>:
<a name="l01396"></a>01396       <span class="keywordflow">case</span> <a class="code" href="abstract__hardware__model_8h.html#a1ad2169aaa8924fcc552447f38a5b58ca2f594286872ffab4d06ed69f65f111ac">param_space_local</a>:
<a name="l01397"></a>01397                          space_type = 14; <span class="keywordflow">break</span>; 
<a name="l01398"></a>01398       <span class="keywordflow">case</span> <a class="code" href="abstract__hardware__model_8h.html#a1ad2169aaa8924fcc552447f38a5b58cae27eca92c2d1dbb9adb9010e3fb7991c">shared_space</a>: space_type = 15; <span class="keywordflow">break</span>; 
<a name="l01399"></a>01399       <span class="keywordflow">case</span> <a class="code" href="abstract__hardware__model_8h.html#a1ad2169aaa8924fcc552447f38a5b58ca445236c52ac314c07392ad430f155071">const_space</a>:  space_type = 16; <span class="keywordflow">break</span>;
<a name="l01400"></a>01400       <span class="keywordflow">default</span>: 
<a name="l01401"></a>01401          space_type = 0 ;
<a name="l01402"></a>01402          <span class="keywordflow">break</span>;
<a name="l01403"></a>01403       }
<a name="l01404"></a>01404       <a class="code" href="statwrapper_8cc.html#a9a15cae821158087f002fa31e1e78a51">StatAddSample</a>( <a class="code" href="cuda-sim_8cc.html#a97068d33bba55c50e14efd24c9983787">g_inst_classification_stat</a>[g_ptx_kernel_count],  op_classification);
<a name="l01405"></a>01405       <span class="keywordflow">if</span> (space_type) <a class="code" href="statwrapper_8cc.html#a9a15cae821158087f002fa31e1e78a51">StatAddSample</a>( <a class="code" href="cuda-sim_8cc.html#a97068d33bba55c50e14efd24c9983787">g_inst_classification_stat</a>[g_ptx_kernel_count], ( <span class="keywordtype">int</span> )space_type);
<a name="l01406"></a>01406       <a class="code" href="statwrapper_8cc.html#a9a15cae821158087f002fa31e1e78a51">StatAddSample</a>( <a class="code" href="cuda-sim_8cc.html#a44255eb97b0682c1154a13e0d3fc2bf5">g_inst_op_classification_stat</a>[g_ptx_kernel_count], (<span class="keywordtype">int</span>)  pI-&gt;<a class="code" href="classptx__instruction.html#a7e1df5ccd2482be6275b3267b6af2d85">get_opcode</a>() );
<a name="l01407"></a>01407    }
<a name="l01408"></a>01408    <span class="keywordflow">if</span> ( (<a class="code" href="cuda-sim_8cc.html#a0cb22097f81b6f855ab91169a88ac624">g_ptx_sim_num_insn</a> % 100000) == 0 ) {
<a name="l01409"></a>01409       <a class="code" href="structdim3.html">dim3</a> ctaid = <a class="code" href="classptx__thread__info.html#acdd4997ba9da7550a1f9bd0a4b0f3ee8">get_ctaid</a>();
<a name="l01410"></a>01410       <a class="code" href="structdim3.html">dim3</a> tid = <a class="code" href="classptx__thread__info.html#a27490e1189fbc0cd1046b1088536d2a7">get_tid</a>();
<a name="l01411"></a>01411       printf(<span class="stringliteral">&quot;GPGPU-Sim PTX: %u instructions simulated : ctaid=(%u,%u,%u) tid=(%u,%u,%u)\n&quot;</span>,
<a name="l01412"></a>01412              <a class="code" href="cuda-sim_8cc.html#a0cb22097f81b6f855ab91169a88ac624">g_ptx_sim_num_insn</a>, ctaid.<a class="code" href="structdim3.html#ac94584074d5c15f67c66656859bb24e9">x</a>,ctaid.<a class="code" href="structdim3.html#ae87d6f5fc0cc038be953f78f36ba873f">y</a>,ctaid.<a class="code" href="structdim3.html#a4856dbf9372e82eb478bf14ec1d2e294">z</a>,tid.<a class="code" href="structdim3.html#ac94584074d5c15f67c66656859bb24e9">x</a>,tid.<a class="code" href="structdim3.html#ae87d6f5fc0cc038be953f78f36ba873f">y</a>,tid.<a class="code" href="structdim3.html#a4856dbf9372e82eb478bf14ec1d2e294">z</a> );
<a name="l01413"></a>01413       fflush(stdout);
<a name="l01414"></a>01414    }
<a name="l01415"></a>01415    
<a name="l01416"></a>01416    <span class="comment">// &quot;Return values&quot;</span>
<a name="l01417"></a>01417    <span class="keywordflow">if</span>(!skip) {
<a name="l01418"></a>01418       inst.<a class="code" href="classinst__t.html#a7830eb1cfe5a305e426d8530563c11da">space</a> = insn_space;
<a name="l01419"></a>01419       inst.<a class="code" href="classwarp__inst__t.html#afd733ed202cb8ea4a2fdfea5d1ed9e4d">set_addr</a>(lane_id, insn_memaddr);
<a name="l01420"></a>01420       inst.<a class="code" href="classinst__t.html#a17ce412c0e2dc350263be5e20efb4b36">data_size</a> = insn_data_size; <span class="comment">// simpleAtomicIntrinsics</span>
<a name="l01421"></a>01421       assert( inst.<a class="code" href="classinst__t.html#a9b1e867c7e8fc7d452ee732f9efcb37d">memory_op</a> == insn_memory_op );
<a name="l01422"></a>01422    } 
<a name="l01423"></a>01423 
<a name="l01424"></a>01424    } <span class="keywordflow">catch</span> ( <span class="keywordtype">int</span> x  ) {
<a name="l01425"></a>01425       printf(<span class="stringliteral">&quot;GPGPU-Sim PTX: ERROR (%d) executing intruction (%s:%u)\n&quot;</span>, x, pI-&gt;<a class="code" href="classptx__instruction.html#a6c318383901e62008f98e8f370f7e202">source_file</a>(), pI-&gt;<a class="code" href="classptx__instruction.html#aa7417e4758e1dfc4fb5a92030071a040">source_line</a>() );
<a name="l01426"></a>01426       printf(<span class="stringliteral">&quot;GPGPU-Sim PTX:       &apos;%s&apos;\n&quot;</span>, pI-&gt;<a class="code" href="classptx__instruction.html#a48a21a457c9452363281b65a64f99282">get_source</a>() );
<a name="l01427"></a>01427       abort();
<a name="l01428"></a>01428    }
<a name="l01429"></a>01429       
<a name="l01430"></a>01430 }
<a name="l01431"></a>01431 
<a name="l01432"></a><a class="code" href="cuda-sim_8h.html#acf8db40a012a2071391c886273b0943c">01432</a> <span class="keywordtype">void</span> <a class="code" href="cuda-sim_8cc.html#acf8db40a012a2071391c886273b0943c">set_param_gpgpu_num_shaders</a>(<span class="keywordtype">int</span> num_shaders)
<a name="l01433"></a>01433 {
<a name="l01434"></a>01434    <a class="code" href="cuda-sim_8cc.html#ad5c29bbd74a31bb8919fae539c7ff724">gpgpu_param_num_shaders</a> = num_shaders;
<a name="l01435"></a>01435 }
<a name="l01436"></a>01436 
<a name="l01437"></a><a class="code" href="cuda-sim_8cc.html#ac129e6548142ed04ff67f00980e2f6db">01437</a> <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structgpgpu__ptx__sim__info.html">gpgpu_ptx_sim_info</a>* <a class="code" href="cuda-sim_8cc.html#ac129e6548142ed04ff67f00980e2f6db">ptx_sim_kernel_info</a>(<span class="keyword">const</span> <a class="code" href="classfunction__info.html">function_info</a> *kernel)
<a name="l01438"></a>01438 {
<a name="l01439"></a>01439    <span class="keywordflow">return</span> kernel-&gt;<a class="code" href="classfunction__info.html#a3a41656867b5041c478482ed3f4eb996">get_kernel_info</a>();
<a name="l01440"></a>01440 }
<a name="l01441"></a>01441 
<a name="l01442"></a><a class="code" href="cuda-sim_8h.html#a2598a2a8589cd0a55c15cd594eb439ae">01442</a> <span class="keyword">const</span> <a class="code" href="classwarp__inst__t.html">warp_inst_t</a> *<a class="code" href="cuda-sim_8cc.html#a2598a2a8589cd0a55c15cd594eb439ae">ptx_fetch_inst</a>( <a class="code" href="abstract__hardware__model_8h.html#a4234d30919c0dcca6fca040a13ad6ae1">address_type</a> pc )
<a name="l01443"></a>01443 {
<a name="l01444"></a>01444     <span class="keywordflow">return</span> <a class="code" href="classfunction__info.html#a9e106da799e9605e321e06e05cc6df55">function_info::pc_to_instruction</a>(pc);
<a name="l01445"></a>01445 }
<a name="l01446"></a>01446 
<a name="l01447"></a><a class="code" href="cuda-sim_8h.html#a8ce6a2eab2c4aed86fc002ef8f4605c0">01447</a> <span class="keywordtype">unsigned</span> <a class="code" href="cuda-sim_8cc.html#a814facf1e22372309b98fe8d820a6e75">ptx_sim_init_thread</a>( <a class="code" href="classkernel__info__t.html">kernel_info_t</a> &amp;kernel,
<a name="l01448"></a>01448                               <a class="code" href="classptx__thread__info.html">ptx_thread_info</a>** thread_info,
<a name="l01449"></a>01449                               <span class="keywordtype">int</span> sid,
<a name="l01450"></a>01450                               <span class="keywordtype">unsigned</span> tid,
<a name="l01451"></a>01451                               <span class="keywordtype">unsigned</span> threads_left,
<a name="l01452"></a>01452                               <span class="keywordtype">unsigned</span> num_threads, 
<a name="l01453"></a>01453                               <a class="code" href="classcore__t.html">core_t</a> *core, 
<a name="l01454"></a>01454                               <span class="keywordtype">unsigned</span> hw_cta_id, 
<a name="l01455"></a>01455                               <span class="keywordtype">unsigned</span> hw_warp_id,
<a name="l01456"></a>01456                               <a class="code" href="classgpgpu__t.html">gpgpu_t</a> *gpu,
<a name="l01457"></a>01457                               <span class="keywordtype">bool</span> isInFunctionalSimulationMode)
<a name="l01458"></a>01458 {
<a name="l01459"></a>01459    std::list&lt;ptx_thread_info *&gt; &amp;active_threads = kernel.<a class="code" href="classkernel__info__t.html#ad8c1b0d97287a2dd259e58547f219a3c">active_threads</a>();
<a name="l01460"></a>01460 
<a name="l01461"></a>01461    <span class="keyword">static</span> std::map&lt;unsigned,memory_space*&gt; shared_memory_lookup;
<a name="l01462"></a>01462    <span class="keyword">static</span> std::map&lt;unsigned,ptx_cta_info*&gt; ptx_cta_lookup;
<a name="l01463"></a>01463    <span class="keyword">static</span> std::map&lt;unsigned,ptx_warp_info*&gt; ptx_warp_lookup;
<a name="l01464"></a>01464    <span class="keyword">static</span> std::map&lt;unsigned,std::map&lt;unsigned,memory_space*&gt; &gt; local_memory_lookup;
<a name="l01465"></a>01465 
<a name="l01466"></a>01466    <span class="keywordflow">if</span> ( *thread_info != NULL ) {
<a name="l01467"></a>01467       <a class="code" href="classptx__thread__info.html">ptx_thread_info</a> *thd = *thread_info;
<a name="l01468"></a>01468       assert( thd-&gt;<a class="code" href="classptx__thread__info.html#a20da83a32985f0a21e1140bf6c7f2f40">is_done</a>() );
<a name="l01469"></a>01469       <span class="keywordflow">if</span> ( g_debug_execution==-1 ) {
<a name="l01470"></a>01470          <a class="code" href="structdim3.html">dim3</a> ctaid = thd-&gt;<a class="code" href="classptx__thread__info.html#acdd4997ba9da7550a1f9bd0a4b0f3ee8">get_ctaid</a>();
<a name="l01471"></a>01471          <a class="code" href="structdim3.html">dim3</a> t = thd-&gt;<a class="code" href="classptx__thread__info.html#a27490e1189fbc0cd1046b1088536d2a7">get_tid</a>();
<a name="l01472"></a>01472          printf(<span class="stringliteral">&quot;GPGPU-Sim PTX simulator:  thread exiting ctaid=(%u,%u,%u) tid=(%u,%u,%u) uid=%u\n&quot;</span>,
<a name="l01473"></a>01473                 ctaid.<a class="code" href="structdim3.html#ac94584074d5c15f67c66656859bb24e9">x</a>,ctaid.<a class="code" href="structdim3.html#ae87d6f5fc0cc038be953f78f36ba873f">y</a>,ctaid.<a class="code" href="structdim3.html#a4856dbf9372e82eb478bf14ec1d2e294">z</a>,t.<a class="code" href="structdim3.html#ac94584074d5c15f67c66656859bb24e9">x</a>,t.<a class="code" href="structdim3.html#ae87d6f5fc0cc038be953f78f36ba873f">y</a>,t.<a class="code" href="structdim3.html#a4856dbf9372e82eb478bf14ec1d2e294">z</a>, thd-&gt;<a class="code" href="classptx__thread__info.html#a31196e491ff21efed0ed334a0b927130">get_uid</a>() );
<a name="l01474"></a>01474          fflush(stdout);
<a name="l01475"></a>01475       }
<a name="l01476"></a>01476       thd-&gt;<a class="code" href="classptx__thread__info.html#a7370f6a56ea5d11bcc6d66d16d849255">m_cta_info</a>-&gt;<a class="code" href="classptx__cta__info.html#a1f11378a34a2fb82861da9267693c3cd">register_deleted_thread</a>(thd);
<a name="l01477"></a>01477       <span class="keyword">delete</span> thd;
<a name="l01478"></a>01478       *thread_info = NULL;
<a name="l01479"></a>01479    }
<a name="l01480"></a>01480 
<a name="l01481"></a>01481    <span class="keywordflow">if</span> ( !active_threads.empty() ) {
<a name="l01482"></a>01482       assert( active_threads.size() &lt;= threads_left );
<a name="l01483"></a>01483       <a class="code" href="classptx__thread__info.html">ptx_thread_info</a> *thd = active_threads.front(); 
<a name="l01484"></a>01484       active_threads.pop_front();
<a name="l01485"></a>01485       *thread_info = thd;
<a name="l01486"></a>01486       thd-&gt;<a class="code" href="classptx__thread__info.html#a6fc4a8a1571a8edeae3010b41367f5a7">init</a>(gpu, core, sid, hw_cta_id, hw_warp_id, tid, isInFunctionalSimulationMode );
<a name="l01487"></a>01487       <span class="keywordflow">return</span> 1;
<a name="l01488"></a>01488    }
<a name="l01489"></a>01489 
<a name="l01490"></a>01490    <span class="keywordflow">if</span> ( kernel.<a class="code" href="classkernel__info__t.html#a245a21ded3eebcf3b400a875f2eced46">no_more_ctas_to_run</a>() ) {
<a name="l01491"></a>01491       <span class="keywordflow">return</span> 0; <span class="comment">//finished!</span>
<a name="l01492"></a>01492    }
<a name="l01493"></a>01493 
<a name="l01494"></a>01494    <span class="keywordflow">if</span> ( threads_left &lt; kernel.<a class="code" href="classkernel__info__t.html#a7764459a63b3dd279dfb07576a1dc718">threads_per_cta</a>() ) {
<a name="l01495"></a>01495       <span class="keywordflow">return</span> 0;
<a name="l01496"></a>01496    }
<a name="l01497"></a>01497 
<a name="l01498"></a>01498    <span class="keywordflow">if</span> ( g_debug_execution==-1 ) {
<a name="l01499"></a>01499       printf(<span class="stringliteral">&quot;GPGPU-Sim PTX simulator:  STARTING THREAD ALLOCATION --&gt; \n&quot;</span>);
<a name="l01500"></a>01500       fflush(stdout);
<a name="l01501"></a>01501    }
<a name="l01502"></a>01502 
<a name="l01503"></a>01503    <span class="comment">//initializing new CTA</span>
<a name="l01504"></a>01504    <a class="code" href="classptx__cta__info.html">ptx_cta_info</a> *cta_info = NULL;
<a name="l01505"></a>01505    <a class="code" href="classmemory__space.html">memory_space</a> *shared_mem = NULL;
<a name="l01506"></a>01506 
<a name="l01507"></a>01507    <span class="keywordtype">unsigned</span> cta_size = kernel.<a class="code" href="classkernel__info__t.html#a7764459a63b3dd279dfb07576a1dc718">threads_per_cta</a>();
<a name="l01508"></a>01508    <span class="keywordtype">unsigned</span> max_cta_per_sm = num_threads/cta_size; <span class="comment">// e.g., 256 / 48 = 5 </span>
<a name="l01509"></a>01509    assert( max_cta_per_sm &gt; 0 );
<a name="l01510"></a>01510 
<a name="l01511"></a>01511    <span class="comment">//unsigned sm_idx = (tid/cta_size)*gpgpu_param_num_shaders + sid;</span>
<a name="l01512"></a>01512    <span class="keywordtype">unsigned</span> sm_idx = hw_cta_id*<a class="code" href="cuda-sim_8cc.html#ad5c29bbd74a31bb8919fae539c7ff724">gpgpu_param_num_shaders</a> + sid;
<a name="l01513"></a>01513 
<a name="l01514"></a>01514    <span class="keywordflow">if</span> ( shared_memory_lookup.find(sm_idx) == shared_memory_lookup.end() ) {
<a name="l01515"></a>01515       <span class="keywordflow">if</span> ( g_debug_execution &gt;= 1 ) {
<a name="l01516"></a>01516          printf(<span class="stringliteral">&quot;  &lt;CTA alloc&gt; : sm_idx=%u sid=%u max_cta_per_sm=%u\n&quot;</span>, 
<a name="l01517"></a>01517                 sm_idx, sid, max_cta_per_sm );
<a name="l01518"></a>01518       }
<a name="l01519"></a>01519       <span class="keywordtype">char</span> buf[512];
<a name="l01520"></a>01520       snprintf(buf,512,<span class="stringliteral">&quot;shared_%u&quot;</span>, sid);
<a name="l01521"></a>01521       shared_mem = <span class="keyword">new</span> <a class="code" href="classmemory__space__impl.html">memory_space_impl&lt;16*1024&gt;</a>(buf,4);
<a name="l01522"></a>01522       shared_memory_lookup[sm_idx] = shared_mem;
<a name="l01523"></a>01523       cta_info = <span class="keyword">new</span> <a class="code" href="classptx__cta__info.html">ptx_cta_info</a>(sm_idx);
<a name="l01524"></a>01524       ptx_cta_lookup[sm_idx] = cta_info;
<a name="l01525"></a>01525    } <span class="keywordflow">else</span> {
<a name="l01526"></a>01526       <span class="keywordflow">if</span> ( g_debug_execution &gt;= 1 ) {
<a name="l01527"></a>01527          printf(<span class="stringliteral">&quot;  &lt;CTA realloc&gt; : sm_idx=%u sid=%u max_cta_per_sm=%u\n&quot;</span>, 
<a name="l01528"></a>01528                 sm_idx, sid, max_cta_per_sm );
<a name="l01529"></a>01529       }
<a name="l01530"></a>01530       shared_mem = shared_memory_lookup[sm_idx];
<a name="l01531"></a>01531       cta_info = ptx_cta_lookup[sm_idx];
<a name="l01532"></a>01532       cta_info-&gt;<a class="code" href="classptx__cta__info.html#a5f6633c3664f37c67a99e31cb1fa477c">check_cta_thread_status_and_reset</a>();
<a name="l01533"></a>01533    }
<a name="l01534"></a>01534 
<a name="l01535"></a>01535    std::map&lt;unsigned,memory_space*&gt; &amp;local_mem_lookup = local_memory_lookup[sid];
<a name="l01536"></a>01536    <span class="keywordflow">while</span>( kernel.<a class="code" href="classkernel__info__t.html#a1bbaf1bd6f3e246e15e58e256d911b1a">more_threads_in_cta</a>() ) {
<a name="l01537"></a>01537       <a class="code" href="structdim3.html">dim3</a> ctaid3d = kernel.<a class="code" href="classkernel__info__t.html#a8ac7b2abae46ae771f93902fc2c1e58b">get_next_cta_id</a>();
<a name="l01538"></a>01538       <span class="keywordtype">unsigned</span> new_tid = kernel.<a class="code" href="classkernel__info__t.html#af4880466daf23824b6c87a71a56b9bc9">get_next_thread_id</a>();
<a name="l01539"></a>01539       <a class="code" href="structdim3.html">dim3</a> tid3d = kernel.<a class="code" href="classkernel__info__t.html#ad67fd6e37c6daa346277df267f086063">get_next_thread_id_3d</a>();
<a name="l01540"></a>01540       kernel.<a class="code" href="classkernel__info__t.html#ae78ab93fceade6ec68c5968332bfe08e">increment_thread_id</a>();
<a name="l01541"></a>01541       new_tid += tid;
<a name="l01542"></a>01542       <a class="code" href="classptx__thread__info.html">ptx_thread_info</a> *thd = <span class="keyword">new</span> <a class="code" href="classptx__thread__info.html">ptx_thread_info</a>(kernel);
<a name="l01543"></a>01543 
<a name="l01544"></a>01544       <a class="code" href="classptx__warp__info.html">ptx_warp_info</a> *warp_info = NULL;
<a name="l01545"></a>01545       <span class="keywordflow">if</span> ( ptx_warp_lookup.find(hw_warp_id) == ptx_warp_lookup.end() ) {
<a name="l01546"></a>01546           warp_info = <span class="keyword">new</span> <a class="code" href="classptx__warp__info.html">ptx_warp_info</a>();
<a name="l01547"></a>01547           ptx_warp_lookup[hw_warp_id] = warp_info;
<a name="l01548"></a>01548       } <span class="keywordflow">else</span> {
<a name="l01549"></a>01549           warp_info = ptx_warp_lookup[hw_warp_id];
<a name="l01550"></a>01550       }
<a name="l01551"></a>01551       thd-&gt;<a class="code" href="classptx__thread__info.html#a2c1803a0c8c6e846715290e52bb6b5b0">m_warp_info</a> = warp_info;
<a name="l01552"></a>01552 
<a name="l01553"></a>01553       <a class="code" href="classmemory__space.html">memory_space</a> *local_mem = NULL;
<a name="l01554"></a>01554       std::map&lt;unsigned,memory_space*&gt;::iterator l = local_mem_lookup.find(new_tid);
<a name="l01555"></a>01555       <span class="keywordflow">if</span> ( l != local_mem_lookup.end() ) {
<a name="l01556"></a>01556          local_mem = l-&gt;second;
<a name="l01557"></a>01557       } <span class="keywordflow">else</span> {
<a name="l01558"></a>01558          <span class="keywordtype">char</span> buf[512];
<a name="l01559"></a>01559          snprintf(buf,512,<span class="stringliteral">&quot;local_%u_%u&quot;</span>, sid, new_tid);
<a name="l01560"></a>01560          local_mem = <span class="keyword">new</span> <a class="code" href="classmemory__space__impl.html">memory_space_impl&lt;32&gt;</a>(buf,32);
<a name="l01561"></a>01561          local_mem_lookup[new_tid] = local_mem;
<a name="l01562"></a>01562       }
<a name="l01563"></a>01563       thd-&gt;<a class="code" href="classptx__thread__info.html#a292392c09fc896645d9a304ddb7a47f0">set_info</a>(kernel.<a class="code" href="classkernel__info__t.html#aba475239cb9951ac6db8e03714e1f525">entry</a>());
<a name="l01564"></a>01564       thd-&gt;<a class="code" href="classptx__thread__info.html#a86f153f433c595ebeb8159940d895360">set_nctaid</a>(kernel.<a class="code" href="classkernel__info__t.html#a140b72f5897f773da401aa64545eb955">get_grid_dim</a>());
<a name="l01565"></a>01565       thd-&gt;<a class="code" href="classptx__thread__info.html#a0f27a4e228463d24d1e4d43d918b0bdf">set_ntid</a>(kernel.<a class="code" href="classkernel__info__t.html#a165011d89ac167809bf387d57e05a82a">get_cta_dim</a>());
<a name="l01566"></a>01566       thd-&gt;<a class="code" href="classptx__thread__info.html#a6720d623c9cbaa703b9f943bbda848b3">set_ctaid</a>(ctaid3d);
<a name="l01567"></a>01567       thd-&gt;<a class="code" href="classptx__thread__info.html#a36b7c1c7ca9ee9e9b8b16a8a6b73a0e8">set_tid</a>(tid3d);
<a name="l01568"></a>01568       <span class="keywordflow">if</span>( kernel.<a class="code" href="classkernel__info__t.html#aba475239cb9951ac6db8e03714e1f525">entry</a>()-&gt;<a class="code" href="classfunction__info.html#a4e05293969207a48afde9a29d391602f">get_ptx_version</a>().<a class="code" href="classptx__version.html#a2704937b3fda8910a21d85c5d565d046">extensions</a>() ) 
<a name="l01569"></a>01569          thd-&gt;<a class="code" href="classptx__thread__info.html#a0beb0f49e2e7613e15ac4e7b7a0651b0">cpy_tid_to_reg</a>(tid3d);
<a name="l01570"></a>01570       thd-&gt;<a class="code" href="classptx__thread__info.html#ada16d2f88feaaa4fe4da553a54e8b79a">set_valid</a>();
<a name="l01571"></a>01571       thd-&gt;<a class="code" href="classptx__thread__info.html#a7c4af02df5c97e1e2d89f2475bf8df8f">m_shared_mem</a> = shared_mem;
<a name="l01572"></a>01572       <a class="code" href="classfunction__info.html">function_info</a> *finfo = thd-&gt;<a class="code" href="classptx__thread__info.html#a347a506ae0f4357961f162498000762c">func_info</a>();
<a name="l01573"></a>01573       <a class="code" href="classsymbol__table.html">symbol_table</a> *st = finfo-&gt;<a class="code" href="classfunction__info.html#a8caa75eb8eb21911171c0a18de7fed4a">get_symtab</a>();
<a name="l01574"></a>01574       thd-&gt;<a class="code" href="classptx__thread__info.html#a347a506ae0f4357961f162498000762c">func_info</a>()-&gt;<a class="code" href="classfunction__info.html#a17b876255ebfa62bdf156047be931438">param_to_shared</a>(thd-&gt;<a class="code" href="classptx__thread__info.html#a7c4af02df5c97e1e2d89f2475bf8df8f">m_shared_mem</a>,st);
<a name="l01575"></a>01575       thd-&gt;<a class="code" href="classptx__thread__info.html#a7370f6a56ea5d11bcc6d66d16d849255">m_cta_info</a> = cta_info;
<a name="l01576"></a>01576       cta_info-&gt;<a class="code" href="classptx__cta__info.html#aa6a317cc0b31dc6387e4948cf5d84a55">add_thread</a>(thd);
<a name="l01577"></a>01577       thd-&gt;<a class="code" href="classptx__thread__info.html#a22296d84ac37c6861d88a24761506e2e">m_local_mem</a> = local_mem;
<a name="l01578"></a>01578       <span class="keywordflow">if</span> ( g_debug_execution==-1 ) {
<a name="l01579"></a>01579          printf(<span class="stringliteral">&quot;GPGPU-Sim PTX simulator:  allocating thread ctaid=(%u,%u,%u) tid=(%u,%u,%u) @ 0x%Lx\n&quot;</span>,
<a name="l01580"></a>01580                 ctaid3d.<a class="code" href="structdim3.html#ac94584074d5c15f67c66656859bb24e9">x</a>,ctaid3d.<a class="code" href="structdim3.html#ae87d6f5fc0cc038be953f78f36ba873f">y</a>,ctaid3d.<a class="code" href="structdim3.html#a4856dbf9372e82eb478bf14ec1d2e294">z</a>,tid3d.<a class="code" href="structdim3.html#ac94584074d5c15f67c66656859bb24e9">x</a>,tid3d.<a class="code" href="structdim3.html#ae87d6f5fc0cc038be953f78f36ba873f">y</a>,tid3d.<a class="code" href="structdim3.html#a4856dbf9372e82eb478bf14ec1d2e294">z</a>, (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span>)thd );
<a name="l01581"></a>01581          fflush(stdout);
<a name="l01582"></a>01582       }
<a name="l01583"></a>01583       active_threads.push_back(thd);
<a name="l01584"></a>01584    }
<a name="l01585"></a>01585    <span class="keywordflow">if</span> ( g_debug_execution==-1 ) {
<a name="l01586"></a>01586       printf(<span class="stringliteral">&quot;GPGPU-Sim PTX simulator:  &lt;-- FINISHING THREAD ALLOCATION\n&quot;</span>);
<a name="l01587"></a>01587       fflush(stdout);
<a name="l01588"></a>01588    }
<a name="l01589"></a>01589 
<a name="l01590"></a>01590    kernel.<a class="code" href="classkernel__info__t.html#ad4ec3bb017f08d112a845d443a0e01a4">increment_cta_id</a>();
<a name="l01591"></a>01591 
<a name="l01592"></a>01592    assert( active_threads.size() &lt;= threads_left );
<a name="l01593"></a>01593    *thread_info = active_threads.front();
<a name="l01594"></a>01594    (*thread_info)-&gt;<a class="code" href="classptx__thread__info.html#a6fc4a8a1571a8edeae3010b41367f5a7">init</a>(gpu, core, sid, hw_cta_id, hw_warp_id, tid,isInFunctionalSimulationMode );
<a name="l01595"></a>01595    active_threads.pop_front();
<a name="l01596"></a>01596    <span class="keywordflow">return</span> 1;
<a name="l01597"></a>01597 }
<a name="l01598"></a>01598 
<a name="l01599"></a><a class="code" href="cuda-sim_8cc.html#adb5bcd9d21c9fcf9e2af27b99b10a505">01599</a> <span class="keywordtype">size_t</span> <a class="code" href="abstract__hardware__model_8h.html#adb5bcd9d21c9fcf9e2af27b99b10a505">get_kernel_code_size</a>( <span class="keyword">class</span> <a class="code" href="classfunction__info.html">function_info</a> *entry )
<a name="l01600"></a>01600 {
<a name="l01601"></a>01601    <span class="keywordflow">return</span> entry-&gt;<a class="code" href="classfunction__info.html#ad44eff9828821befe13ab267dc38f0c4">get_function_size</a>();
<a name="l01602"></a>01602 }
<a name="l01603"></a>01603 
<a name="l01604"></a>01604 
<a name="l01605"></a><a class="code" href="cuda-sim_8h.html#a75f05d9adcd5d7a46913829ca01907df">01605</a> <a class="code" href="classkernel__info__t.html">kernel_info_t</a> *<a class="code" href="cuda-sim_8cc.html#a1c1edbf749ad771a052756c2522be5f4">gpgpu_opencl_ptx_sim_init_grid</a>(<span class="keyword">class</span> <a class="code" href="classfunction__info.html">function_info</a> *entry,
<a name="l01606"></a>01606                                              <a class="code" href="abstract__hardware__model_8h.html#a400ae36727fbd6ac693cb1adc886e3d4">gpgpu_ptx_sim_arg_list_t</a> args, 
<a name="l01607"></a>01607                                              <span class="keyword">struct</span> <a class="code" href="structdim3.html">dim3</a> gridDim,
<a name="l01608"></a>01608                                              <span class="keyword">struct</span> <a class="code" href="structdim3.html">dim3</a> blockDim,
<a name="l01609"></a>01609                                              <a class="code" href="classgpgpu__t.html">gpgpu_t</a> *gpu )
<a name="l01610"></a>01610 {
<a name="l01611"></a>01611    <a class="code" href="classkernel__info__t.html">kernel_info_t</a> *result = <span class="keyword">new</span> <a class="code" href="classkernel__info__t.html">kernel_info_t</a>(gridDim,blockDim,entry);
<a name="l01612"></a>01612    <span class="keywordtype">unsigned</span> argcount=args.size();
<a name="l01613"></a>01613    <span class="keywordtype">unsigned</span> argn=1;
<a name="l01614"></a>01614    <span class="keywordflow">for</span>( gpgpu_ptx_sim_arg_list_t::iterator a = args.begin(); a != args.end(); a++ ) {
<a name="l01615"></a>01615       entry-&gt;<a class="code" href="classfunction__info.html#a37e8b015fb8a89f0771ebf25ecc0b12d">add_param_data</a>(argcount-argn,&amp;(*a));
<a name="l01616"></a>01616       argn++;
<a name="l01617"></a>01617    }
<a name="l01618"></a>01618    entry-&gt;<a class="code" href="classfunction__info.html#aab3481fb9791864a44d333885a258f19">finalize</a>(result-&gt;<a class="code" href="classkernel__info__t.html#a28b75bb56fecf6c9e9e5845b1c7af2e2">get_param_memory</a>());
<a name="l01619"></a>01619    g_ptx_kernel_count++; 
<a name="l01620"></a>01620    fflush(stdout);
<a name="l01621"></a>01621 
<a name="l01622"></a>01622    <span class="keywordflow">return</span> result;
<a name="l01623"></a>01623 }
<a name="l01624"></a>01624 
<a name="l01625"></a>01625 <span class="preprocessor">#include &quot;../../version&quot;</span>
<a name="l01626"></a>01626 <span class="preprocessor">#include &quot;detailed_version&quot;</span>
<a name="l01627"></a>01627 
<a name="l01628"></a><a class="code" href="cuda-sim_8h.html#a427d220616b998e90ab62ae3852a9c0f">01628</a> <span class="keywordtype">void</span> <a class="code" href="cuda-sim_8cc.html#a427d220616b998e90ab62ae3852a9c0f">print_splash</a>()
<a name="l01629"></a>01629 {
<a name="l01630"></a>01630    <span class="keyword">static</span> <span class="keywordtype">int</span> splash_printed=0;
<a name="l01631"></a>01631    <span class="keywordflow">if</span> ( !splash_printed ) {
<a name="l01632"></a>01632       fprintf(stdout, <span class="stringliteral">&quot;\n\n        *** %s [build %s] ***\n\n\n&quot;</span>, <a class="code" href="cuda-sim_8h.html#a5b217e76edabb3d68e12eaa1648d356b">g_gpgpusim_version_string</a>, g_gpgpusim_build_string );
<a name="l01633"></a>01633       splash_printed=1;
<a name="l01634"></a>01634    }
<a name="l01635"></a>01635 }
<a name="l01636"></a>01636 
<a name="l01637"></a><a class="code" href="cuda-sim_8cc.html#af62939a3e96aced8eb1c35d37628d460">01637</a> std::map&lt;const void*,std::string&gt;   <a class="code" href="cuda-sim_8cc.html#af62939a3e96aced8eb1c35d37628d460">g_const_name_lookup</a>; <span class="comment">// indexed by hostVar</span>
<a name="l01638"></a><a class="code" href="cuda-sim_8cc.html#ac3dbf3939a7d850c7e1f690f1c416a68">01638</a> std::map&lt;const void*,std::string&gt;   <a class="code" href="cuda-sim_8cc.html#ac3dbf3939a7d850c7e1f690f1c416a68">g_global_name_lookup</a>; <span class="comment">// indexed by hostVar</span>
<a name="l01639"></a><a class="code" href="ptx__parser_8cc.html#a9075f732b5ba9a8431ac045f50475744">01639</a> std::set&lt;std::string&gt;   <a class="code" href="cuda-sim_8cc.html#a9075f732b5ba9a8431ac045f50475744">g_globals</a>;
<a name="l01640"></a><a class="code" href="ptx__parser_8cc.html#a70c3e9c59adb42cccc47b1c8e05b25e8">01640</a> std::set&lt;std::string&gt;   <a class="code" href="cuda-sim_8cc.html#a70c3e9c59adb42cccc47b1c8e05b25e8">g_constants</a>;
<a name="l01641"></a>01641 
<a name="l01642"></a><a class="code" href="cuda-sim_8h.html#ac1576296df7581594fb4362ca9e357c0">01642</a> <span class="keywordtype">void</span> <a class="code" href="cuda-sim_8cc.html#aac6da2d2b9cc7ff5a6302e643605c592">gpgpu_ptx_sim_register_const_variable</a>(<span class="keywordtype">void</span> *hostVar, <span class="keyword">const</span> <span class="keywordtype">char</span> *deviceName, <span class="keywordtype">size_t</span> size )
<a name="l01643"></a>01643 {
<a name="l01644"></a>01644    printf(<span class="stringliteral">&quot;GPGPU-Sim PTX registering constant %s (%zu bytes) to name mapping\n&quot;</span>, deviceName, size );
<a name="l01645"></a>01645    <a class="code" href="cuda-sim_8cc.html#af62939a3e96aced8eb1c35d37628d460">g_const_name_lookup</a>[hostVar] = deviceName;
<a name="l01646"></a>01646 }
<a name="l01647"></a>01647 
<a name="l01648"></a><a class="code" href="cuda-sim_8h.html#a8d1bc7e080b4251c469de1db3643c781">01648</a> <span class="keywordtype">void</span> <a class="code" href="cuda-sim_8cc.html#a8d1bc7e080b4251c469de1db3643c781">gpgpu_ptx_sim_register_global_variable</a>(<span class="keywordtype">void</span> *hostVar, <span class="keyword">const</span> <span class="keywordtype">char</span> *deviceName, <span class="keywordtype">size_t</span> size )
<a name="l01649"></a>01649 {
<a name="l01650"></a>01650    printf(<span class="stringliteral">&quot;GPGPU-Sim PTX registering global %s hostVar to name mapping\n&quot;</span>, deviceName );
<a name="l01651"></a>01651    <a class="code" href="cuda-sim_8cc.html#ac3dbf3939a7d850c7e1f690f1c416a68">g_global_name_lookup</a>[hostVar] = deviceName;
<a name="l01652"></a>01652 }
<a name="l01653"></a>01653 
<a name="l01654"></a><a class="code" href="cuda-sim_8h.html#a62747131af7f81c6596dde5d1b070050">01654</a> <span class="keywordtype">void</span> <a class="code" href="cuda-sim_8cc.html#a62747131af7f81c6596dde5d1b070050">gpgpu_ptx_sim_memcpy_symbol</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *hostVar, <span class="keyword">const</span> <span class="keywordtype">void</span> *src, <span class="keywordtype">size_t</span> count, <span class="keywordtype">size_t</span> offset, <span class="keywordtype">int</span> to, <a class="code" href="classgpgpu__t.html">gpgpu_t</a> *gpu )
<a name="l01655"></a>01655 {
<a name="l01656"></a>01656    printf(<span class="stringliteral">&quot;GPGPU-Sim PTX: starting gpgpu_ptx_sim_memcpy_symbol with hostVar 0x%p\n&quot;</span>, hostVar);
<a name="l01657"></a>01657    <span class="keywordtype">bool</span> found_sym = <span class="keyword">false</span>;
<a name="l01658"></a>01658    <a class="code" href="classmemory__space__t.html">memory_space_t</a> mem_region = <a class="code" href="abstract__hardware__model_8h.html#a1ad2169aaa8924fcc552447f38a5b58ca434a5fd1a70c9dcbe2de96e9c602d265">undefined_space</a>;
<a name="l01659"></a>01659    std::string sym_name;
<a name="l01660"></a>01660 
<a name="l01661"></a>01661    std::map&lt;const void*,std::string&gt;::iterator c=<a class="code" href="cuda-sim_8cc.html#af62939a3e96aced8eb1c35d37628d460">g_const_name_lookup</a>.find(hostVar);
<a name="l01662"></a>01662    <span class="keywordflow">if</span> ( c!=<a class="code" href="cuda-sim_8cc.html#af62939a3e96aced8eb1c35d37628d460">g_const_name_lookup</a>.end() ) {
<a name="l01663"></a>01663       found_sym = <span class="keyword">true</span>;
<a name="l01664"></a>01664       sym_name = c-&gt;second;
<a name="l01665"></a>01665       mem_region = <a class="code" href="abstract__hardware__model_8h.html#a1ad2169aaa8924fcc552447f38a5b58ca445236c52ac314c07392ad430f155071">const_space</a>;
<a name="l01666"></a>01666    }
<a name="l01667"></a>01667    std::map&lt;const void*,std::string&gt;::iterator g=<a class="code" href="cuda-sim_8cc.html#ac3dbf3939a7d850c7e1f690f1c416a68">g_global_name_lookup</a>.find(hostVar);
<a name="l01668"></a>01668    <span class="keywordflow">if</span> ( g!=<a class="code" href="cuda-sim_8cc.html#ac3dbf3939a7d850c7e1f690f1c416a68">g_global_name_lookup</a>.end() ) {
<a name="l01669"></a>01669       <span class="keywordflow">if</span> ( found_sym ) {
<a name="l01670"></a>01670          printf(<span class="stringliteral">&quot;Execution error: PTX symbol \&quot;%s\&quot; w/ hostVar=0x%Lx is declared both const and global?\n&quot;</span>, 
<a name="l01671"></a>01671                 sym_name.c_str(), (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> long)hostVar );
<a name="l01672"></a>01672          abort();
<a name="l01673"></a>01673       }
<a name="l01674"></a>01674       found_sym = <span class="keyword">true</span>;
<a name="l01675"></a>01675       sym_name = g-&gt;second;
<a name="l01676"></a>01676       mem_region = <a class="code" href="abstract__hardware__model_8h.html#a1ad2169aaa8924fcc552447f38a5b58cade54d01d283e68c3e9c5b8d75b85e49e">global_space</a>;
<a name="l01677"></a>01677    }
<a name="l01678"></a>01678    <span class="keywordflow">if</span>( <a class="code" href="cuda-sim_8cc.html#a9075f732b5ba9a8431ac045f50475744">g_globals</a>.find(hostVar) != <a class="code" href="cuda-sim_8cc.html#a9075f732b5ba9a8431ac045f50475744">g_globals</a>.end() ) {
<a name="l01679"></a>01679       found_sym = <span class="keyword">true</span>;
<a name="l01680"></a>01680       sym_name = hostVar;
<a name="l01681"></a>01681       mem_region = <a class="code" href="abstract__hardware__model_8h.html#a1ad2169aaa8924fcc552447f38a5b58cade54d01d283e68c3e9c5b8d75b85e49e">global_space</a>;
<a name="l01682"></a>01682    }
<a name="l01683"></a>01683    <span class="keywordflow">if</span>( <a class="code" href="cuda-sim_8cc.html#a70c3e9c59adb42cccc47b1c8e05b25e8">g_constants</a>.find(hostVar) != <a class="code" href="cuda-sim_8cc.html#a70c3e9c59adb42cccc47b1c8e05b25e8">g_constants</a>.end() ) {
<a name="l01684"></a>01684       found_sym = <span class="keyword">true</span>;
<a name="l01685"></a>01685       sym_name = hostVar;
<a name="l01686"></a>01686       mem_region = <a class="code" href="abstract__hardware__model_8h.html#a1ad2169aaa8924fcc552447f38a5b58ca445236c52ac314c07392ad430f155071">const_space</a>;
<a name="l01687"></a>01687    }
<a name="l01688"></a>01688 
<a name="l01689"></a>01689    <span class="keywordflow">if</span> ( !found_sym ) {
<a name="l01690"></a>01690       printf(<span class="stringliteral">&quot;Execution error: No information for PTX symbol w/ hostVar=0x%Lx\n&quot;</span>, (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span>)hostVar );
<a name="l01691"></a>01691       abort();
<a name="l01692"></a>01692    } <span class="keywordflow">else</span> printf(<span class="stringliteral">&quot;GPGPU-Sim PTX: gpgpu_ptx_sim_memcpy_symbol: Found PTX symbol w/ hostVar=0x%Lx\n&quot;</span>, (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span>)hostVar ); 
<a name="l01693"></a>01693    <span class="keyword">const</span> <span class="keywordtype">char</span> *mem_name = NULL;
<a name="l01694"></a>01694    <a class="code" href="classmemory__space.html">memory_space</a> *mem = NULL;
<a name="l01695"></a>01695 
<a name="l01696"></a>01696    std::map&lt;std::string,symbol_table*&gt;::iterator st = <a class="code" href="ptx__ir_8h.html#aeef56c6f09e0b8f05a6a6258ae7a24b4">g_sym_name_to_symbol_table</a>.find(sym_name.c_str());
<a name="l01697"></a>01697    assert( st != <a class="code" href="ptx__ir_8h.html#aeef56c6f09e0b8f05a6a6258ae7a24b4">g_sym_name_to_symbol_table</a>.end() );
<a name="l01698"></a>01698    <a class="code" href="classsymbol__table.html">symbol_table</a> *symtab = st-&gt;second;
<a name="l01699"></a>01699 
<a name="l01700"></a>01700    <a class="code" href="classsymbol.html">symbol</a> *sym = symtab-&gt;lookup(sym_name.c_str());
<a name="l01701"></a>01701    assert(sym);
<a name="l01702"></a>01702    <span class="keywordtype">unsigned</span> dst = sym-&gt;<a class="code" href="classsymbol.html#a8fc9a6e49bb901608ff0dab49538db09">get_address</a>() + offset; 
<a name="l01703"></a>01703    <span class="keywordflow">switch</span> (mem_region.<a class="code" href="classmemory__space__t.html#a9aa8b2fabc2c16d1bfda090f27ab479c">get_type</a>()) {
<a name="l01704"></a>01704    <span class="keywordflow">case</span> <a class="code" href="abstract__hardware__model_8h.html#a1ad2169aaa8924fcc552447f38a5b58ca445236c52ac314c07392ad430f155071">const_space</a>:
<a name="l01705"></a>01705       mem = gpu-&gt;<a class="code" href="classgpgpu__t.html#aa56aff940ed9da19725dcf5616629626">get_global_memory</a>();
<a name="l01706"></a>01706       mem_name = <span class="stringliteral">&quot;const&quot;</span>;
<a name="l01707"></a>01707       <span class="keywordflow">break</span>;
<a name="l01708"></a>01708    <span class="keywordflow">case</span> <a class="code" href="abstract__hardware__model_8h.html#a1ad2169aaa8924fcc552447f38a5b58cade54d01d283e68c3e9c5b8d75b85e49e">global_space</a>:
<a name="l01709"></a>01709       mem = gpu-&gt;<a class="code" href="classgpgpu__t.html#aa56aff940ed9da19725dcf5616629626">get_global_memory</a>();
<a name="l01710"></a>01710       mem_name = <span class="stringliteral">&quot;global&quot;</span>;
<a name="l01711"></a>01711       <span class="keywordflow">break</span>;
<a name="l01712"></a>01712    <span class="keywordflow">default</span>:
<a name="l01713"></a>01713       abort();
<a name="l01714"></a>01714    }
<a name="l01715"></a>01715    printf(<span class="stringliteral">&quot;GPGPU-Sim PTX: gpgpu_ptx_sim_memcpy_symbol: copying %s memory %zu bytes %s symbol %s+%zu @0x%x ...\n&quot;</span>, 
<a name="l01716"></a>01716           mem_name, count, (to?<span class="stringliteral">&quot; to &quot;</span>:<span class="stringliteral">&quot;from&quot;</span>), sym_name.c_str(), offset, dst );
<a name="l01717"></a>01717    <span class="keywordflow">for</span> ( <span class="keywordtype">unsigned</span> <a class="code" href="rng-double_8c.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>=0; <a class="code" href="rng-double_8c.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a> &lt; count; <a class="code" href="rng-double_8c.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>++ ) {
<a name="l01718"></a>01718       <span class="keywordflow">if</span>( to ) mem-&gt;<a class="code" href="classmemory__space.html#acc4d70cea1a6c55b70c527b6c80d62a5">write</a>(dst+<a class="code" href="rng-double_8c.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>,1,((<span class="keywordtype">char</span>*)src)+<a class="code" href="rng-double_8c.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>,NULL,NULL); 
<a name="l01719"></a>01719       <span class="keywordflow">else</span> mem-&gt;<a class="code" href="classmemory__space.html#ae1b293a67d5cebb90d3df4482c83f3a1">read</a>(dst+<a class="code" href="rng-double_8c.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>,1,((<span class="keywordtype">char</span>*)src)+<a class="code" href="rng-double_8c.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>); 
<a name="l01720"></a>01720    }
<a name="l01721"></a>01721    fflush(stdout);
<a name="l01722"></a>01722 }
<a name="l01723"></a>01723 
<a name="l01724"></a><a class="code" href="cuda-sim_8h.html#a6159b587777bb85f99ddc2659decc699">01724</a> <span class="keywordtype">int</span> <a class="code" href="cuda-sim_8cc.html#a6159b587777bb85f99ddc2659decc699">g_ptx_sim_mode</a>; <span class="comment">// if non-zero run functional simulation only (i.e., no notion of a clock cycle)</span>
<a name="l01725"></a>01725 
<a name="l01726"></a>01726 <span class="keyword">extern</span> <span class="keywordtype">int</span> <a class="code" href="cuda-sim_8cc.html#a1b726ae1aa7f79472b54e23d7a752ff0">ptx_debug</a>;
<a name="l01727"></a>01727 
<a name="l01728"></a><a class="code" href="gpgpusim__entrypoint_8cc.html#a39b9b761a2b5a8b8adda604883ccc3d3">01728</a> <span class="keywordtype">bool</span> <a class="code" href="cuda-sim_8cc.html#a39b9b761a2b5a8b8adda604883ccc3d3">g_cuda_launch_blocking</a> = <span class="keyword">false</span>;
<a name="l01729"></a>01729 
<a name="l01730"></a><a class="code" href="cuda-sim_8h.html#a0beab8406e42dcb1b15b563a944b9e82">01730</a> <span class="keywordtype">void</span> <a class="code" href="cuda-sim_8cc.html#a0beab8406e42dcb1b15b563a944b9e82">read_sim_environment_variables</a>() 
<a name="l01731"></a>01731 {
<a name="l01732"></a>01732    ptx_debug = 0;
<a name="l01733"></a>01733    g_debug_execution = 0;
<a name="l01734"></a>01734    <a class="code" href="gpu-sim_8cc.html#a75c0324090738b7806b06294fc7671c7">g_interactive_debugger_enabled</a> = <span class="keyword">false</span>;
<a name="l01735"></a>01735 
<a name="l01736"></a>01736    <span class="keywordtype">char</span> *mode = getenv(<span class="stringliteral">&quot;PTX_SIM_MODE_FUNC&quot;</span>);
<a name="l01737"></a>01737    <span class="keywordflow">if</span> ( mode )
<a name="l01738"></a>01738       sscanf(mode,<span class="stringliteral">&quot;%u&quot;</span>, &amp;g_ptx_sim_mode);
<a name="l01739"></a>01739    printf(<span class="stringliteral">&quot;GPGPU-Sim PTX: simulation mode %d (can change with PTX_SIM_MODE_FUNC environment variable:\n&quot;</span>, g_ptx_sim_mode);
<a name="l01740"></a>01740    printf(<span class="stringliteral">&quot;               1=functional simulation only, 0=detailed performance simulator)\n&quot;</span>);
<a name="l01741"></a>01741    <span class="keywordtype">char</span> *dbg_inter = getenv(<span class="stringliteral">&quot;GPGPUSIM_DEBUG&quot;</span>);
<a name="l01742"></a>01742    <span class="keywordflow">if</span> ( dbg_inter &amp;&amp; strlen(dbg_inter) ) {
<a name="l01743"></a>01743       printf(<span class="stringliteral">&quot;GPGPU-Sim PTX: enabling interactive debugger\n&quot;</span>);
<a name="l01744"></a>01744       fflush(stdout);
<a name="l01745"></a>01745       <a class="code" href="gpu-sim_8cc.html#a75c0324090738b7806b06294fc7671c7">g_interactive_debugger_enabled</a> = <span class="keyword">true</span>;
<a name="l01746"></a>01746    }
<a name="l01747"></a>01747    <span class="keywordtype">char</span> *dbg_level = getenv(<span class="stringliteral">&quot;PTX_SIM_DEBUG&quot;</span>);
<a name="l01748"></a>01748    <span class="keywordflow">if</span> ( dbg_level &amp;&amp; strlen(dbg_level) ) {
<a name="l01749"></a>01749       printf(<span class="stringliteral">&quot;GPGPU-Sim PTX: setting debug level to %s\n&quot;</span>, dbg_level );
<a name="l01750"></a>01750       fflush(stdout);
<a name="l01751"></a>01751       sscanf(dbg_level,<span class="stringliteral">&quot;%d&quot;</span>, &amp;g_debug_execution);
<a name="l01752"></a>01752    }
<a name="l01753"></a>01753    <span class="keywordtype">char</span> *dbg_thread = getenv(<span class="stringliteral">&quot;PTX_SIM_DEBUG_THREAD_UID&quot;</span>);
<a name="l01754"></a>01754    <span class="keywordflow">if</span> ( dbg_thread &amp;&amp; strlen(dbg_thread) ) {
<a name="l01755"></a>01755       printf(<span class="stringliteral">&quot;GPGPU-Sim PTX: printing debug information for thread uid %s\n&quot;</span>, dbg_thread );
<a name="l01756"></a>01756       fflush(stdout);
<a name="l01757"></a>01757       sscanf(dbg_thread,<span class="stringliteral">&quot;%d&quot;</span>, &amp;g_debug_thread_uid);
<a name="l01758"></a>01758    }
<a name="l01759"></a>01759    <span class="keywordtype">char</span> *dbg_pc = getenv(<span class="stringliteral">&quot;PTX_SIM_DEBUG_PC&quot;</span>);
<a name="l01760"></a>01760    <span class="keywordflow">if</span> ( dbg_pc &amp;&amp; strlen(dbg_pc) ) {
<a name="l01761"></a>01761       printf(<span class="stringliteral">&quot;GPGPU-Sim PTX: printing debug information for instruction with PC = %s\n&quot;</span>, dbg_pc );
<a name="l01762"></a>01762       fflush(stdout);
<a name="l01763"></a>01763       sscanf(dbg_pc,<span class="stringliteral">&quot;%d&quot;</span>, &amp;<a class="code" href="cuda-sim_8cc.html#a11c024d1b98a33dd76267662e50ea4d7">g_debug_pc</a>);
<a name="l01764"></a>01764    }
<a name="l01765"></a>01765 
<a name="l01766"></a>01766 <span class="preprocessor">#if CUDART_VERSION &gt; 1010</span>
<a name="l01767"></a>01767 <span class="preprocessor"></span>    <a class="code" href="ptx__loader_8cc.html#a1249fea814785341a9162f23518a1b53">g_override_embedded_ptx</a> = <span class="keyword">false</span>;
<a name="l01768"></a>01768     <span class="keywordtype">char</span> *usefile = getenv(<span class="stringliteral">&quot;PTX_SIM_USE_PTX_FILE&quot;</span>);
<a name="l01769"></a>01769     <span class="keywordflow">if</span> (usefile &amp;&amp; strlen(usefile)) {
<a name="l01770"></a>01770         printf(<span class="stringliteral">&quot;GPGPU-Sim PTX: overriding embedded ptx with ptx file (PTX_SIM_USE_PTX_FILE is set)\n&quot;</span>);
<a name="l01771"></a>01771         fflush(stdout);
<a name="l01772"></a>01772         <a class="code" href="ptx__loader_8cc.html#a1249fea814785341a9162f23518a1b53">g_override_embedded_ptx</a> = <span class="keyword">true</span>;
<a name="l01773"></a>01773     }
<a name="l01774"></a>01774     <span class="keywordtype">char</span> *blocking = getenv(<span class="stringliteral">&quot;CUDA_LAUNCH_BLOCKING&quot;</span>);
<a name="l01775"></a>01775     <span class="keywordflow">if</span>( blocking &amp;&amp; !strcmp(blocking,<span class="stringliteral">&quot;1&quot;</span>) ) {
<a name="l01776"></a>01776         <a class="code" href="cuda-sim_8cc.html#a39b9b761a2b5a8b8adda604883ccc3d3">g_cuda_launch_blocking</a> = <span class="keyword">true</span>;
<a name="l01777"></a>01777     }
<a name="l01778"></a>01778 <span class="preprocessor">#else</span>
<a name="l01779"></a>01779 <span class="preprocessor"></span>   <a class="code" href="cuda-sim_8cc.html#a39b9b761a2b5a8b8adda604883ccc3d3">g_cuda_launch_blocking</a> = <span class="keyword">true</span>;
<a name="l01780"></a>01780    <a class="code" href="ptx__loader_8cc.html#a1249fea814785341a9162f23518a1b53">g_override_embedded_ptx</a> = <span class="keyword">true</span>;
<a name="l01781"></a>01781 <span class="preprocessor">#endif</span>
<a name="l01782"></a>01782 <span class="preprocessor"></span>
<a name="l01783"></a>01783    <span class="keywordflow">if</span> ( g_debug_execution &gt;= 40 ) {
<a name="l01784"></a>01784       ptx_debug = 1;
<a name="l01785"></a>01785    }
<a name="l01786"></a>01786 }
<a name="l01787"></a>01787 
<a name="l01788"></a><a class="code" href="cuda-sim_8cc.html#a4427dc12f8ed06f471f85d51b2408626">01788</a> <a class="code" href="classptx__cta__info.html">ptx_cta_info</a> *<a class="code" href="cuda-sim_8cc.html#a4427dc12f8ed06f471f85d51b2408626">g_func_cta_info</a> = NULL;
<a name="l01789"></a>01789 
<a name="l01790"></a>01790 <span class="preprocessor">#define MAX(a,b) (((a)&gt;(b))?(a):(b))</span>
<a name="l01791"></a>01791 <span class="preprocessor"></span>
<a name="l01796"></a><a class="code" href="cuda-sim_8h.html#a444fba8e0511345cc422ba765d4c7355">01796</a> <span class="keywordtype">void</span> <a class="code" href="cuda-sim_8cc.html#a7599c2fedf4596b0521faa65df6b9525">gpgpu_cuda_ptx_sim_main_func</a>( <a class="code" href="classkernel__info__t.html">kernel_info_t</a> &amp;kernel, <span class="keywordtype">bool</span> openCL )
<a name="l01797"></a>01797 {
<a name="l01798"></a>01798      printf(<span class="stringliteral">&quot;GPGPU-Sim: Performing Functional Simulation, executing kernel %s...\n&quot;</span>,kernel.<a class="code" href="classkernel__info__t.html#aab01e70021fb02628523d80da58e37c6">name</a>().c_str());
<a name="l01799"></a>01799 
<a name="l01800"></a>01800      <span class="comment">//using a shader core object for book keeping, it is not needed but as most function built for performance simulation need it we use it here</span>
<a name="l01801"></a>01801     <span class="keyword">extern</span> <a class="code" href="classgpgpu__sim.html">gpgpu_sim</a> *<a class="code" href="gpgpusim__entrypoint_8cc.html#a7943f3582581ae703b6bbc944a8e6f1b">g_the_gpu</a>;
<a name="l01802"></a>01802 
<a name="l01803"></a>01803     <span class="comment">//we excute the kernel one CTA (Block) at the time, as synchronization functions work block wise</span>
<a name="l01804"></a>01804     <span class="keywordflow">while</span>(!kernel.<a class="code" href="classkernel__info__t.html#a245a21ded3eebcf3b400a875f2eced46">no_more_ctas_to_run</a>()){
<a name="l01805"></a>01805         <a class="code" href="classfunctionalCoreSim.html">functionalCoreSim</a> cta(
<a name="l01806"></a>01806             &amp;kernel,
<a name="l01807"></a>01807             g_the_gpu,
<a name="l01808"></a>01808             g_the_gpu-&gt;getShaderCoreConfig()-&gt;warp_size
<a name="l01809"></a>01809         );
<a name="l01810"></a>01810         cta.execute();
<a name="l01811"></a>01811 
<a name="l01812"></a>01812 <span class="preprocessor">#if (CUDART_VERSION &gt;= 5000)</span>
<a name="l01813"></a>01813 <span class="preprocessor"></span>    <a class="code" href="cuda__device__runtime_8cc.html#a92981f8b586ba092eaa9929be9292d49">launch_all_device_kernels</a>();
<a name="l01814"></a>01814 <span class="preprocessor">#endif</span>
<a name="l01815"></a>01815 <span class="preprocessor"></span>    }
<a name="l01816"></a>01816     
<a name="l01817"></a>01817    <span class="comment">//registering this kernel as done      </span>
<a name="l01818"></a>01818    
<a name="l01819"></a>01819    <span class="comment">//openCL kernel simulation calls don&apos;t register the kernel so we don&apos;t register its exit</span>
<a name="l01820"></a>01820    <span class="keywordflow">if</span>(!openCL) {
<a name="l01821"></a>01821       <span class="keyword">extern</span> <a class="code" href="classstream__manager.html">stream_manager</a> *<a class="code" href="abstract__hardware__model_8h.html#a30ef1a9bde057f0a5bb4a4ecfec53d5a">g_stream_manager</a>;
<a name="l01822"></a>01822       g_stream_manager-&gt;<a class="code" href="classstream__manager.html#aa94ecb2240ccafec3e526486515d02ba">register_finished_kernel</a>(kernel.<a class="code" href="classkernel__info__t.html#a3ad6a7212d90fa5650eae466002b5607">get_uid</a>());
<a name="l01823"></a>01823    }
<a name="l01824"></a>01824 
<a name="l01825"></a>01825    <span class="comment">//******PRINTING*******</span>
<a name="l01826"></a>01826    printf( <span class="stringliteral">&quot;GPGPU-Sim: Done functional simulation (%u instructions simulated).\n&quot;</span>, <a class="code" href="cuda-sim_8cc.html#a0cb22097f81b6f855ab91169a88ac624">g_ptx_sim_num_insn</a> );
<a name="l01827"></a>01827    <span class="keywordflow">if</span> ( gpgpu_ptx_instruction_classification ) {
<a name="l01828"></a>01828       <a class="code" href="statwrapper_8cc.html#a31a504fbfe34d62b7c91519cf81feb7b">StatDisp</a>( <a class="code" href="cuda-sim_8cc.html#a97068d33bba55c50e14efd24c9983787">g_inst_classification_stat</a>[g_ptx_kernel_count]);
<a name="l01829"></a>01829       <a class="code" href="statwrapper_8cc.html#a31a504fbfe34d62b7c91519cf81feb7b">StatDisp</a> ( <a class="code" href="cuda-sim_8cc.html#a44255eb97b0682c1154a13e0d3fc2bf5">g_inst_op_classification_stat</a>[g_ptx_kernel_count]);
<a name="l01830"></a>01830    }
<a name="l01831"></a>01831 
<a name="l01832"></a>01832    <span class="comment">//time_t variables used to calculate the total simulation time</span>
<a name="l01833"></a>01833    <span class="comment">//the start time of simulation is hold by the global variable g_simulation_starttime</span>
<a name="l01834"></a>01834    <span class="comment">//g_simulation_starttime is initilized by gpgpu_ptx_sim_init_perf() in gpgpusim_entrypoint.cc upon starting gpgpu-sim</span>
<a name="l01835"></a>01835    time_t end_time, elapsed_time, days, hrs, minutes, sec;
<a name="l01836"></a>01836    end_time = time((time_t *)NULL);
<a name="l01837"></a>01837    elapsed_time = MAX(end_time - <a class="code" href="gpgpusim__entrypoint_8cc.html#a6cd396c2f4082d9f8951840b9b2604fc">g_simulation_starttime</a>, 1);
<a name="l01838"></a>01838     
<a name="l01839"></a>01839 
<a name="l01840"></a>01840    <span class="comment">//calculating and printing simulation time in terms of days, hours, minutes and seconds</span>
<a name="l01841"></a>01841    days    = elapsed_time/(3600*24);
<a name="l01842"></a>01842    hrs     = elapsed_time/3600 - 24*days;
<a name="l01843"></a>01843    minutes = elapsed_time/60 - 60*(hrs + 24*days);
<a name="l01844"></a>01844    sec = elapsed_time - 60*(minutes + 60*(hrs + 24*days));
<a name="l01845"></a>01845 
<a name="l01846"></a>01846    fflush(stderr);
<a name="l01847"></a>01847    printf(<span class="stringliteral">&quot;\n\ngpgpu_simulation_time = %u days, %u hrs, %u min, %u sec (%u sec)\n&quot;</span>,
<a name="l01848"></a>01848           (<span class="keywordtype">unsigned</span>)days, (<span class="keywordtype">unsigned</span>)hrs, (<span class="keywordtype">unsigned</span>)minutes, (<span class="keywordtype">unsigned</span>)sec, (<span class="keywordtype">unsigned</span>)elapsed_time );
<a name="l01849"></a>01849    printf(<span class="stringliteral">&quot;gpgpu_simulation_rate = %u (inst/sec)\n&quot;</span>, (<span class="keywordtype">unsigned</span>)(<a class="code" href="cuda-sim_8cc.html#a0cb22097f81b6f855ab91169a88ac624">g_ptx_sim_num_insn</a> / elapsed_time) );
<a name="l01850"></a>01850    fflush(stdout); 
<a name="l01851"></a>01851 }
<a name="l01852"></a>01852 
<a name="l01853"></a><a class="code" href="classfunctionalCoreSim.html#aae03d4b072fe3595210c8a2ad18c8ad6">01853</a> <span class="keywordtype">void</span> <a class="code" href="classfunctionalCoreSim.html#aae03d4b072fe3595210c8a2ad18c8ad6">functionalCoreSim::initializeCTA</a>()
<a name="l01854"></a>01854 {
<a name="l01855"></a>01855     <span class="keywordtype">int</span> ctaLiveThreads=0;
<a name="l01856"></a>01856     
<a name="l01857"></a>01857     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="rng-double_8c.html#aa42a9a9cb6e2b93d7f825c395af871bf">i</a>=0; <a class="code" href="rng-double_8c.html#aa42a9a9cb6e2b93d7f825c395af871bf">i</a>&lt; <a class="code" href="classcore__t.html#a6c35c5fc2bfa8ed3096db834e6b305fb">m_warp_count</a>; <a class="code" href="rng-double_8c.html#aa42a9a9cb6e2b93d7f825c395af871bf">i</a>++){
<a name="l01858"></a>01858         <a class="code" href="classfunctionalCoreSim.html#ab8e315e299e8575a2aec3362a6d09c63">m_warpAtBarrier</a>[<a class="code" href="rng-double_8c.html#aa42a9a9cb6e2b93d7f825c395af871bf">i</a>]=<span class="keyword">false</span>;
<a name="l01859"></a>01859         <a class="code" href="classfunctionalCoreSim.html#a4565aeaf1d79874098d3b75f2707b9a3">m_liveThreadCount</a>[<a class="code" href="rng-double_8c.html#aa42a9a9cb6e2b93d7f825c395af871bf">i</a>]=0;
<a name="l01860"></a>01860     }
<a name="l01861"></a>01861     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="rng-double_8c.html#aa42a9a9cb6e2b93d7f825c395af871bf">i</a>=0; <a class="code" href="rng-double_8c.html#aa42a9a9cb6e2b93d7f825c395af871bf">i</a>&lt; m_warp_count*<a class="code" href="classcore__t.html#a65e8ba0d59364d180c6f3ca49d840229">m_warp_size</a>;<a class="code" href="rng-double_8c.html#aa42a9a9cb6e2b93d7f825c395af871bf">i</a>++)
<a name="l01862"></a>01862         <a class="code" href="classcore__t.html#a74ac58fba7a6ecd53ba31705ba5c38cd">m_thread</a>[<a class="code" href="rng-double_8c.html#aa42a9a9cb6e2b93d7f825c395af871bf">i</a>]=NULL;
<a name="l01863"></a>01863     
<a name="l01864"></a>01864     <span class="comment">//get threads for a cta</span>
<a name="l01865"></a>01865     <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <a class="code" href="rng-double_8c.html#aa42a9a9cb6e2b93d7f825c395af871bf">i</a>=0; <a class="code" href="rng-double_8c.html#aa42a9a9cb6e2b93d7f825c395af871bf">i</a>&lt;<a class="code" href="classcore__t.html#a598c5ea555cb4d6f4b3c1253bf87425b">m_kernel</a>-&gt;<a class="code" href="classkernel__info__t.html#a7764459a63b3dd279dfb07576a1dc718">threads_per_cta</a>();<a class="code" href="rng-double_8c.html#aa42a9a9cb6e2b93d7f825c395af871bf">i</a>++) {
<a name="l01866"></a>01866         <a class="code" href="cuda-sim_8cc.html#a814facf1e22372309b98fe8d820a6e75">ptx_sim_init_thread</a>(*<a class="code" href="classcore__t.html#a598c5ea555cb4d6f4b3c1253bf87425b">m_kernel</a>,&amp;<a class="code" href="classcore__t.html#a74ac58fba7a6ecd53ba31705ba5c38cd">m_thread</a>[<a class="code" href="rng-double_8c.html#aa42a9a9cb6e2b93d7f825c395af871bf">i</a>],0,i,<a class="code" href="classcore__t.html#a598c5ea555cb4d6f4b3c1253bf87425b">m_kernel</a>-&gt;<a class="code" href="classkernel__info__t.html#a7764459a63b3dd279dfb07576a1dc718">threads_per_cta</a>()-i,<a class="code" href="classcore__t.html#a598c5ea555cb4d6f4b3c1253bf87425b">m_kernel</a>-&gt;<a class="code" href="classkernel__info__t.html#a7764459a63b3dd279dfb07576a1dc718">threads_per_cta</a>(),<span class="keyword">this</span>,0,i/m_warp_size,(<a class="code" href="classgpgpu__t.html">gpgpu_t</a>*)<a class="code" href="classcore__t.html#a8c9d8ee79e128de6729806cdfa2c5301">m_gpu</a>, <span class="keyword">true</span>);
<a name="l01867"></a>01867         assert(<a class="code" href="classcore__t.html#a74ac58fba7a6ecd53ba31705ba5c38cd">m_thread</a>[i]!=NULL &amp;&amp; !<a class="code" href="classcore__t.html#a74ac58fba7a6ecd53ba31705ba5c38cd">m_thread</a>[i]-&gt;is_done());
<a name="l01868"></a>01868         ctaLiveThreads++;
<a name="l01869"></a>01869     }
<a name="l01870"></a>01870     
<a name="l01871"></a>01871     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> k=0;k&lt;m_warp_count;k++)
<a name="l01872"></a>01872         <a class="code" href="classfunctionalCoreSim.html#adfaa6cd4cb362f888d66659cacdbf091">createWarp</a>(k);
<a name="l01873"></a>01873 }
<a name="l01874"></a>01874 
<a name="l01875"></a><a class="code" href="classfunctionalCoreSim.html#adfaa6cd4cb362f888d66659cacdbf091">01875</a> <span class="keywordtype">void</span>  <a class="code" href="classfunctionalCoreSim.html#adfaa6cd4cb362f888d66659cacdbf091">functionalCoreSim::createWarp</a>(<span class="keywordtype">unsigned</span> warpId)
<a name="l01876"></a>01876 {
<a name="l01877"></a>01877    <a class="code" href="abstract__hardware__model_8h.html#a72368cab3b31c68552473dbc5f4bd1bf">simt_mask_t</a> initialMask;
<a name="l01878"></a>01878    <span class="keywordtype">unsigned</span> liveThreadsCount=0;
<a name="l01879"></a>01879    initialMask.set();
<a name="l01880"></a>01880     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="rng-double_8c.html#aa42a9a9cb6e2b93d7f825c395af871bf">i</a>=warpId*<a class="code" href="classcore__t.html#a65e8ba0d59364d180c6f3ca49d840229">m_warp_size</a>; <a class="code" href="rng-double_8c.html#aa42a9a9cb6e2b93d7f825c395af871bf">i</a>&lt;warpId*<a class="code" href="classcore__t.html#a65e8ba0d59364d180c6f3ca49d840229">m_warp_size</a>+<a class="code" href="classcore__t.html#a65e8ba0d59364d180c6f3ca49d840229">m_warp_size</a>;<a class="code" href="rng-double_8c.html#aa42a9a9cb6e2b93d7f825c395af871bf">i</a>++){
<a name="l01881"></a>01881         <span class="keywordflow">if</span>(<a class="code" href="classcore__t.html#a74ac58fba7a6ecd53ba31705ba5c38cd">m_thread</a>[<a class="code" href="rng-double_8c.html#aa42a9a9cb6e2b93d7f825c395af871bf">i</a>]==NULL) initialMask.reset(<a class="code" href="rng-double_8c.html#aa42a9a9cb6e2b93d7f825c395af871bf">i</a>-warpId*m_warp_size);
<a name="l01882"></a>01882         <span class="keywordflow">else</span> liveThreadsCount++;
<a name="l01883"></a>01883     }   
<a name="l01884"></a>01884    
<a name="l01885"></a>01885    assert(<a class="code" href="classcore__t.html#a74ac58fba7a6ecd53ba31705ba5c38cd">m_thread</a>[warpId*m_warp_size]!=NULL);
<a name="l01886"></a>01886    <a class="code" href="classcore__t.html#abc85a3fb05c778cd6c06c95863a47ed6">m_simt_stack</a>[warpId]-&gt;<a class="code" href="classsimt__stack.html#a325140cfa69adf965d360790aa3412b9">launch</a>(<a class="code" href="classcore__t.html#a74ac58fba7a6ecd53ba31705ba5c38cd">m_thread</a>[warpId*m_warp_size]-&gt;get_pc(),initialMask);
<a name="l01887"></a>01887    <a class="code" href="classfunctionalCoreSim.html#a4565aeaf1d79874098d3b75f2707b9a3">m_liveThreadCount</a>[warpId]= liveThreadsCount;
<a name="l01888"></a>01888 }
<a name="l01889"></a>01889 
<a name="l01890"></a><a class="code" href="classfunctionalCoreSim.html#a1b786ca5c6296dae17adfeff24ec38cf">01890</a> <span class="keywordtype">void</span> <a class="code" href="classfunctionalCoreSim.html#a1b786ca5c6296dae17adfeff24ec38cf" title="executes all warps till completion">functionalCoreSim::execute</a>()
<a name="l01891"></a>01891  {
<a name="l01892"></a>01892     <a class="code" href="classfunctionalCoreSim.html#aae03d4b072fe3595210c8a2ad18c8ad6">initializeCTA</a>();
<a name="l01893"></a>01893     
<a name="l01894"></a>01894     <span class="comment">//start executing the CTA</span>
<a name="l01895"></a>01895     <span class="keywordflow">while</span>(<span class="keyword">true</span>){
<a name="l01896"></a>01896         <span class="keywordtype">bool</span> someOneLive= <span class="keyword">false</span>;
<a name="l01897"></a>01897         <span class="keywordtype">bool</span> allAtBarrier = <span class="keyword">true</span>;
<a name="l01898"></a>01898         <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <a class="code" href="rng-double_8c.html#aa42a9a9cb6e2b93d7f825c395af871bf">i</a>=0;<a class="code" href="rng-double_8c.html#aa42a9a9cb6e2b93d7f825c395af871bf">i</a>&lt;<a class="code" href="classcore__t.html#a6c35c5fc2bfa8ed3096db834e6b305fb">m_warp_count</a>;<a class="code" href="rng-double_8c.html#aa42a9a9cb6e2b93d7f825c395af871bf">i</a>++){
<a name="l01899"></a>01899             <a class="code" href="classfunctionalCoreSim.html#a7c8610b3717ada0e1844032bcb50d54f">executeWarp</a>(<a class="code" href="rng-double_8c.html#aa42a9a9cb6e2b93d7f825c395af871bf">i</a>,allAtBarrier,someOneLive);
<a name="l01900"></a>01900         }
<a name="l01901"></a>01901         <span class="keywordflow">if</span>(!someOneLive) <span class="keywordflow">break</span>;
<a name="l01902"></a>01902         <span class="keywordflow">if</span>(allAtBarrier){
<a name="l01903"></a>01903              <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <a class="code" href="rng-double_8c.html#aa42a9a9cb6e2b93d7f825c395af871bf">i</a>=0;<a class="code" href="rng-double_8c.html#aa42a9a9cb6e2b93d7f825c395af871bf">i</a>&lt;m_warp_count;<a class="code" href="rng-double_8c.html#aa42a9a9cb6e2b93d7f825c395af871bf">i</a>++)
<a name="l01904"></a>01904                  <a class="code" href="classfunctionalCoreSim.html#ab8e315e299e8575a2aec3362a6d09c63">m_warpAtBarrier</a>[<a class="code" href="rng-double_8c.html#aa42a9a9cb6e2b93d7f825c395af871bf">i</a>]=<span class="keyword">false</span>;
<a name="l01905"></a>01905         }
<a name="l01906"></a>01906     }
<a name="l01907"></a>01907  }
<a name="l01908"></a>01908 
<a name="l01909"></a><a class="code" href="classfunctionalCoreSim.html#a7c8610b3717ada0e1844032bcb50d54f">01909</a> <span class="keywordtype">void</span> <a class="code" href="classfunctionalCoreSim.html#a7c8610b3717ada0e1844032bcb50d54f">functionalCoreSim::executeWarp</a>(<span class="keywordtype">unsigned</span> <a class="code" href="rng-double_8c.html#aa42a9a9cb6e2b93d7f825c395af871bf">i</a>, <span class="keywordtype">bool</span> &amp;allAtBarrier, <span class="keywordtype">bool</span> &amp; someOneLive)
<a name="l01910"></a>01910 {
<a name="l01911"></a>01911     <span class="keywordflow">if</span>(!<a class="code" href="classfunctionalCoreSim.html#ab8e315e299e8575a2aec3362a6d09c63">m_warpAtBarrier</a>[i] &amp;&amp; <a class="code" href="classfunctionalCoreSim.html#a4565aeaf1d79874098d3b75f2707b9a3">m_liveThreadCount</a>[i]!=0){
<a name="l01912"></a>01912         <a class="code" href="classwarp__inst__t.html">warp_inst_t</a> inst =<a class="code" href="classcore__t.html#a43d4407b2123d779eab151bd348d340b" title="Get the warp to be executed using the data taken form the SIMT stack.">getExecuteWarp</a>(i);
<a name="l01913"></a>01913         <a class="code" href="classcore__t.html#a19a45810ebc463b29ecffaf9024a58f3">execute_warp_inst_t</a>(inst,i);
<a name="l01914"></a>01914         <span class="keywordflow">if</span>(inst.<a class="code" href="classwarp__inst__t.html#ad5046e7f41d1188cf9428d160b3ead73">isatomic</a>()) inst.<a class="code" href="classwarp__inst__t.html#a4975bed2e5b0ce4805738b89497bc1fc">do_atomic</a>(<span class="keyword">true</span>);
<a name="l01915"></a>01915         <span class="keywordflow">if</span>(inst.<a class="code" href="classinst__t.html#a5e7e56fb753710a255876d382fda08c3">op</a>==<a class="code" href="abstract__hardware__model_8h.html#a35b8f4223626361f0e0cb24d0c0b0f4ca998c92693120b6eb67f03e3c9590ed29">BARRIER_OP</a> || inst.<a class="code" href="classinst__t.html#a5e7e56fb753710a255876d382fda08c3">op</a>==<a class="code" href="abstract__hardware__model_8h.html#a35b8f4223626361f0e0cb24d0c0b0f4cadaf34556ed6315ab53fe011adebe70c9">MEMORY_BARRIER_OP</a> ) <a class="code" href="classfunctionalCoreSim.html#ab8e315e299e8575a2aec3362a6d09c63">m_warpAtBarrier</a>[i]=<span class="keyword">true</span>;
<a name="l01916"></a>01916         <a class="code" href="classcore__t.html#aa11c9f449e913436ec99099c1a650424">updateSIMTStack</a>( i, &amp;inst );
<a name="l01917"></a>01917     }
<a name="l01918"></a>01918     <span class="keywordflow">if</span>(<a class="code" href="classfunctionalCoreSim.html#a4565aeaf1d79874098d3b75f2707b9a3">m_liveThreadCount</a>[i]&gt;0) someOneLive=<span class="keyword">true</span>;
<a name="l01919"></a>01919     <span class="keywordflow">if</span>(!<a class="code" href="classfunctionalCoreSim.html#ab8e315e299e8575a2aec3362a6d09c63">m_warpAtBarrier</a>[i]&amp;&amp; <a class="code" href="classfunctionalCoreSim.html#a4565aeaf1d79874098d3b75f2707b9a3">m_liveThreadCount</a>[i]&gt;0) allAtBarrier = <span class="keyword">false</span>;
<a name="l01920"></a>01920 }
<a name="l01921"></a>01921 
<a name="l01922"></a><a class="code" href="stat-tool_8cc.html#a872e07ff59ffd42b6037aa8c359057cc">01922</a> <span class="keywordtype">unsigned</span> <a class="code" href="cuda-sim_8cc.html#a872e07ff59ffd42b6037aa8c359057cc">translate_pc_to_ptxlineno</a>(<span class="keywordtype">unsigned</span> pc)
<a name="l01923"></a>01923 {
<a name="l01924"></a>01924    <span class="comment">// this function assumes that the kernel fits inside a single PTX file</span>
<a name="l01925"></a>01925    <span class="comment">// function_info *pFunc = g_func_info; // assume that the current kernel is the one in query</span>
<a name="l01926"></a>01926    <span class="keyword">const</span> <a class="code" href="classptx__instruction.html">ptx_instruction</a> *pInsn = <a class="code" href="classfunction__info.html#a9e106da799e9605e321e06e05cc6df55">function_info::pc_to_instruction</a>(pc);
<a name="l01927"></a>01927    <span class="keywordtype">unsigned</span> ptx_line_number = pInsn-&gt;<a class="code" href="classptx__instruction.html#aa7417e4758e1dfc4fb5a92030071a040">source_line</a>();
<a name="l01928"></a>01928 
<a name="l01929"></a>01929    <span class="keywordflow">return</span> ptx_line_number;
<a name="l01930"></a>01930 }
<a name="l01931"></a>01931 
<a name="l01932"></a>01932 <span class="comment">// ptxinfo parser</span>
<a name="l01933"></a>01933 
<a name="l01934"></a>01934 <span class="keyword">extern</span> std::map&lt;unsigned,const char*&gt; <a class="code" href="cuda-sim_8cc.html#a0a5b22c3ed157551782e3a52674ad1c0">get_duplicate</a>();
<a name="l01935"></a>01935 
<a name="l01936"></a><a class="code" href="cuda-sim_8cc.html#ab0886f9909fb09bc6f3f2ef78a1731f2">01936</a> <span class="keywordtype">int</span> <a class="code" href="cuda-sim_8cc.html#ab0886f9909fb09bc6f3f2ef78a1731f2">g_ptxinfo_error_detected</a>;
<a name="l01937"></a>01937 
<a name="l01938"></a><a class="code" href="cuda-sim_8cc.html#a0c90191bf63459f00bfcbc58ccfcfe2a">01938</a> <span class="keyword">static</span> <span class="keywordtype">char</span> *<a class="code" href="cuda-sim_8cc.html#a0c90191bf63459f00bfcbc58ccfcfe2a">g_ptxinfo_kname</a> = NULL;
<a name="l01939"></a><a class="code" href="cuda-sim_8cc.html#accb7be773b95e81fd32c2e5273eecf83">01939</a> <span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="structgpgpu__ptx__sim__info.html">gpgpu_ptx_sim_info</a> <a class="code" href="cuda-sim_8cc.html#accb7be773b95e81fd32c2e5273eecf83">g_ptxinfo</a>;
<a name="l01940"></a><a class="code" href="cuda-sim_8cc.html#a351df2eee03455ce2304bea7ddbfaab9">01940</a> <span class="keyword">static</span> std::map&lt;unsigned,const char*&gt; <a class="code" href="cuda-sim_8cc.html#a351df2eee03455ce2304bea7ddbfaab9">g_duplicate</a>;
<a name="l01941"></a><a class="code" href="cuda-sim_8cc.html#a9e7ea8ca5e9fcab39c7d5bf26350bfc0">01941</a> <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="cuda-sim_8cc.html#a9e7ea8ca5e9fcab39c7d5bf26350bfc0">g_last_dup_type</a>;
<a name="l01942"></a>01942 
<a name="l01943"></a><a class="code" href="cuda-sim_8h.html#aabcf685ce740c263add961f839921be5">01943</a> <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="cuda-sim_8cc.html#aabcf685ce740c263add961f839921be5">get_ptxinfo_kname</a>() 
<a name="l01944"></a>01944 { 
<a name="l01945"></a>01945     <span class="keywordflow">return</span> <a class="code" href="cuda-sim_8cc.html#a0c90191bf63459f00bfcbc58ccfcfe2a">g_ptxinfo_kname</a>; 
<a name="l01946"></a>01946 }
<a name="l01947"></a>01947 
<a name="l01948"></a><a class="code" href="cuda-sim_8h.html#a9b34b45404555d3b694c01c3b73a9f6b">01948</a> <span class="keywordtype">void</span> <a class="code" href="cuda-sim_8cc.html#a9b34b45404555d3b694c01c3b73a9f6b">print_ptxinfo</a>()
<a name="l01949"></a>01949 {
<a name="l01950"></a>01950     <span class="keywordflow">if</span>(! <a class="code" href="cuda-sim_8cc.html#aabcf685ce740c263add961f839921be5">get_ptxinfo_kname</a>()){
<a name="l01951"></a>01951         printf (<span class="stringliteral">&quot;GPGPU-Sim PTX: Binary info : gmem=%u, cmem=%u\n&quot;</span>,
<a name="l01952"></a>01952                 <a class="code" href="cuda-sim_8cc.html#accb7be773b95e81fd32c2e5273eecf83">g_ptxinfo</a>.<a class="code" href="structgpgpu__ptx__sim__info.html#a4715322136c08b526809da8ff1ff93dd">gmem</a>,
<a name="l01953"></a>01953                 <a class="code" href="cuda-sim_8cc.html#accb7be773b95e81fd32c2e5273eecf83">g_ptxinfo</a>.<a class="code" href="structgpgpu__ptx__sim__info.html#a8c82fe05a8be12a26a9474de63c78404">cmem</a>);
<a name="l01954"></a>01954     }
<a name="l01955"></a>01955     <span class="keywordflow">if</span>(<a class="code" href="cuda-sim_8cc.html#aabcf685ce740c263add961f839921be5">get_ptxinfo_kname</a>()){
<a name="l01956"></a>01956         printf (<span class="stringliteral">&quot;GPGPU-Sim PTX: Kernel \&apos;%s\&apos; : regs=%u, lmem=%u, smem=%u, cmem=%u\n&quot;</span>,
<a name="l01957"></a>01957                 <a class="code" href="cuda-sim_8cc.html#aabcf685ce740c263add961f839921be5">get_ptxinfo_kname</a>(),
<a name="l01958"></a>01958                 <a class="code" href="cuda-sim_8cc.html#accb7be773b95e81fd32c2e5273eecf83">g_ptxinfo</a>.<a class="code" href="structgpgpu__ptx__sim__info.html#ad0b5123f55f49a4ff5c7586352a228d4">regs</a>,
<a name="l01959"></a>01959                 <a class="code" href="cuda-sim_8cc.html#accb7be773b95e81fd32c2e5273eecf83">g_ptxinfo</a>.<a class="code" href="structgpgpu__ptx__sim__info.html#a833762bfee32ccafdd399f41e28d9d6a">lmem</a>,
<a name="l01960"></a>01960                 <a class="code" href="cuda-sim_8cc.html#accb7be773b95e81fd32c2e5273eecf83">g_ptxinfo</a>.<a class="code" href="structgpgpu__ptx__sim__info.html#a8001a5704514c6fe6ea4a6663d7e93a6">smem</a>,
<a name="l01961"></a>01961                 <a class="code" href="cuda-sim_8cc.html#accb7be773b95e81fd32c2e5273eecf83">g_ptxinfo</a>.<a class="code" href="structgpgpu__ptx__sim__info.html#a8c82fe05a8be12a26a9474de63c78404">cmem</a> );
<a name="l01962"></a>01962     }
<a name="l01963"></a>01963 }
<a name="l01964"></a>01964 
<a name="l01965"></a>01965 
<a name="l01966"></a><a class="code" href="cuda-sim_8h.html#ac0a38d1bcd367afc3181f91e4dd9d78e">01966</a> <span class="keyword">struct </span><a class="code" href="structgpgpu__ptx__sim__info.html">gpgpu_ptx_sim_info</a> <a class="code" href="cuda-sim_8cc.html#ac0a38d1bcd367afc3181f91e4dd9d78e">get_ptxinfo</a>()
<a name="l01967"></a>01967 {
<a name="l01968"></a>01968     <span class="keywordflow">return</span> <a class="code" href="cuda-sim_8cc.html#accb7be773b95e81fd32c2e5273eecf83">g_ptxinfo</a>;
<a name="l01969"></a>01969 }
<a name="l01970"></a>01970 
<a name="l01971"></a><a class="code" href="ptx__loader_8cc.html#a6fb8c107192ee5b167e0ee0d28268528">01971</a> std::map&lt;unsigned,const char*&gt; <a class="code" href="cuda-sim_8cc.html#a0a5b22c3ed157551782e3a52674ad1c0">get_duplicate</a>()
<a name="l01972"></a>01972 {
<a name="l01973"></a>01973     <span class="keywordflow">return</span> <a class="code" href="cuda-sim_8cc.html#a351df2eee03455ce2304bea7ddbfaab9">g_duplicate</a>;
<a name="l01974"></a>01974 }
<a name="l01975"></a>01975 
<a name="l01976"></a><a class="code" href="cuda-sim_8cc.html#a41f82964c9218558b403034f48732f0d">01976</a> <span class="keywordtype">void</span> <a class="code" href="cuda-sim_8cc.html#a41f82964c9218558b403034f48732f0d">ptxinfo_linenum</a>( <span class="keywordtype">unsigned</span> linenum )
<a name="l01977"></a>01977 {
<a name="l01978"></a>01978     <a class="code" href="cuda-sim_8cc.html#a351df2eee03455ce2304bea7ddbfaab9">g_duplicate</a>[linenum] = <a class="code" href="cuda-sim_8cc.html#a9e7ea8ca5e9fcab39c7d5bf26350bfc0">g_last_dup_type</a>;
<a name="l01979"></a>01979 }
<a name="l01980"></a>01980 
<a name="l01981"></a><a class="code" href="cuda-sim_8cc.html#aa735013c15e89a53c77133e027d495a5">01981</a> <span class="keywordtype">void</span> <a class="code" href="cuda-sim_8cc.html#aa735013c15e89a53c77133e027d495a5">ptxinfo_dup_type</a>( <span class="keyword">const</span> <span class="keywordtype">char</span> *dup_type )
<a name="l01982"></a>01982 {
<a name="l01983"></a>01983     <a class="code" href="cuda-sim_8cc.html#a9e7ea8ca5e9fcab39c7d5bf26350bfc0">g_last_dup_type</a> = dup_type;
<a name="l01984"></a>01984 }
<a name="l01985"></a>01985 
<a name="l01986"></a><a class="code" href="cuda-sim_8cc.html#a26d866b43c5b8268c1b701e92d642f8e">01986</a> <span class="keywordtype">void</span> <a class="code" href="cuda-sim_8cc.html#a26d866b43c5b8268c1b701e92d642f8e">ptxinfo_function</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *fname )
<a name="l01987"></a>01987 {
<a name="l01988"></a>01988     <a class="code" href="cuda-sim_8cc.html#a3a281ccf09efba2b5263f19ecfd0c365">clear_ptxinfo</a>();
<a name="l01989"></a>01989     <a class="code" href="cuda-sim_8cc.html#a0c90191bf63459f00bfcbc58ccfcfe2a">g_ptxinfo_kname</a> = strdup(fname);
<a name="l01990"></a>01990 }
<a name="l01991"></a>01991 
<a name="l01992"></a><a class="code" href="cuda-sim_8cc.html#afb0f2551d130974e09cbff20c4821aec">01992</a> <span class="keywordtype">void</span> <a class="code" href="cuda-sim_8cc.html#afb0f2551d130974e09cbff20c4821aec">ptxinfo_regs</a>( <span class="keywordtype">unsigned</span> nregs )
<a name="l01993"></a>01993 {
<a name="l01994"></a>01994     <a class="code" href="cuda-sim_8cc.html#accb7be773b95e81fd32c2e5273eecf83">g_ptxinfo</a>.<a class="code" href="structgpgpu__ptx__sim__info.html#ad0b5123f55f49a4ff5c7586352a228d4">regs</a>=nregs;
<a name="l01995"></a>01995 }
<a name="l01996"></a>01996 
<a name="l01997"></a><a class="code" href="cuda-sim_8cc.html#ab41631c3fe6dd093f089877ddea381ce">01997</a> <span class="keywordtype">void</span> <a class="code" href="cuda-sim_8cc.html#ab41631c3fe6dd093f089877ddea381ce">ptxinfo_lmem</a>( <span class="keywordtype">unsigned</span> declared, <span class="keywordtype">unsigned</span> system )
<a name="l01998"></a>01998 {
<a name="l01999"></a>01999     <a class="code" href="cuda-sim_8cc.html#accb7be773b95e81fd32c2e5273eecf83">g_ptxinfo</a>.<a class="code" href="structgpgpu__ptx__sim__info.html#a833762bfee32ccafdd399f41e28d9d6a">lmem</a>=declared+system;
<a name="l02000"></a>02000 }
<a name="l02001"></a>02001 
<a name="l02002"></a><a class="code" href="cuda-sim_8cc.html#a522ca98799b6b029191b53d752fc5ce0">02002</a> <span class="keywordtype">void</span> <a class="code" href="cuda-sim_8cc.html#a522ca98799b6b029191b53d752fc5ce0">ptxinfo_gmem</a>( <span class="keywordtype">unsigned</span> declared, <span class="keywordtype">unsigned</span> system )
<a name="l02003"></a>02003 {
<a name="l02004"></a>02004     <a class="code" href="cuda-sim_8cc.html#accb7be773b95e81fd32c2e5273eecf83">g_ptxinfo</a>.<a class="code" href="structgpgpu__ptx__sim__info.html#a4715322136c08b526809da8ff1ff93dd">gmem</a>=declared+system;
<a name="l02005"></a>02005 }
<a name="l02006"></a>02006 
<a name="l02007"></a><a class="code" href="cuda-sim_8cc.html#ae418c8577fc0484fbc2a8549a8f926b0">02007</a> <span class="keywordtype">void</span> <a class="code" href="cuda-sim_8cc.html#ae418c8577fc0484fbc2a8549a8f926b0">ptxinfo_smem</a>( <span class="keywordtype">unsigned</span> declared, <span class="keywordtype">unsigned</span> system )
<a name="l02008"></a>02008 {
<a name="l02009"></a>02009     <a class="code" href="cuda-sim_8cc.html#accb7be773b95e81fd32c2e5273eecf83">g_ptxinfo</a>.<a class="code" href="structgpgpu__ptx__sim__info.html#a8001a5704514c6fe6ea4a6663d7e93a6">smem</a>=declared+system;
<a name="l02010"></a>02010 }
<a name="l02011"></a>02011 
<a name="l02012"></a><a class="code" href="cuda-sim_8cc.html#a3eabef2b0d3add3dd83a683fbed959c6">02012</a> <span class="keywordtype">void</span> <a class="code" href="cuda-sim_8cc.html#a3eabef2b0d3add3dd83a683fbed959c6">ptxinfo_cmem</a>( <span class="keywordtype">unsigned</span> nbytes, <span class="keywordtype">unsigned</span> bank )
<a name="l02013"></a>02013 {
<a name="l02014"></a>02014     <a class="code" href="cuda-sim_8cc.html#accb7be773b95e81fd32c2e5273eecf83">g_ptxinfo</a>.<a class="code" href="structgpgpu__ptx__sim__info.html#a8c82fe05a8be12a26a9474de63c78404">cmem</a>+=nbytes;
<a name="l02015"></a>02015 }
<a name="l02016"></a>02016 
<a name="l02017"></a><a class="code" href="cuda-sim_8h.html#a3a281ccf09efba2b5263f19ecfd0c365">02017</a> <span class="keywordtype">void</span> <a class="code" href="cuda-sim_8cc.html#a3a281ccf09efba2b5263f19ecfd0c365">clear_ptxinfo</a>()
<a name="l02018"></a>02018 {
<a name="l02019"></a>02019     free(<a class="code" href="cuda-sim_8cc.html#a0c90191bf63459f00bfcbc58ccfcfe2a">g_ptxinfo_kname</a>);
<a name="l02020"></a>02020     <a class="code" href="cuda-sim_8cc.html#a0c90191bf63459f00bfcbc58ccfcfe2a">g_ptxinfo_kname</a>=NULL;
<a name="l02021"></a>02021     <a class="code" href="cuda-sim_8cc.html#accb7be773b95e81fd32c2e5273eecf83">g_ptxinfo</a>.<a class="code" href="structgpgpu__ptx__sim__info.html#ad0b5123f55f49a4ff5c7586352a228d4">regs</a>=0;
<a name="l02022"></a>02022     <a class="code" href="cuda-sim_8cc.html#accb7be773b95e81fd32c2e5273eecf83">g_ptxinfo</a>.<a class="code" href="structgpgpu__ptx__sim__info.html#a833762bfee32ccafdd399f41e28d9d6a">lmem</a>=0;
<a name="l02023"></a>02023     <a class="code" href="cuda-sim_8cc.html#accb7be773b95e81fd32c2e5273eecf83">g_ptxinfo</a>.<a class="code" href="structgpgpu__ptx__sim__info.html#a8001a5704514c6fe6ea4a6663d7e93a6">smem</a>=0;
<a name="l02024"></a>02024     <a class="code" href="cuda-sim_8cc.html#accb7be773b95e81fd32c2e5273eecf83">g_ptxinfo</a>.<a class="code" href="structgpgpu__ptx__sim__info.html#a8c82fe05a8be12a26a9474de63c78404">cmem</a>=0;
<a name="l02025"></a>02025     <a class="code" href="cuda-sim_8cc.html#accb7be773b95e81fd32c2e5273eecf83">g_ptxinfo</a>.<a class="code" href="structgpgpu__ptx__sim__info.html#a4715322136c08b526809da8ff1ff93dd">gmem</a>=0;
<a name="l02026"></a>02026     <a class="code" href="cuda-sim_8cc.html#accb7be773b95e81fd32c2e5273eecf83">g_ptxinfo</a>.<a class="code" href="structgpgpu__ptx__sim__info.html#afcb1d9254c815b77fb9f739d6594a90a">ptx_version</a>=0;
<a name="l02027"></a>02027     <a class="code" href="cuda-sim_8cc.html#accb7be773b95e81fd32c2e5273eecf83">g_ptxinfo</a>.<a class="code" href="structgpgpu__ptx__sim__info.html#a2e969efa735bc3e342307277dfe8d5e9">sm_target</a>=0;
<a name="l02028"></a>02028 }
<a name="l02029"></a>02029 
<a name="l02030"></a>02030 
<a name="l02031"></a><a class="code" href="cuda-sim_8h.html#a465b15ddb00d0bcf9d9df5e124c1c690">02031</a> <span class="keywordtype">void</span> <a class="code" href="cuda-sim_8cc.html#a465b15ddb00d0bcf9d9df5e124c1c690">ptxinfo_opencl_addinfo</a>( std::map&lt;std::string,function_info*&gt; &amp;kernels )
<a name="l02032"></a>02032 {
<a name="l02033"></a>02033 
<a name="l02034"></a>02034    <span class="keywordflow">if</span>(! <a class="code" href="cuda-sim_8cc.html#a0c90191bf63459f00bfcbc58ccfcfe2a">g_ptxinfo_kname</a>) {
<a name="l02035"></a>02035       printf (<span class="stringliteral">&quot;GPGPU-Sim PTX: Binary info : gmem=%u, cmem=%u\n&quot;</span>,
<a name="l02036"></a>02036               <a class="code" href="cuda-sim_8cc.html#accb7be773b95e81fd32c2e5273eecf83">g_ptxinfo</a>.<a class="code" href="structgpgpu__ptx__sim__info.html#a4715322136c08b526809da8ff1ff93dd">gmem</a>,
<a name="l02037"></a>02037               <a class="code" href="cuda-sim_8cc.html#accb7be773b95e81fd32c2e5273eecf83">g_ptxinfo</a>.<a class="code" href="structgpgpu__ptx__sim__info.html#a8c82fe05a8be12a26a9474de63c78404">cmem</a>);
<a name="l02038"></a>02038       <a class="code" href="cuda-sim_8cc.html#a3a281ccf09efba2b5263f19ecfd0c365">clear_ptxinfo</a>();
<a name="l02039"></a>02039       <span class="keywordflow">return</span>;
<a name="l02040"></a>02040    }
<a name="l02041"></a>02041 
<a name="l02042"></a>02042    <span class="keywordflow">if</span>( !strcmp(<span class="stringliteral">&quot;__cuda_dummy_entry__&quot;</span>,<a class="code" href="cuda-sim_8cc.html#a0c90191bf63459f00bfcbc58ccfcfe2a">g_ptxinfo_kname</a>) ) {
<a name="l02043"></a>02043       <span class="comment">// this string produced by ptxas for empty ptx files (e.g., bandwidth test)</span>
<a name="l02044"></a>02044       <a class="code" href="cuda-sim_8cc.html#a3a281ccf09efba2b5263f19ecfd0c365">clear_ptxinfo</a>();
<a name="l02045"></a>02045       <span class="keywordflow">return</span>;
<a name="l02046"></a>02046    }
<a name="l02047"></a>02047    std::map&lt;std::string,function_info*&gt;::iterator k=kernels.find(<a class="code" href="cuda-sim_8cc.html#a0c90191bf63459f00bfcbc58ccfcfe2a">g_ptxinfo_kname</a>);
<a name="l02048"></a>02048    <span class="keywordflow">if</span>( k==kernels.end() ) {
<a name="l02049"></a>02049       printf (<span class="stringliteral">&quot;GPGPU-Sim PTX: ERROR ** implementation for &apos;%s&apos; not found.\n&quot;</span>, <a class="code" href="cuda-sim_8cc.html#a0c90191bf63459f00bfcbc58ccfcfe2a">g_ptxinfo_kname</a> );
<a name="l02050"></a>02050       abort();
<a name="l02051"></a>02051    } <span class="keywordflow">else</span> {
<a name="l02052"></a>02052       printf (<span class="stringliteral">&quot;GPGPU-Sim PTX: Kernel \&apos;%s\&apos; : regs=%u, lmem=%u, smem=%u, cmem=%u\n&quot;</span>, 
<a name="l02053"></a>02053               <a class="code" href="cuda-sim_8cc.html#a0c90191bf63459f00bfcbc58ccfcfe2a">g_ptxinfo_kname</a>,
<a name="l02054"></a>02054               <a class="code" href="cuda-sim_8cc.html#accb7be773b95e81fd32c2e5273eecf83">g_ptxinfo</a>.<a class="code" href="structgpgpu__ptx__sim__info.html#ad0b5123f55f49a4ff5c7586352a228d4">regs</a>,
<a name="l02055"></a>02055               <a class="code" href="cuda-sim_8cc.html#accb7be773b95e81fd32c2e5273eecf83">g_ptxinfo</a>.<a class="code" href="structgpgpu__ptx__sim__info.html#a833762bfee32ccafdd399f41e28d9d6a">lmem</a>,
<a name="l02056"></a>02056               <a class="code" href="cuda-sim_8cc.html#accb7be773b95e81fd32c2e5273eecf83">g_ptxinfo</a>.<a class="code" href="structgpgpu__ptx__sim__info.html#a8001a5704514c6fe6ea4a6663d7e93a6">smem</a>,
<a name="l02057"></a>02057               <a class="code" href="cuda-sim_8cc.html#accb7be773b95e81fd32c2e5273eecf83">g_ptxinfo</a>.<a class="code" href="structgpgpu__ptx__sim__info.html#a8c82fe05a8be12a26a9474de63c78404">cmem</a> );
<a name="l02058"></a>02058       <a class="code" href="classfunction__info.html">function_info</a> *finfo = k-&gt;second;
<a name="l02059"></a>02059       assert(finfo!=NULL);
<a name="l02060"></a>02060       finfo-&gt;<a class="code" href="classfunction__info.html#aeb36345cc156583fc68343710e22e6f4">set_kernel_info</a>( <a class="code" href="cuda-sim_8cc.html#accb7be773b95e81fd32c2e5273eecf83">g_ptxinfo</a> );
<a name="l02061"></a>02061    }
<a name="l02062"></a>02062    <a class="code" href="cuda-sim_8cc.html#a3a281ccf09efba2b5263f19ecfd0c365">clear_ptxinfo</a>();
<a name="l02063"></a>02063 }
<a name="l02064"></a>02064 
<a name="l02065"></a><a class="code" href="structrec__pts.html">02065</a> <span class="keyword">struct </span><a class="code" href="structrec__pts.html">rec_pts</a> {
<a name="l02066"></a><a class="code" href="structrec__pts.html#a0b2a247b5605de7c608194c7af5ebc0b">02066</a>    <a class="code" href="structgpgpu__recon__t.html">gpgpu_recon_t</a> *<a class="code" href="structrec__pts.html#a0b2a247b5605de7c608194c7af5ebc0b">s_kernel_recon_points</a>;
<a name="l02067"></a><a class="code" href="structrec__pts.html#a46e4f2094a8bef91733232e24eedd941">02067</a>    <span class="keywordtype">int</span> <a class="code" href="structrec__pts.html#a46e4f2094a8bef91733232e24eedd941">s_num_recon</a>;
<a name="l02068"></a>02068 };
<a name="l02069"></a>02069 
<a name="l02070"></a><a class="code" href="cuda-sim_8cc.html#aa0d9632ac9bff03ac0ee91e989cb667b">02070</a> <span class="keyword">struct </span>std::map&lt;<a class="code" href="classfunction__info.html">function_info</a>*,<a class="code" href="structrec__pts.html">rec_pts</a>&gt; <a class="code" href="cuda-sim_8cc.html#aa0d9632ac9bff03ac0ee91e989cb667b">g_rpts</a>;
<a name="l02071"></a>02071 
<a name="l02072"></a><a class="code" href="cuda-sim_8cc.html#ac5a36f954a9bdde73d74afa9b52e18b8">02072</a> <span class="keyword">struct </span><a class="code" href="structrec__pts.html">rec_pts</a> <a class="code" href="cuda-sim_8cc.html#ac5a36f954a9bdde73d74afa9b52e18b8">find_reconvergence_points</a>( <a class="code" href="classfunction__info.html">function_info</a> *finfo )
<a name="l02073"></a>02073 {
<a name="l02074"></a>02074    <a class="code" href="structrec__pts.html">rec_pts</a> tmp;
<a name="l02075"></a>02075    std::map&lt;function_info*,rec_pts&gt;::iterator r=<a class="code" href="cuda-sim_8cc.html#aa0d9632ac9bff03ac0ee91e989cb667b">g_rpts</a>.find(finfo);
<a name="l02076"></a>02076  
<a name="l02077"></a>02077    <span class="keywordflow">if</span>( r==<a class="code" href="cuda-sim_8cc.html#aa0d9632ac9bff03ac0ee91e989cb667b">g_rpts</a>.end() ) {
<a name="l02078"></a>02078       <span class="keywordtype">int</span> num_recon = finfo-&gt;get_num_reconvergence_pairs();
<a name="l02079"></a>02079       
<a name="l02080"></a>02080       <a class="code" href="structgpgpu__recon__t.html">gpgpu_recon_t</a> *kernel_recon_points = (<span class="keyword">struct </span><a class="code" href="structgpgpu__recon__t.html">gpgpu_recon_t</a>*) calloc(num_recon, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structgpgpu__recon__t.html">gpgpu_recon_t</a>));
<a name="l02081"></a>02081       finfo-&gt;get_reconvergence_pairs(kernel_recon_points);
<a name="l02082"></a>02082       printf(<span class="stringliteral">&quot;GPGPU-Sim PTX: reconvergence points for %s...\n&quot;</span>, finfo-&gt;get_name().c_str() );
<a name="l02083"></a>02083       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="rng-double_8c.html#aa42a9a9cb6e2b93d7f825c395af871bf">i</a>=0;<a class="code" href="rng-double_8c.html#aa42a9a9cb6e2b93d7f825c395af871bf">i</a>&lt;num_recon;<a class="code" href="rng-double_8c.html#aa42a9a9cb6e2b93d7f825c395af871bf">i</a>++) {
<a name="l02084"></a>02084          printf(<span class="stringliteral">&quot;GPGPU-Sim PTX: %2u (potential) branch divergence @ &quot;</span>, <a class="code" href="rng-double_8c.html#aa42a9a9cb6e2b93d7f825c395af871bf">i</a>+1 );
<a name="l02085"></a>02085          kernel_recon_points[<a class="code" href="rng-double_8c.html#aa42a9a9cb6e2b93d7f825c395af871bf">i</a>].<a class="code" href="structgpgpu__recon__t.html#a878eed1fcc2ee266099fa59a12e86f65">source_inst</a>-&gt;<a class="code" href="classptx__instruction.html#aaf60e39104281c2e8adcae77105710d9">print_insn</a>();
<a name="l02086"></a>02086          printf(<span class="stringliteral">&quot;\n&quot;</span>);
<a name="l02087"></a>02087          printf(<span class="stringliteral">&quot;GPGPU-Sim PTX:    immediate post dominator      @ &quot;</span> ); 
<a name="l02088"></a>02088          <span class="keywordflow">if</span>( kernel_recon_points[<a class="code" href="rng-double_8c.html#aa42a9a9cb6e2b93d7f825c395af871bf">i</a>].<a class="code" href="structgpgpu__recon__t.html#a45e34c95d3bc7ca05742aa2e25b3baa3">target_inst</a> )
<a name="l02089"></a>02089             kernel_recon_points[<a class="code" href="rng-double_8c.html#aa42a9a9cb6e2b93d7f825c395af871bf">i</a>].<a class="code" href="structgpgpu__recon__t.html#a45e34c95d3bc7ca05742aa2e25b3baa3">target_inst</a>-&gt;<a class="code" href="classptx__instruction.html#aaf60e39104281c2e8adcae77105710d9">print_insn</a>();
<a name="l02090"></a>02090          printf(<span class="stringliteral">&quot;\n&quot;</span>);
<a name="l02091"></a>02091       }
<a name="l02092"></a>02092       printf(<span class="stringliteral">&quot;GPGPU-Sim PTX: ... end of reconvergence points for %s\n&quot;</span>, finfo-&gt;get_name().c_str() );
<a name="l02093"></a>02093 
<a name="l02094"></a>02094       tmp.<a class="code" href="structrec__pts.html#a0b2a247b5605de7c608194c7af5ebc0b">s_kernel_recon_points</a> = kernel_recon_points;
<a name="l02095"></a>02095       tmp.<a class="code" href="structrec__pts.html#a46e4f2094a8bef91733232e24eedd941">s_num_recon</a> = num_recon;
<a name="l02096"></a>02096       <a class="code" href="cuda-sim_8cc.html#aa0d9632ac9bff03ac0ee91e989cb667b">g_rpts</a>[finfo] = tmp;
<a name="l02097"></a>02097    } <span class="keywordflow">else</span> {
<a name="l02098"></a>02098       tmp = r-&gt;second;
<a name="l02099"></a>02099    }
<a name="l02100"></a>02100    <span class="keywordflow">return</span> tmp;
<a name="l02101"></a>02101 }
<a name="l02102"></a>02102 
<a name="l02103"></a><a class="code" href="cuda-sim_8h.html#a262e62cea217d68ed53b2649be480c6d">02103</a> <a class="code" href="abstract__hardware__model_8h.html#a4234d30919c0dcca6fca040a13ad6ae1">address_type</a> <a class="code" href="cuda-sim_8cc.html#a262e62cea217d68ed53b2649be480c6d">get_return_pc</a>( <span class="keywordtype">void</span> *thd )
<a name="l02104"></a>02104 {
<a name="l02105"></a>02105     <span class="comment">// function call return</span>
<a name="l02106"></a>02106     <a class="code" href="classptx__thread__info.html">ptx_thread_info</a> *the_thread = (<a class="code" href="classptx__thread__info.html">ptx_thread_info</a>*)thd;
<a name="l02107"></a>02107     assert( the_thread != NULL );
<a name="l02108"></a>02108     <span class="keywordflow">return</span> the_thread-&gt;<a class="code" href="classptx__thread__info.html#a8c88271b26bd3c9738d75363fc75e7da">get_return_PC</a>();
<a name="l02109"></a>02109 }
<a name="l02110"></a>02110 
<a name="l02111"></a><a class="code" href="cuda-sim_8cc.html#af120e92007c89cb8547a22515d6caebd">02111</a> <a class="code" href="abstract__hardware__model_8h.html#a4234d30919c0dcca6fca040a13ad6ae1">address_type</a> <a class="code" href="cuda-sim_8cc.html#af120e92007c89cb8547a22515d6caebd">get_converge_point</a>( <a class="code" href="abstract__hardware__model_8h.html#a4234d30919c0dcca6fca040a13ad6ae1">address_type</a> pc ) 
<a name="l02112"></a>02112 {
<a name="l02113"></a>02113    <span class="comment">// the branch could encode the reconvergence point and/or a bit that indicates the </span>
<a name="l02114"></a>02114    <span class="comment">// reconvergence point is the return PC on the call stack in the case the branch has </span>
<a name="l02115"></a>02115    <span class="comment">// no immediate postdominator in the function (i.e., due to multiple return points). </span>
<a name="l02116"></a>02116 
<a name="l02117"></a>02117    std::map&lt;unsigned,function_info*&gt;::iterator f=<a class="code" href="cuda-sim_8cc.html#a211215b94814ab66fe7ce1a1f7000238">g_pc_to_finfo</a>.find(pc);
<a name="l02118"></a>02118    assert( f != <a class="code" href="cuda-sim_8cc.html#a211215b94814ab66fe7ce1a1f7000238">g_pc_to_finfo</a>.end() );
<a name="l02119"></a>02119    <a class="code" href="classfunction__info.html">function_info</a> *finfo = f-&gt;second;
<a name="l02120"></a>02120    <a class="code" href="structrec__pts.html">rec_pts</a> tmp = <a class="code" href="cuda-sim_8cc.html#ac5a36f954a9bdde73d74afa9b52e18b8">find_reconvergence_points</a>(finfo);
<a name="l02121"></a>02121 
<a name="l02122"></a>02122    <span class="keywordtype">int</span> <a class="code" href="rng-double_8c.html#aa42a9a9cb6e2b93d7f825c395af871bf">i</a>=0;
<a name="l02123"></a>02123    <span class="keywordflow">for</span> (; i &lt; tmp.<a class="code" href="structrec__pts.html#a46e4f2094a8bef91733232e24eedd941">s_num_recon</a>; ++i) {
<a name="l02124"></a>02124       <span class="keywordflow">if</span> (tmp.<a class="code" href="structrec__pts.html#a0b2a247b5605de7c608194c7af5ebc0b">s_kernel_recon_points</a>[i].<a class="code" href="structgpgpu__recon__t.html#af4b174c2a6643d90c4ecff886f89769d">source_pc</a> == pc) {
<a name="l02125"></a>02125           <span class="keywordflow">if</span>( tmp.<a class="code" href="structrec__pts.html#a0b2a247b5605de7c608194c7af5ebc0b">s_kernel_recon_points</a>[i].<a class="code" href="structgpgpu__recon__t.html#ad2a3bec99c4ff308f947ec413f2fc54e">target_pc</a> == (<span class="keywordtype">unsigned</span>) -2 ) {
<a name="l02126"></a>02126               <span class="keywordflow">return</span> RECONVERGE_RETURN_PC;
<a name="l02127"></a>02127           } <span class="keywordflow">else</span> {
<a name="l02128"></a>02128               <span class="keywordflow">return</span> tmp.<a class="code" href="structrec__pts.html#a0b2a247b5605de7c608194c7af5ebc0b">s_kernel_recon_points</a>[i].<a class="code" href="structgpgpu__recon__t.html#ad2a3bec99c4ff308f947ec413f2fc54e">target_pc</a>;
<a name="l02129"></a>02129           }
<a name="l02130"></a>02130       }
<a name="l02131"></a>02131    }
<a name="l02132"></a>02132    <span class="keywordflow">return</span> NO_BRANCH_DIVERGENCE;
<a name="l02133"></a>02133 }
<a name="l02134"></a>02134 
<a name="l02135"></a><a class="code" href="classfunctionalCoreSim.html#a841497f6cd0b13976809a2dece52ee47">02135</a> <span class="keywordtype">void</span> <a class="code" href="classfunctionalCoreSim.html#a841497f6cd0b13976809a2dece52ee47">functionalCoreSim::warp_exit</a>( <span class="keywordtype">unsigned</span> warp_id )
<a name="l02136"></a>02136 {
<a name="l02137"></a>02137     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="rng-double_8c.html#aa42a9a9cb6e2b93d7f825c395af871bf">i</a>=0;<a class="code" href="rng-double_8c.html#aa42a9a9cb6e2b93d7f825c395af871bf">i</a>&lt;<a class="code" href="classcore__t.html#a6c35c5fc2bfa8ed3096db834e6b305fb">m_warp_count</a>*<a class="code" href="classcore__t.html#a65e8ba0d59364d180c6f3ca49d840229">m_warp_size</a>;<a class="code" href="rng-double_8c.html#aa42a9a9cb6e2b93d7f825c395af871bf">i</a>++){
<a name="l02138"></a>02138         <span class="keywordflow">if</span>(<a class="code" href="classcore__t.html#a74ac58fba7a6ecd53ba31705ba5c38cd">m_thread</a>[<a class="code" href="rng-double_8c.html#aa42a9a9cb6e2b93d7f825c395af871bf">i</a>]!=NULL){
<a name="l02139"></a>02139              <a class="code" href="classcore__t.html#a74ac58fba7a6ecd53ba31705ba5c38cd">m_thread</a>[<a class="code" href="rng-double_8c.html#aa42a9a9cb6e2b93d7f825c395af871bf">i</a>]-&gt;<a class="code" href="classptx__thread__info.html#a7370f6a56ea5d11bcc6d66d16d849255">m_cta_info</a>-&gt;<a class="code" href="classptx__cta__info.html#a1f11378a34a2fb82861da9267693c3cd">register_deleted_thread</a>(<a class="code" href="classcore__t.html#a74ac58fba7a6ecd53ba31705ba5c38cd">m_thread</a>[<a class="code" href="rng-double_8c.html#aa42a9a9cb6e2b93d7f825c395af871bf">i</a>]);
<a name="l02140"></a>02140              <span class="keyword">delete</span> <a class="code" href="classcore__t.html#a74ac58fba7a6ecd53ba31705ba5c38cd">m_thread</a>[i];
<a name="l02141"></a>02141         }
<a name="l02142"></a>02142     }
<a name="l02143"></a>02143 }
</pre></div></div>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&nbsp;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&nbsp;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&nbsp;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&nbsp;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&nbsp;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&nbsp;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&nbsp;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&nbsp;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&nbsp;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&nbsp;</span>Friends</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<hr size="1"/><address style="text-align: right;"><small>Generated on 4 Apr 2018 for GPGPU-Sim by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
